---
title: "Antimicrobial Use Survey (Final Version)"
author: "Conrad Schelkopf"
date: "1/3/2022"
output: html_document
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = FALSE, fig.width = 6)

```

## Libraries
```{r include=FALSE}
library(tidyverse)
#library(ggsci)
#library(ggplot2)
#library(knitr)
#library(dplyr)
#library(data.table)
#library(colorspace)
#library(rcartocolor)
library(RColorBrewer)
#library(mosaic)
#library(lme4)
#library(viridis)
#library(viridisLite)
```

## Read Data
```{r echo=FALSE, message=FALSE, warning=FALSE}

AMU_Survey_Final<- read_csv("AMU_Survey_Final_revised.csv", 
                            col_types = cols(.default = 'c'))

```


```{r echo=FALSE, message=FALSE, warning=FALSE}

AMU_survey_clean_long<-AMU_Survey_Final%>%
  filter(Finished %in% 'TRUE')%>%
  pivot_longer(cols = starts_with('Q'), 
               names_to = 'Question', 
               values_to = 'Answer')%>%
  mutate(Answer = case_when(
    is.na(Answer)~'No Response',
    TRUE~Answer))

AMU_shiny<-AMU_survey_clean_long%>%
  select(ResponseId, grad_year:certificate_program, Question, Answer)%>%
  filter(!(Question %in% c('Q1', 'Q2', 'Q3', 'Q4', 'Q5', 'Q6')))%>%
  mutate(
    grad_year_cat = case_when(
      is.na(grad_year_cat)~'No Response', 
      TRUE~grad_year_cat), 
    grad_year = parse_number(grad_year)
  )
write_rds(AMU_shiny, 'shinyAMUsurvey/AMUdata.rds')
sk_AMU<-skimr::skim(AMU_shiny)
  
```

## Question 7 - what matters

Inputs that Contribute to Decisions in Selecting a Food Animal Antimicrobial Regimen

```{r}
df7<-df%>%filter(str_detect(Question, 'Q7'))%>%
  mutate(Qtype = case_when(
    str_count(Question)<5~'original', 
    TRUE~'modified'
  ))

df7_original<-df7%>%
  filter(Qtype %in% 'original')%>%
  mutate(Answer = factor(Answer, levels = c( "A major component of my decision process",
                                             "Important, but not a major component" , 
                                             "A very minor component", 
                                             "Not considered",
                                             "No Response" )))

df7_modified<-df7%>%
  filter(!(Qtype %in% 'original'))

ggplot(df7_original)+
  geom_bar(aes(x = Question, fill = Answer ))+
  facet_wrap(grad_year_cat~., scale = 'free')+
  coord_flip()+
  scale_fill_manual(values = c( "A major component of my decision process" = '#a50f15',
                                             "Important, but not a major component" = '#fb6a4a' , 
                                             "A very minor component" = '#fcae91', 
                                             "Not considered" = 'black',
                                             "No Response" = 'grey' ))

ggplot(df7_original)+
  geom_bar(aes(x = Question, fill = Answer ))+
  facet_wrap(practice_type~., scale = 'free')+
  coord_flip()+
  scale_fill_manual(values = c( "A major component of my decision process" = '#a50f15',
                                             "Important, but not a major component" = '#fb6a4a' , 
                                             "A very minor component" = '#fcae91', 
                                             "Not considered" = 'black',
                                             "No Response" = 'grey' ))




# ggplot(df7_modified)+
#   geom_bar(aes(x = Question, fill = Answer ))+
#   facet_wrap(Qtype~., scale = 'free')+
#   coord_flip()

```

u

```{r}

```





## Total Respondents
```{r echo=FALSE}
# table_finished <- data.table(tally(~ Finished, data = AMU_Survey_Final)) %>% 
#   filter(!(Finished %in% FALSE))

#kable(table_finished)
```

## Q2 Year of Graduation from a College of Veterinary Medicine
```{r echo=FALSE, warning=FALSE}
#Reorder grad year cat
AMU_Survey_Final <- AMU_Survey_Final %>% 
  mutate(grad_year_cat=factor(grad_year_cat,
                              levels = c("<1987", "1987-1999", "2000-2010", "2011-2016", ">2016")))

#bar chart of total count by grad year
ggplot(AMU_Survey_Final)+
  geom_bar(aes(x = parse_number(grad_year)), fill = "#2D708EFF")+
  scale_x_continuous(breaks=seq(1950,2025,5))+
  labs(x = "Year", y = "Number of Respondents", title = "Graduation Year Distribution")+
  theme_bw()

```


```{r echo=FALSE, warning=FALSE}
grad_yr_revised <- AMU_Survey_Final %>% 
  filter(!(grad_year_cat %in% "Unknown")) 

#count and proportion for grad year categories
grad_yr_ct <- tally(grad_yr_revised$grad_year_cat)
grad_yr_pct <-  data.table(round(tally(~ grad_year_cat, data = grad_yr_revised, format = "proportion"),4)) %>% rename(Pct = N)

grad_yr <- merge.data.table(grad_yr_ct, grad_yr_pct) %>% 
    filter(!(grad_year_cat %in% "Unknown")) %>% 
    arrange(factor(grad_year_cat, levels = c("<1987", "1987-1999", "2000-2010", "2011-2016", ">2016"))) %>% 
    rename("Graduate Year" = grad_year_cat)

#grad_yr <- grad_yr %>% 
  #mutate("%" = Pct*100) %>% 
  #select(-Pct)

kable(grad_yr)
  #%>% 
  #kable_classic_2(full_width = F)
```

## Q3 License to Practice
```{r echo=FALSE}
table_license <- data.table(tally(~ Q3, data = AMU_Survey_Final)) %>% 
  filter(!(Q3 %in% "No"))

kable(table_license)
```

## Q4 Current Food Animal Practice Situation
```{r echo=FALSE}
#count and proportion for practice type categories
pract_type_ct <- data.table(tally(~ practice_type, data = AMU_Survey_Final))
pract_type_pct <- data.table(round(tally(~ practice_type, data = AMU_Survey_Final, format = "proportion"),4)) %>% rename(Pct = N)

pract_type <- merge.data.table(pract_type_ct, pract_type_pct) %>% 
    arrange(factor(practice_type, levels = c("Private General Practice", "Food Animal Practice", "Consultant",
    "Staff Vet", "Academia", "None"))) 

pract_type <-  pract_type %>% 
    arrange(desc(Pct))

pract_type <-  pract_type %>%
    rename("Practice Type" = practice_type)


kable(pract_type)
```

## Explore Graph_practice type vs grad year
```{r message=FALSE, warning=FALSE, include=FALSE}
#reorder practice type
AMU_Survey_Final <- AMU_Survey_Final %>% 
  mutate(practice_type=fct_relevel(practice_type,c("Private General Practice", "Food Animal Practice", "Consultant", "Staff Vet", "Academia", "None")))

#Dot Plot for practice type vs grad year
ggplot(AMU_Survey_Final)+
  geom_dotplot(aes(x=grad_year, fill=practice_type), dotsize = 0.8, stackgroups = FALSE,  stackdir = "up",
  stackratio = 1, width = 0.9, binwidth = NULL)+
  theme_bw()+
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
  panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))+
  scale_fill_discrete(name="Practice Type")+
  labs(x = "Graduation Year", y = "Count", title = "Practice Type Distribution by Graduation Year")+
  scale_color_viridis(option = "D")+
  scale_fill_viridis(discrete = TRUE, option = "D")
  
```

## Q5 Organization Membership
```{r echo=FALSE, message=FALSE, warning=FALSE}
#create total count and proportion responses for membership (long format)
org_mem3 <-AMU_Survey_Final %>%
  select(rowid, AABP, AVC, AASV, AASRP, AAAP, AVMA, 
         StateVMA, Foreign)%>%
  pivot_longer(cols = c(AABP, AVC, AASV, AASRP, AAAP, AVMA, 
                        StateVMA, Foreign), 
               names_to = 'Organization', 
               values_to = 'Membership')%>%
  mutate(total = n_distinct(rowid), 
         total_sum = sum(n()))%>%
  ungroup()%>%
  filter(Membership %in% 'TRUE')%>%

  group_by( total, Organization, Membership)%>%
  summarize(organization_ct = sum(n()))%>%
  ungroup()%>%
  mutate(pct = (organization_ct/total)) 

org_mem3 <- org_mem3 %>% 
  select(-total, -Membership) %>% 
  rename(n=organization_ct) %>% 
  arrange(desc(pct))

org_mem3 <- org_mem3 %>% 
  mutate_at(vars(pct), funs(round(., 4)))

kable(org_mem3)

#----------------------------------
#create total count and proportion responses for membership by grad year category (wide format)
org_mem1 <- grad_yr_revised %>%
group_by(grad_year_cat) %>%
summarise(total = sum(n()), 
          total_n_dist = n_distinct(rowid), 
          aabp_ct = sum(AABP), #can sum logical variable
          avc_ct = sum(AVC), aasv_ct = sum(AASV),
          aasrp_ct = sum(AASRP), aaap_ct = sum(AAAP),
          avma_ct = sum(AVMA), statevma_ct = sum(StateVMA),
          foreign_ct = sum(Foreign))%>%
  ungroup()%>%
  mutate(pct_aabp = aabp_ct/total_n_dist, 
         pct_avc = avc_ct/total_n_dist,
         pct_aasv = aasv_ct/total_n_dist,
         pct_aasrp = aasrp_ct/total_n_dist,
         pct_aaap = aaap_ct/total_n_dist,
         pct_avma = avma_ct/total_n_dist,
         pct_statevm = statevma_ct/total_n_dist,
         pct_foreign = foreign_ct/total_n_dist)

#kable(org_mem1) #%>%
  #scroll_box(width = "500px", height = "200px")

#-------------------------------
#create total count and proportion responses for membership by grad year category (long format)
org_mem2 <- grad_yr_revised %>%
  select(rowid, grad_year_cat, AABP, AVC, AASV, AASRP, AAAP, AVMA, 
         StateVMA, Foreign)%>%
  pivot_longer(cols = c(AABP, AVC, AASV, AASRP, AAAP, AVMA, 
                        StateVMA, Foreign), 
               names_to = 'Organization', 
               values_to = 'Membership')%>%
  group_by(grad_year_cat)%>%
  mutate(total = n_distinct(rowid), 
         total_sum = sum(n()))%>%
  ungroup()%>%
  filter(Membership %in% 'TRUE')%>%

  group_by( grad_year_cat, total, Organization, Membership)%>%
  summarize(organization_ct = sum(n()))%>%
  ungroup()%>%
  mutate(pct = organization_ct/total)

#kable(org_mem2)

#----------------------------------
#reorder organization membership
org_mem2 <- org_mem2 %>% 
  mutate(Organization=fct_relevel(Organization, c('AVMA', 'StateVMA','AABP', 'AVC', 'AASV', 'AASRP', 'AAAP', 'Foreign')))

#bar chart of organization membership by grad year category
#ggplot(org_mem2)+
  #geom_bar(aes(x = grad_year_cat, y = pct, 
               #fill = factor(Organization)),
               #stat = 'identity', position = 'dodge')+
               #facet_grid(factor(Organization)~., scales = 'fixed')
              #ggsave('org_mem2.jpg', height = 11, width = 8.5)

#----------------------------------
#create total count and proportion responses for membership by practice type (wide format)
org_mem4 <- AMU_Survey_Final %>%
group_by(practice_type) %>%
summarise(total = sum(n()), 
          total_n_dist = n_distinct(rowid), 
          aabp_ct = sum(AABP), #can sum logical variable
          avc_ct = sum(AVC), aasv_ct = sum(AASV),
          aasrp_ct = sum(AASRP), aaap_ct = sum(AAAP),
          avma_ct = sum(AVMA), statevma_ct = sum(StateVMA),
          foreign_ct = sum(Foreign))%>%
  ungroup()%>%
  mutate(pct_aabp = aabp_ct/total_n_dist, 
         pct_avc = avc_ct/total_n_dist,
         pct_aasv = aasv_ct/total_n_dist,
         pct_aasrp = aasrp_ct/total_n_dist,
         pct_aaap = aaap_ct/total_n_dist,
         pct_avma = avma_ct/total_n_dist,
         pct_statevm = statevma_ct/total_n_dist,
         pct_foreign = foreign_ct/total_n_dist)

#kable(org_mem4) #%>%
  #scroll_box(width = "500px", height = "200px")

#-------------------------------
#create total count and proportion responses for membership by practice type (long format)
org_mem5 <-AMU_Survey_Final%>%
  select(rowid, practice_type, AABP, AVC, AASV, AASRP, AAAP, AVMA, 
         StateVMA, Foreign)%>%
  pivot_longer(cols = c(AABP, AVC, AASV, AASRP, AAAP, AVMA, 
                        StateVMA, Foreign), 
               names_to = 'Organization', 
               values_to = 'Membership')%>%
  group_by(practice_type)%>%
  mutate(total = n_distinct(rowid), 
         total_sum = sum(n()))%>%
  ungroup()%>%
  filter(Membership %in% 'TRUE')%>%

  group_by(practice_type, total, Organization, Membership)%>%
  summarize(organization_ct = sum(n()))%>%
  ungroup()%>%
  mutate(pct = organization_ct/total)

#kable(org_mem5)

#reorder organization membership
org_mem5 <- org_mem5 %>% 
  mutate(Organization=fct_relevel(Organization, c('AVMA', 'StateVMA','AABP', 'AVC', 'AASV', 'AASRP', 'AAAP', 'Foreign')))

#bar chart of organization membership by practice type
#ggplot(org_mem5)+
  #geom_bar(aes(x = practice_type, y = pct, 
               #fill = factor(Organization)),
               #stat = 'identity', position = 'dodge')+
               #facet_grid(factor(Organization)~., scales = 'fixed')+
               #theme(axis.text.x = element_text(angle = 45, hjust = 1))
              #ggsave('org_mem5.jpg', height = 11, width = 8.5)
```

## Q6 Food Animal Species Serving Practice
```{r echo=FALSE, message=FALSE}
#create total count and proportion responses for species (long format)
species3 <- AMU_Survey_Final %>%
  select(rowid, Beef_Cattle, Dairy_Cattle, Swine, Sheep, Goats, Chickens, Turkeys, beef_dairy, sheep_goat, chicken_turkey)%>%
  pivot_longer(cols = c(Beef_Cattle, Dairy_Cattle, Swine, Sheep, Goats, Chickens, Turkeys, beef_dairy, sheep_goat, chicken_turkey), 
               names_to = 'Species', 
               values_to = 'Practice')%>%
  mutate(total = n_distinct(rowid), 
         total_sum = sum(n()))%>%
  ungroup()%>%
  filter(Practice %in% 'TRUE')%>%

  group_by( total, Species, Practice)%>%
  summarize(species_ct = sum(n()))%>%
  ungroup()%>%
  mutate(pct = species_ct/total)

#species3 <- species3 %>% 
  #arrange(factor(Species, levels = c('Beef_Cattle', 'Dairy_Cattle', 'beef_dairy', 'Swine', 'Sheep', 'Goats', 
                                     #'sheep_goat', 'Chickens', 'Turkeys', 'chicken_turkey'))) 

species3 <- species3 %>% 
  select(-total, -Practice) %>% 
  rename(n=species_ct) %>% 
  arrange(desc(pct)) 

species3 <- species3 %>% 
  mutate_at(vars(pct), funs(round(., 4)))

kable(species3)

#-----------------------------------
#create total count and proportion responses for species by grad year category (wide format)
species1 <- grad_yr_revised %>%
group_by(grad_year_cat) %>%
summarise(total = sum(n()), 
          total_n_dist = n_distinct(rowid), 
          beef_ct = sum(Beef_Cattle), #can sum logical variable
          dairy_ct = sum(Dairy_Cattle), swine_ct = sum(Swine),
          sheep_ct = sum(Sheep), goat_ct = sum(Goats),
          chicken_ct = sum(Chickens), turkey_ct = sum(Turkeys),
          beef_dairy_ct = sum(beef_dairy), 
          sheep_goat_ct = sum(sheep_goat), 
          chicken_turkey_ct = sum(chicken_turkey))%>%
  ungroup()%>%
  mutate(pct_beef = beef_ct/total_n_dist, 
         pct_dairy = dairy_ct/total_n_dist,
         pct_swine = swine_ct/total_n_dist,
         pct_sheep = sheep_ct/total_n_dist,
         pct_goat = goat_ct/total_n_dist,
         pct_chicken = chicken_ct/total_n_dist,
         pct_turkey = turkey_ct/total_n_dist,
         pct_beef_dairy = beef_dairy_ct/total_n_dist,
         pct_sheep_goat = sheep_goat_ct/total_n_dist,
         pct_chicken_turkey = chicken_turkey_ct/total_n_dist)

#kable(species1)

#-------------------------------
#create total count and proportion responses for species by grad year category (long format)
species2 <- grad_yr_revised %>%
  select(rowid, grad_year_cat, Beef_Cattle, Dairy_Cattle, Swine, Sheep, Goats, Chickens, Turkeys, beef_dairy, sheep_goat, chicken_turkey)%>%
  pivot_longer(cols = c(Beef_Cattle, Dairy_Cattle, Swine, Sheep, Goats, Chickens, Turkeys, beef_dairy, sheep_goat, chicken_turkey), 
               names_to = 'Species', 
               values_to = 'Practice')%>%
  group_by(grad_year_cat)%>%
  mutate(total = n_distinct(rowid), 
         total_sum = sum(n()))%>%
  ungroup()%>%
  filter(Practice %in% 'TRUE')%>%

  group_by(grad_year_cat, total, Species, Practice)%>%
  summarize(species_ct = sum(n()))%>%
  ungroup()%>%
  mutate(pct = species_ct/total) %>% 
  arrange(factor(Species, levels = c('Beef_Cattle', 'Dairy_Cattle', 'beef_dairy', 'Swine', 'Sheep', 'Goats', 
                                     'sheep_goat', 'Chickens', 'Turkeys', 'chicken_turkey'))) %>% 
  arrange(factor(grad_year_cat, levels = c("<1987", "1987-1999", "2000-2010", "2011-2016", ">2016")))

#kable(species2)

#-----------------------------------
#reorder species in practice
species2 <- species2 %>% 
  mutate(Species=fct_relevel(Species, c('Beef_Cattle', 'Dairy_Cattle', 'Swine', 'Sheep', 'Goats', 'Chickens', 'Turkeys', 'beef_dairy', 'sheep_goat', 'chicken_turkey')))

#bar chart of species in practice by grad year category
#ggplot(species2)+
  #geom_bar(aes(x = grad_year_cat, y = pct, 
               #fill = factor(Species)),
               #stat = 'identity', position = 'dodge')+
               #facet_grid(factor(Species)~., scales = 'free')
               #ggsave('test.jpg', height = 11, width = 8.5)

#----------------------------------
#create total count and proportion responses for species by practice type (wide format)
species4 <- AMU_Survey_Final %>%
group_by(practice_type) %>%
summarise(total = sum(n()), 
          total_n_dist = n_distinct(rowid), 
          beef_ct = sum(Beef_Cattle), #can sum logical variable
          dairy_ct = sum(Dairy_Cattle), swine_ct = sum(Swine),
          sheep_ct = sum(Sheep), goat_ct = sum(Goats),
          chicken_ct = sum(Chickens), turkey_ct = sum(Turkeys),
          beef_dairy_ct = sum(beef_dairy), 
          sheep_goat_ct = sum(sheep_goat), 
          chicken_turkey_ct = sum(chicken_turkey))%>%
  ungroup()%>%
  mutate(pct_beef = beef_ct/total_n_dist, 
         pct_dairy = dairy_ct/total_n_dist,
         pct_swine = swine_ct/total_n_dist,
         pct_sheep = sheep_ct/total_n_dist,
         pct_goat = goat_ct/total_n_dist,
         pct_chicken = chicken_ct/total_n_dist,
         pct_turkey = turkey_ct/total_n_dist,
         pct_beef_dairy = beef_dairy_ct/total_n_dist,
         pct_sheep_goat = sheep_goat_ct/total_n_dist,
         pct_chicken_turkey = chicken_turkey_ct/total_n_dist)

#kable(species4) #%>%
  #scroll_box(width = "500px", height = "200px")

#-------------------------------
#create total count and proportion responses for species by practice type (long format)
species5 <-AMU_Survey_Final%>%
  select(rowid, practice_type, Beef_Cattle, Dairy_Cattle, Swine, Sheep, Goats, Chickens, Turkeys, beef_dairy, sheep_goat, chicken_turkey)%>%
  pivot_longer(cols = c(Beef_Cattle, Dairy_Cattle, Swine, Sheep, Goats, Chickens, Turkeys, beef_dairy, sheep_goat, chicken_turkey), 
               names_to = 'Species', 
               values_to = 'Practice')%>%
  group_by(practice_type)%>%
  mutate(total = n_distinct(rowid), 
         total_sum = sum(n()))%>%
  ungroup()%>%
  filter(Practice %in% 'TRUE')%>%

  group_by(practice_type, total, Species, Practice)%>%
  summarize(species_ct = sum(n()))%>%
  ungroup()%>%
  mutate(pct = species_ct/total) %>% 
  arrange(factor(Species, levels = c('Beef_Cattle', 'Dairy_Cattle', 'beef_dairy', 'Swine', 'Sheep', 'Goats', 
                                     'sheep_goat', 'Chickens', 'Turkeys', 'chicken_turkey'))) %>% 
  arrange(factor(practice_type, levels = c("Private General Practice", "Food Animal Practice", "Consultant", 
                                     "Staff Vet", "Academia", "None")))
  
#kable(species5)


Species_New <- species5 %>%
  mutate(Species = recode(Species, 'Beef_Cattle'= "Beef Cattle", 'Dairy_Cattle' = "Dairy Cattle", 
                       'Swine' = "Swine", 'Sheep' = "Sheep", 'Goats' = "Goats", 'Chickens'= "Chickens",
                                        'Turkeys'= "Turkeys", 'beef_dairy'= "Beef and/or Dairy", 
                       'sheep_goat' = "Sheep and/or Goats",'chicken_turkey' = "Chicken and/or Turkeys"))

#reorder organization membership
Species_New <- Species_New %>% 
  mutate(Species=fct_relevel(Species, c("Beef Cattle", "Dairy Cattle", "Swine", "Sheep", 
                                        "Goats", "Chickens", "Turkeys",  "Beef and/or Dairy", 
                        "Sheep and/or Goats", "Chicken and/or Turkeys")))

#bar chart of organization membership by practice type
ggplot(Species_New)+
  geom_bar(aes(x = practice_type, y = pct, 
               fill = factor(Species)),
               stat = 'identity', position = 'dodge', fill = "#29AF7FFF")+
               facet_grid(factor(Species)~., scales = 'fixed')+
               theme(strip.text.y = element_text(angle = 0))+
               theme(legend.position = "none")+
               theme_bw()+
               theme(axis.text.x = element_text(angle = 45, hjust = 1))+
               labs( y = "Percentage of Responses", title = "Practice Type vs. Species in Practice")+
               scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
               theme(strip.text.y = element_text(angle = 0))+
               theme(legend.position = "none", axis.title.x = element_blank())

              #ggsave('org_mem5.jpg', height = 11, width = 8.5)

```

## Q7 Inputs that Contribute to Decisions in Selecting a Food Animal Antimicrobial Regimen
```{r echo=FALSE, message=FALSE, warning=FALSE}
#count and proportions for Q7 distribution
#Cost
Q7_cost_filter <- AMU_Survey_Final %>% 
    filter(!(Q7_cost %in% 'Unknown'))

Q7_cost_ct <- data.table(tally( ~ Q7_cost , data = Q7_cost_filter))
Q7_cost_pct <- data.table(round(tally( ~ Q7_cost , data = Q7_cost_filter, format("proportion")),4))%>% 
    rename(pct = N) 

table_Q7_cost <- merge.data.table(Q7_cost_ct, Q7_cost_pct) %>% 
    arrange(factor(Q7_cost, levels = c("Major", "Important", "Minor", "None", "Unknown")))

table_Q7_cost <- table_Q7_cost %>% mutate(question="cost") %>% rename(importance=Q7_cost)

#kable(table_Q7_cost)

#Efficacy and safety of the treatment (past experience or trial data)
Q7_efficacy_safety_filter <- AMU_Survey_Final %>% 
    filter(!(Q7_efficacy_safety %in% 'Unknown'))

Q7_efficacy_safety_ct <- data.table(tally( ~ Q7_efficacy_safety , data = Q7_efficacy_safety_filter))
Q7_efficacy_safety_pct <- data.table(round(tally( ~ Q7_efficacy_safety , data = Q7_efficacy_safety_filter, format("proportion")),4))%>% 
    rename(pct = N)

table_Q7_efficacy_safety <- merge.data.table(Q7_efficacy_safety_ct, Q7_efficacy_safety_pct) %>% 
    arrange(factor(Q7_efficacy_safety, levels = c("Major", "Important", "Minor", "None", "Unknown")))

table_Q7_efficacy_safety <- table_Q7_efficacy_safety %>% mutate(question="efficacy and safety") %>%
    rename(importance=Q7_efficacy_safety)

#kable(table_Q7_efficacy_safety)

#Ability for the regimen to be practically applied 
Q7_applied_practically_filter <- AMU_Survey_Final %>% 
    filter(!(Q7_applied_practically %in% 'Unknown'))

Q7_applied_practically_ct <- data.table(tally( ~ Q7_applied_practically , data = Q7_applied_practically_filter))
Q7_applied_practically_pct <- data.table(round(tally( ~ Q7_applied_practically , data = Q7_applied_practically_filter, format("proportion")),4))%>% 
    rename(pct = N)

table_Q7_applied_practically <- merge.data.table(Q7_applied_practically_ct, Q7_applied_practically_pct) %>% 
    arrange(factor(Q7_applied_practically, levels = c("Major", "Important", "Minor", "None", "Unknown")))

table_Q7_applied_practically <- table_Q7_applied_practically %>% mutate(question="applied practically") %>%
    rename(importance=Q7_applied_practically)

#kable(table_Q7_applied_practically)

#Regulatory issues (e.g. prohibited extra label drug use, withdrawal time)
Q7_regulatory_issues_filter <- AMU_Survey_Final %>% 
    filter(!(Q7_regulatory_issues %in% 'Unknown'))

Q7_regulatory_issues_ct <- data.table(tally( ~ Q7_regulatory_issues , data = Q7_regulatory_issues_filter))
Q7_regulatory_issues_pct <- data.table(round(tally( ~ Q7_regulatory_issues , data = Q7_regulatory_issues_filter, format("proportion")),4))%>% 
    rename(pct = N)

table_Q7_regulatory_issues <- merge(Q7_regulatory_issues_ct, Q7_regulatory_issues_pct) %>% 
    arrange(factor(Q7_regulatory_issues, levels = c("Major", "Important", "Minor", "None", "Unknown")))

table_Q7_regulatory_issues <- table_Q7_regulatory_issues %>% mutate(question="regulatory issues") %>%
    rename(importance=Q7_regulatory_issues)

#kable(table_Q7_regulatory_issues)

#Potential to select for antimicrobial resistance in human medicine
Q7_human_resistance_filter <- AMU_Survey_Final %>% 
    filter(!(Q7_human_resistance %in% 'Unknown'))

Q7_human_resistance_ct <- data.table(tally( ~ Q7_human_resistance , data = Q7_human_resistance_filter))
Q7_human_resistance_pct <- data.table(round(tally( ~ Q7_human_resistance , data = Q7_human_resistance_filter,
    format("proportion")),4))%>%  rename(pct = N)

table_Q7_human_resistance <- merge(Q7_human_resistance_ct, Q7_human_resistance_pct) %>% 
    arrange(factor(Q7_human_resistance, levels = c("Major", "Important", "Minor", "None", "Unknown")))

table_Q7_human_resistance <- table_Q7_human_resistance %>% mutate(question="human resistance") %>%
    rename(importance=Q7_human_resistance)

#kable(table_Q7_human_resistance)

#Potential to select for antimicrobial resistance in pathogens affecting food animals
Q7_animal_resistance_filter <- AMU_Survey_Final %>% 
    filter(!(Q7_animal_resistance %in% 'Unknown'))

Q7_animal_resistance_ct <- data.table(tally( ~ Q7_animal_resistance , data = Q7_animal_resistance_filter))
Q7_animal_resistance_pct <- data.table(round(tally( ~ Q7_animal_resistance , data = Q7_animal_resistance_filter, format("proportion")),4))%>% 
    rename(pct = N)

table_Q7_animal_resistance <- merge(Q7_animal_resistance_ct, Q7_animal_resistance_pct) %>% 
    arrange(factor(Q7_animal_resistance, levels = c("Major", "Important", "Minor", "None", "Unknown")))

table_Q7_animal_resistance <- table_Q7_animal_resistance %>% mutate(question="animal resistance") %>%
    rename(importance=Q7_animal_resistance)

#kable(table_Q7_animal_resistance) #2 unknowns: probably did not answer the question

#Client preference (other than cost considerations)
Q7_client_preference_filter <- AMU_Survey_Final %>% 
    filter(!(Q7_client_preference %in% 'Unknown'))

Q7_client_preference_ct <- data.table(tally( ~ Q7_client_preference , data = Q7_client_preference_filter))
Q7_client_preference_pct <- data.table(round(tally( ~ Q7_client_preference , data = Q7_client_preference_filter, format("proportion")),4))%>% 
    rename(pct = N)

table_Q7_client_preference <- merge(Q7_client_preference_ct, Q7_client_preference_pct) %>% 
    arrange(factor(Q7_client_preference, levels = c("Major", "Important", "Minor", "None", "Unknown")))

table_Q7_client_preference <- table_Q7_client_preference %>% mutate(question="client preference") %>%
    rename(importance=Q7_client_preference)

#kable(table_Q7_client_preference) #1 unknown: probably did not answer the question

#Human importance status as classified by the Food and Drug Administration (FDA) or World Health Organization (WHO)
Q7_human_importance_filter <- AMU_Survey_Final %>% 
    filter(!(Q7_human_importance %in% 'Unknown'))

Q7_human_importance_ct <- data.table(tally( ~ Q7_human_importance , data = Q7_human_importance_filter))
Q7_human_importance_pct <- data.table(round(tally( ~ Q7_human_importance , data = Q7_human_importance_filter, format("proportion")),4))%>% 
    rename(pct = N)

table_Q7_human_importance <- merge(Q7_human_importance_ct, Q7_human_importance_pct) %>% 
    arrange(factor(Q7_human_importance, levels = c("Major", "Important", "Minor", "None", "Unknown")))

table_Q7_human_importance <- table_Q7_human_importance %>% mutate(question="human importance") %>%
    rename(importance=Q7_human_importance)

#kable(table_Q7_human_importance) #1 unknown: probably did not answer the question

#----------------------------
#Create a combined table for all parts of question 7

table_Q7 <- rbind.data.frame(table_Q7_cost, table_Q7_efficacy_safety, table_Q7_applied_practically,
                             table_Q7_regulatory_issues, table_Q7_human_resistance,
                             table_Q7_animal_resistance, table_Q7_client_preference,
                             table_Q7_human_importance)

table_Q7 <- table_Q7 %>% 
  select(question, importance, N, pct)

#kable(table_Q7)

table_Q7b <-  table_Q7 %>% 
  select(-pct) %>% 
  pivot_wider(names_from = importance, values_from = N) %>% 
  select(question,None, Minor, Important, Major) %>% 
  arrange(desc(Major))

table_Q7b[is.na(table_Q7b)] <- 0

kable(table_Q7b)

table_Q7c <-  table_Q7 %>% 
  select(-N) %>% 
  pivot_wider(names_from = importance, values_from =pct) %>% 
  select(question,None, Minor, Important, Major) %>% 
  arrange(desc(Major))

table_Q7c[is.na(table_Q7c)] <- 0

kable(table_Q7c)

table_Q7_New <- table_Q7 %>%
  mutate(question = recode(question, "efficacy and safety"= "Efficacy and Safety of the Treatment", 
          "regulatory issues" = "Regulatory Issues","applied practically" = "Ability of Regimen to be Applied Practically", "cost" = "Cost", "animal resistance" = "Select for AMR in Food Animal Medicine", "human importance" = "Human Importance Status by FDA or WHO", "human resistance" = "Select for AMR in Human Medicine", "client preference" = "Client Preference"))

#---------------------------
table_Q7_New <- table_Q7_New %>% 
  filter(!(importance %in% 'Unknown')) %>% 
  mutate(question=fct_relevel(question, c("Efficacy and Safety of the Treatment", "Regulatory Issues", 
        "Ability of Regimen to be Applied Practically", "Cost", "Select for AMR in Food Animal Medicine", 
        "Human Importance Status by FDA or WHO", "Select for AMR in Human Medicine", "Client Preference"))) %>% 
   mutate(importance=fct_relevel(importance, c("None", "Minor", "Important", "Major", "Unknown")))

#mutate(question=fct_relevel(question, c("efficacy and safety", "regulatory issues", 
      #"applied practically", "cost", "animal resistance", "human
      #importance", "human resistance", "client preference"

table_Q7_pct <- table_Q7 %>% 
  mutate(Percent = pct*100)

table_Q7_pct <- table_Q7_pct %>%
  mutate(question = recode(question, "efficacy and safety"= "Efficacy and Safety of the Treatment", 
          "regulatory issues" = "Regulatory Issues","applied practically" = "Ability of Regimen to be Applied Practically", "cost" = "Cost", "animal resistance" = "Select for AMR in Food Animal Medicine", "human importance" = "Human Importance Status by FDA or WHO", "human resistance" = "Select for AMR in Human Medicine", "client preference" = "Client Preference"))

table_Q7_pct <- table_Q7_pct %>% 
  filter(!(importance %in% 'Unknown')) %>% 
  mutate(question=fct_relevel(question, c("Efficacy and Safety of the Treatment", "Regulatory Issues", 
        "Ability of Regimen to be Applied Practically", "Cost", "Select for AMR in Food Animal Medicine", 
        "Human Importance Status by FDA or WHO", "Select for AMR in Human Medicine", "Client Preference"))) %>% 
   mutate(importance=fct_relevel(importance, c("None", "Minor", "Important", "Major", "Unknown")))

ggplot(table_Q7_New)+
  geom_bar(aes(x = importance, y = pct, 
               fill = factor(question)),
               stat = 'identity', position = 'dodge', fill = "#1F968BFF")+
               facet_grid(factor(question)~., scales = 'fixed')+
               scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
               theme(strip.text.y = element_text(angle = 0))+
               theme_bw()+
               labs(x= "Importance", y = "Percentage of Responses", 
                    title = "Inputs Contributing to Seletion of a Food Animal Antimicrobial Regimen")+
               scale_x_discrete(labels = c('Not Considered','Very Minor Component',
                                           'Important Component', 'Major Component'))+
               scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
               theme(strip.text.y = element_text(angle = 0))+
               theme(legend.position = "none")
               #ggsave('Q7.jpg', height = 11, width = 8.5)

ggplot(table_Q7_pct) +
  geom_point(aes(x = importance, y = question, size= Percent), color = 'orange')+
  geom_text(aes(x = importance, y = question, 
                label=paste0(round(pct*100, digits = 0))), 
            hjust = 0, vjust = 1)+
  theme_bw()+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_y_discrete(limits = c("Client Preference", "Select for AMR in Human Medicine", 
      "Human Importance Status by FDA or WHO", "Select for AMR in Food Animal Medicine", 
      "Cost", "Ability of Regimen to be Applied Practically", "Regulatory Issues",
      "Efficacy and Safety of the Treatment"))+
  labs(x= "Importance", y = "Inputs", 
                    title = "Inputs Contributing to Seletion of a
Food Animal Antimicrobial Regimen",
       size = "Percent of Responses")+
  scale_x_discrete(labels = c('Not Considered','Very Minor Component',
                                           'Important Component', 'Major Component'))


#write_csv(table_Q17b, 'Q17b.csv')
#write_csv(table_Q7, 'Q7.csv')

AMU_Survey_Full <- AMU_Survey_Final %>% 
  select(rowid, grad_year, grad_year_cat, practice_type, Q7_cost, Q7_efficacy_safety, Q7_applied_practically, Q7_regulatory_issues, Q7_human_resistance, Q7_animal_resistance, Q7_client_preference, Q7_human_importance,Q17_spectrum, Q17_compare_efficacy, Q17_combined_therapy, Q17_AST, Q17_resist_select, Q17_ancillary_therapy, Q17_post_treat_interval, Q17_duration_therapy, Q17_treatment_outcome)

#write_csv(AMU_Survey_Full, 'AMU_Survey_Full.csv')

```

```{r eval=FALSE, include=FALSE}


#=z <- AMU_Survey_Final %>% 
      #select(starts_with('Q7'))


#combined_data <- bind_rows(a, b, d)




#x <- table(AMU_Survey_Final$Q7_cost, AMU_Survey_Final$certificate_program)
#x

#table_Q7

#y <- cor(table_Q7)
#y


#cor(final)
#ggcorrplot

#test <- AMU_Survey_Final %>% 
  #count(Q7_cost, certificate_program)
#test

#ggplot(test, aes(Q7_cost, certificate_program)) +
  #geom_tile(aes(fill = n),stat = 'identity')

#test2 <- AMU_Survey_Final %>% 
  #select(Q7_cost, certificate_program)

#ggplot(test2) +
  #geom_count(aes(x = Q7_cost, y = certificate_program))


```

## Q9 Extent of Antimicrobial Susceptibility Testing BEFORE Antibiotic Treatment
```{r echo=FALSE}
#count and proportion for AST before
Q9_AST_before_filter <- AMU_Survey_Final %>% 
    filter(!(Q9_AST_before %in% 'Unknown'))

Q9_AST_before_ct <- data.table(tally(~ Q9_AST_before, data = Q9_AST_before_filter))  
Q9_AST_before_pct <- data.table(round(tally(~ Q9_AST_before, data = Q9_AST_before_filter, format('proportion')),4)) %>% 
    rename(pct = N)

Q9_AST_before <- merge.data.table(Q9_AST_before_ct, Q9_AST_before_pct) %>% 
    arrange(factor(Q9_AST_before, levels = c("Never", "Rarely", "Occasionally", "Often", "Unknown")))

Q9_AST_before <- Q9_AST_before %>% mutate(question="before AB treatment") %>%
    rename(frequency=Q9_AST_before)

#kable(Q9_AST_before)
```

## Q10 Extent of Antimicrobial Susceptibility Testing AFTER ENCOUNTERING A PERCEIVED LACK OF TREATMENT EFFICACY
```{r echo=FALSE}
#count and proportion for AST after
Q10_AST_after_filter <- AMU_Survey_Final %>% 
    filter(!(Q10_AST_after %in% 'Unknown'))

Q10_AST_after_ct <- data.table(tally(~ Q10_AST_after, data = Q10_AST_after_filter))  
Q10_AST_after_pct <- data.table(round(tally(~ Q10_AST_after, data = Q10_AST_after_filter, format('proportion')),4)) %>% 
  rename(pct = N)

Q10_AST_after <- merge.data.table(Q10_AST_after_ct, Q10_AST_after_pct) %>% 
    arrange(factor(Q10_AST_after, levels = c("Never", "Rarely", "Occasionally", "Often", "Unknown")))

Q10_AST_after <- Q10_AST_after %>% mutate(question="after lack of efficacy") %>%
    rename(frequency=Q10_AST_after)

#kable(Q10_AST_after)
```

## Q11 Extent of Antimicrobial Susceptibility Testing to Routinely Monitor Antimicrobial Susceptibility of Pathogens Which Cause Disease in Your Client's Herd or Flocks
```{r echo=FALSE}
##Filter out Owner and Staff vets (displayed as Unknowns)
Q11_filter <- AMU_Survey_Final %>%
  filter(!(Q11_AST_monitor_disease %in% 'Unknown'))

#count and proportion for AST monitor disease
Q11_AST_monitor_disease_ct <- data.table(tally(~ Q11_AST_monitor_disease, data = Q11_filter))
Q11_AST_monitor_disease_pct <- data.table(round(tally(~ Q11_AST_monitor_disease, data = Q11_filter, format('proportion')),4))   %>% rename(pct = N)

Q11_AST_monitor_disease <- merge(Q11_AST_monitor_disease_ct, Q11_AST_monitor_disease_pct) %>% 
    arrange(factor(Q11_AST_monitor_disease, levels = c("Never", "Rarely", "Occasionally", "Often", "Unknown")))

Q11_AST_monitor_disease <- Q11_AST_monitor_disease %>% mutate(question="monitor disease") %>%
    rename(frequency=Q11_AST_monitor_disease)

#kable(Q11_AST_monitor_disease)
```

## Q12 Extent of Antimicrobial Susceptibility Testing to Routinely Monitor Antimnicrobial Susceptibility of Potential Foodborne Pathogens in Your Client's Herd or Flocks
```{r echo=FALSE}
##Filter out Owner and Staff vets (displayed as Unknowns)
Q12_filter <- AMU_Survey_Final %>%
  filter(!(Q12_AST_monitor_foodborne %in% 'Unknown'))

#count and proportion for AST monitor disease
Q12_AST_monitor_foodborne_ct <- data.table(tally(~ Q12_AST_monitor_foodborne, data = Q12_filter))
Q12_AST_monitor_foodborne_pct <- data.table(round(tally(~ Q12_AST_monitor_foodborne, data = Q12_filter, format('proportion')),4)) %>% rename(pct = N)

Q12_AST_monitor_foodborne <- merge(Q12_AST_monitor_foodborne_ct, Q12_AST_monitor_foodborne_pct) %>% 
    arrange(factor(Q12_AST_monitor_foodborne, levels = c("Never", "Rarely", "Occasionally", "Often", "Unknown")))

Q12_AST_monitor_foodborne <- Q12_AST_monitor_foodborne %>% mutate(question="monitor foodborne pathogens") %>%
    rename(frequency=Q12_AST_monitor_foodborne)

#kable(Q12_AST_monitor_foodborne)
```

## Q9-Q12 Antimicrobial Suspectibility Testing Decisions (non-staff vets)
```{r echo=FALSE, message=FALSE, warning=FALSE}
#Create a combined table for question 9-12
table_AST <- rbind.data.frame(Q9_AST_before, Q10_AST_after, Q11_AST_monitor_disease, Q12_AST_monitor_foodborne)

table_AST <- table_AST %>% 
  select(question, frequency, N, pct)

#kable(table_AST)

table_ASTb <-  table_AST %>% 
  select(-pct) %>% 
  pivot_wider(names_from = frequency, values_from = N) %>% 
  select(question,Never, Rarely, Occasionally, Often) %>% 
  arrange(desc(Never))

kable(table_ASTb)

table_ASTc <-  table_AST %>% 
  select(-N) %>% 
  pivot_wider(names_from = frequency, values_from = pct) %>% 
  select(question,Never, Rarely, Occasionally, Often) %>% 
  arrange(desc(Never))

kable(table_ASTc)

table_AST_pct <- table_AST %>% 
  mutate(Percent = pct*100)

#---------------------------
table_AST <- table_AST %>% 
  filter(!(frequency %in% 'Unknown')) %>% 
  mutate(question=fct_relevel(question, c("monitor foodborne pathogens", 
            "monitor disease", "before AB treatment","after lack of efficacy"))) %>% 
   mutate(frequency=fct_relevel(frequency, c("Never", "Rarely", "Occasionally", "Often", "Unknown")))

ggplot(table_AST)+
  geom_bar(aes(x = frequency, y = pct,
               fill = factor(question)),
               stat = 'identity', position = 'dodge', fill = "#39568CFF")+
               facet_grid(factor(question)~., scales = 'fixed')+
               theme_bw()+
               labs(x= "Frequency", y = "Percent of Responses", 
                    title = "Use of Antimicrobial Susceptibility Testing")+
               scale_x_discrete(labels = c('Never','Rarely (1-5%)',
                                           'Occasionally (6-15%)', 'Often (>20%)'))+
               scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
               theme(strip.text.y = element_text(angle = 0))+
               theme(legend.position = "none")
            #ggsave('test.jpg', height = 11, width = 8.5)

table_AST_pct <- table_AST_pct %>% 
  mutate(frequency=fct_relevel(frequency, c("Never", "Rarely", "Occasionally", "Often"))) %>% 
  mutate(question=fct_relevel(question, c("after lack of efficacy", "before AB treatment",
    "monitor disease", "monitor foodborne pathogens")))

ggplot(table_AST_pct) +
  geom_point(aes(x = frequency, y = question, size=Percent), color = 'orange')+
  geom_text(aes(x = frequency, y = question, 
                label=paste0(round(pct*100, digits = 0))), 
            hjust = 0, vjust = 1)+
  theme_bw()+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_fill_discrete(name ="Title")+
  labs(x= "Frequency", y = "Percent of Responses", 
                    title = "Use of Antimicrobial Susceptibility Testing",
       size = "Percent of Responses")+
  scale_x_discrete(labels = c('Never','Rarely (1-5%)',
                                           'Occasionally (6-15%)', 'Often (>20%)'))+
  theme(axis.title.y = element_blank())
  #scale_y_discrete(limits = c("after lack of efficacy","before AB treatment",
                             #"monitor disease", "monitor foodborne
                             #pathogens"
                              #))




```

## Q13 Monitor Antimicrobial Susceptibility of Pathogens Which Cause Disease (Y/N) (Staff Vets Only)
```{r echo=FALSE}
#create vector with only staff vets
staffvet <- AMU_Survey_Final %>% 
  filter(practice_type %in% "Staff Vet")

#count and proportion for AST monitor of disease pathogens 
Q13_monitor_path_disease_ct <- data.table(tally(~ Q13_monitor_path_disease, data = staffvet))
Q13_monitor_path_disease_pct <- data.table(round(tally(~ Q13_monitor_path_disease, data = staffvet, format('proportion')),4)) %>%    rename(pct = N)

Q13_monitor_path_disease <- merge(Q13_monitor_path_disease_ct, Q13_monitor_path_disease_pct)

Q13_monitor_path_disease <- Q13_monitor_path_disease %>% 
  mutate(question="monitor pathogens causing disease") %>%
    rename(frequency=Q13_monitor_path_disease)

#kable(Q13_monitor_path_disease)
```

## Q14 Monitor Antimicrobial Susceptibility of Zoonotic Pathogens (Y/N) (Staff Vets Only)
```{r echo=FALSE}
#count and proportion for AST for zoonotic pathogens
Q14_monitor_zoo_path_ct <- data.table(tally(~ Q14_monitor_zoo_path, data = staffvet))  
Q14_monitor_zoo_path_pct <- data.table(round(tally(~ Q14_monitor_zoo_path, data = staffvet, format('proportion')),4)) %>%              rename(pct = N)

Q14_monitor_zoo_path <- merge(Q14_monitor_zoo_path_ct, Q14_monitor_zoo_path_pct)

Q14_monitor_zoo_path <- Q14_monitor_zoo_path %>% 
    mutate(question="monitor zoonotic pathogens") %>%
    rename(frequency=Q14_monitor_zoo_path)

#kable(Q14_monitor_zoo_path)
```

## Q13-Q14 Antimicrobial Suspectibility Testing Decisions (staff vets)
```{r echo=FALSE}
#Create a combined table for question 13-14
table_AST_staffvet <- rbind.data.frame(Q13_monitor_path_disease, Q14_monitor_zoo_path)

table_AST_staffvet <- table_AST_staffvet %>% 
  select(question, frequency, N, pct)

#kable(table_AST_staffvet) 

table_AST_staffvetb <-  table_AST_staffvet %>% 
  select(-pct) %>% 
  pivot_wider(names_from = frequency, values_from = N)

kable(table_AST_staffvetb)

table_AST_staffvetc <-  table_AST_staffvet %>% 
  select(-N) %>% 
  pivot_wider(names_from = frequency, values_from = pct)

kable(table_AST_staffvetc)

#---------------------------
table_AST_staffvet <- table_AST_staffvet %>% 
   mutate(frequency=fct_relevel(frequency, c("Yes", "No")))

ggplot(table_AST_staffvet)+
  geom_bar(aes(x = frequency, y = pct, 
               ),
               stat = 'identity', fill = "#440154FF", position = 'dodge')+
               facet_grid(factor(question)~., scales = 'fixed')+
               theme(strip.text.y = element_text(angle = 0))+
               theme_bw()+
               labs(x= "Response", y = "Percent of Responses", 
                    title = "Routinely Monitoring with Antimicrobial Susceptibility Testing")+
               scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
               theme(strip.text.y = element_text(angle = 0))+
               theme(legend.position = "none")
            #ggsave('test.jpg', height = 11, width = 8.5)
```

## Q15 Barriers to AST
```{r echo=FALSE, message=FALSE, warning=FALSE}
#create total count and proportion responses for barriers (long format)
Q15_2 <- AMU_Survey_Final %>%
  select(rowid, Q15_cost, Q15_time, Q15_not_useful, Q15_unsure_application)%>%
  pivot_longer(cols = c(Q15_cost, Q15_time, Q15_not_useful, Q15_unsure_application), 
               names_to = 'Barrier', 
               values_to = 'Answer')%>%
  mutate(total = n_distinct(rowid), 
         total_sum = sum(n()))%>%
  filter(Answer %in% 'TRUE')%>%

  group_by(total, Barrier, Answer)%>%
  summarize(barrier_ct = sum(n()))%>%
  ungroup()%>%
  mutate(pct = barrier_ct/total)

Q15_2 <- Q15_2 %>% 
  mutate(Barrier=fct_relevel(Barrier, c('Q15_cost', 'Q15_time', 'Q15_not_useful',
        'Q15_unsure_application')))

levels(Q15_2$Barrier) <- c("cost", "time", "not useful", "unsure of application")

Q15_2 <- Q15_2 %>% 
  arrange(factor(Barrier, levels = c("cost", "time", "not useful", "unsure of application")))

Q15_2 <- Q15_2 %>% 
  select(Barrier, barrier_ct, pct) %>% 
  arrange(desc(pct))

Q15_2 <- Q15_2 %>%
  mutate(Barrier = recode(Barrier, "cost" = "Cost", "time" = "Turnaround Time", "not useful" = "Not Useful",
                          "unsure of application" = "Unsure of Application"))

kable(Q15_2)

#-----------------------------------
#bar chart of barriers to AST
ggplot(Q15_2)+
  geom_bar(aes(x = Barrier, y = pct),
               stat = 'identity', fill = "#404788FF", position = 'dodge')+
  scale_x_discrete(limits = c("Turnaround Time", "Cost", "Unsure of Application",
                         "Not Useful"))+
  theme_bw()+
  labs(x= "Barriers", y = "Percent of Responses", 
                    title = "Barriers to Using Antimicrobial Susceptibility Testing")+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
  theme(strip.text.y = element_text(angle = 0))+
  theme(legend.position = "none")
            #ggsave('test.jpg', height = 11, width = 8.5)
            
#-------------------------------            
#create total count and proportion responses for barriers by grad year category (wide format)
Q15_1 <- grad_yr_revised %>%
group_by(grad_year_cat) %>%
summarise(total = sum(n()), 
          total_n_dist = n_distinct(rowid), 
          Q15_cost_ct = sum(Q15_cost), #can sum logical variable
          Q15_time_ct = sum(Q15_time), Q15_not_useful_ct = sum(Q15_not_useful),
          Q15_unsure_application_ct = sum(Q15_unsure_application))%>%
  ungroup()%>%
  mutate(pct_Q15_cost = Q15_cost_ct/total_n_dist, 
         pct_Q15_time = Q15_time_ct/total_n_dist,
         pct_Q15_not_useful = Q15_not_useful_ct/total_n_dist,
         pct_Q15_unsure_application = Q15_unsure_application_ct/total_n_dist)

#kable(Q15_1)
```

## Q17 Level of Confidence in Knowledge Related to Antimicrobial Use Areas
```{r echo=FALSE, message=FALSE, warning=FALSE}
#count and proportions for Q17 distribution

#Spectrum of activity
Q17_spectrum_filter <- AMU_Survey_Final %>% 
    filter(!(Q17_spectrum %in% 'Unknown'))

Q17_spectrum_ct <- data.table(tally( ~ Q17_spectrum , data = Q17_spectrum_filter))
Q17_spectrum_pct <- data.table(round(tally( ~ Q17_spectrum , data = Q17_spectrum_filter, format("proportion")),4))%>% 
    rename(pct = N)

Q17_spectrum <- merge.data.table(Q17_spectrum_ct, Q17_spectrum_pct) %>% 
    arrange(factor(Q17_spectrum, levels = c("Very confident", "Confident", "Low Confidence", "Not Applicable", "Unknown")))

Q17_spectrum <- Q17_spectrum %>% mutate(question="spectrum of activity") %>%
    rename(confidence=Q17_spectrum)

#kable(Q17_spectrum)

#Comparative efficacy of different antimicrobials
Q17_compare_efficacy_filter <- AMU_Survey_Final %>% 
    filter(!(Q17_compare_efficacy %in% 'Unknown'))

Q17_compare_efficacy_ct <- data.table(tally( ~ Q17_compare_efficacy , data = Q17_compare_efficacy_filter))
Q17_compare_efficacy_pct <- data.table(round(tally( ~ Q17_compare_efficacy , data = Q17_compare_efficacy_filter, format("proportion")),4))%>% 
    rename(pct = N)

Q17_compare_efficacy <- merge.data.table(Q17_compare_efficacy_ct, Q17_compare_efficacy_pct) %>% 
    arrange(factor(Q17_compare_efficacy, levels = c("Very confident", "Confident", "Low Confidence", "Not Applicable",
                                                    "Unknown")))

Q17_compare_efficacy <- Q17_compare_efficacy %>% mutate(question="comparative efficacy") %>%
    rename(confidence=Q17_compare_efficacy)

#kable(Q17_compare_efficacy)

#Combination therapy (e.g. synergism, antagonism)
Q17_combined_therapy_filter <- AMU_Survey_Final %>% 
    filter(!(Q17_combined_therapy %in% 'Unknown'))

Q17_combined_therapy_ct <- data.table(tally( ~ Q17_combined_therapy , data = Q17_combined_therapy_filter))
Q17_combined_therapy_pct <- data.table(round(tally( ~ Q17_combined_therapy , data = Q17_combined_therapy_filter,
    format("proportion")),4))%>% 
    rename(pct = N)

Q17_combined_therapy <- merge.data.table(Q17_combined_therapy_ct, Q17_combined_therapy_pct) %>% 
    arrange(factor(Q17_combined_therapy, levels = c("Very confident", "Confident", "Low Confidence", "Not Applicable", "Unknown")))

Q17_combined_therapy <- Q17_combined_therapy %>% mutate(question="combination therapy") %>%
    rename(confidence=Q17_combined_therapy)

#kable(Q17_combined_therapy)

#Antimicrobial susceptibility testing
Q17_AST_filter <- AMU_Survey_Final %>% 
    filter(!(Q17_AST %in% 'Unknown'))

Q17_AST_ct <- data.table(tally( ~ Q17_AST , data = Q17_AST_filter))
Q17_AST_pct <- data.table(round(tally( ~ Q17_AST , data = Q17_AST_filter, format("proportion")),4))%>% 
    rename(pct = N)

Q17_AST <- merge.data.table(Q17_AST_ct, Q17_AST_pct) %>% 
    arrange(factor(Q17_AST, levels = c("Very confident", "Confident", "Low Confidence", "Not Applicable", "Unknown")))

Q17_AST <- Q17_AST %>% mutate(question="AST") %>%
    rename(confidence=Q17_AST)

#kable(Q17_AST)

#Potential for resistance selection
Q17_resist_select_filter <- AMU_Survey_Final %>% 
    filter(!(Q17_resist_select %in% 'Unknown'))

Q17_resist_select_ct <- data.table(tally( ~ Q17_resist_select , data = Q17_resist_select_filter))
Q17_resist_select_pct <- data.table(round(tally( ~ Q17_resist_select , data = Q17_resist_select_filter,
    format("proportion")),4))%>% 
    rename(pct = N)

Q17_resist_select <- merge.data.table(Q17_resist_select_ct, Q17_resist_select_pct) %>% 
    arrange(factor(Q17_resist_select, levels = c("Very confident", "Confident", "Low Confidence", "Not Applicable", "Unknown")))

Q17_resist_select <- Q17_resist_select %>% mutate(question="resistence selection") %>%
    rename(confidence=Q17_resist_select)

#kable(Q17_resist_select)

#Effects of ancillary therapies (e.g. NSAIDs, steroids)
Q17_ancillary_therapy_filter <- AMU_Survey_Final %>% 
    filter(!(Q17_ancillary_therapy %in% 'Unknown'))

Q17_ancillary_therapy_ct <- data.table(tally( ~ Q17_ancillary_therapy , data = Q17_ancillary_therapy_filter))
Q17_ancillary_therapy_pct <- data.table(round(tally( ~ Q17_ancillary_therapy , data = Q17_ancillary_therapy_filter,
    format("proportion")),4))%>% 
    rename(pct = N)

Q17_ancillary_therapy <- merge.data.table(Q17_ancillary_therapy_ct, Q17_ancillary_therapy_pct) %>% 
    arrange(factor(Q17_ancillary_therapy, levels = c("Very confident", "Confident", "Low Confidence", "Not Applicable",
                                                     "Unknown")))

Q17_ancillary_therapy <- Q17_ancillary_therapy %>% mutate(question="ancillary therapies") %>%
    rename(confidence=Q17_ancillary_therapy)

#kable(Q17_ancillary_therapy)

#Post treatment intervals for single injection antimicrobials
Q17_post_treat_interval_filter <- AMU_Survey_Final %>% 
    filter(!(Q17_post_treat_interval %in% 'Unknown'))

Q17_post_treat_interval_ct <- data.table(tally( ~ Q17_post_treat_interval , data = Q17_post_treat_interval_filter))
Q17_post_treat_interval_pct <- data.table(round(tally( ~ Q17_post_treat_interval , data = Q17_post_treat_interval_filter, format("proportion")),4))%>% 
    rename(pct = N)

Q17_post_treat_interval <- merge.data.table(Q17_post_treat_interval_ct, Q17_post_treat_interval_pct) %>% 
    arrange(factor(Q17_post_treat_interval, levels = c("Very confident", "Confident", "Low Confidence", "Not Applicable",
                                                       "Unknown")))

Q17_post_treat_interval <- Q17_post_treat_interval %>% mutate(question="post treatment intervals") %>%
    rename(confidence=Q17_post_treat_interval)

#kable(Q17_post_treat_interval)

#Duration of therapy for antimicrobials requiring multiple administrations
Q17_duration_therapy_filter <- AMU_Survey_Final %>% 
    filter(!(Q17_duration_therapy %in% 'Unknown'))

Q17_duration_therapy_ct <- data.table(tally( ~ Q17_duration_therapy , data = Q17_duration_therapy_filter))
Q17_duration_therapy_pct <- data.table(round(tally( ~ Q17_duration_therapy , data = Q17_duration_therapy_filter,
    format("proportion")),4))%>% 
    rename(pct = N)

Q17_duration_therapy <- merge.data.table(Q17_duration_therapy_ct, Q17_duration_therapy_pct) %>% 
    arrange(factor(Q17_duration_therapy, levels = c("Very confident", "Confident", "Low Confidence", "Not Applicable",
                                                    "Unknown")))

Q17_duration_therapy <- Q17_duration_therapy %>% mutate(question="duration of therapy") %>%
    rename(confidence=Q17_duration_therapy)

#kable(Q17_duration_therapy)

#Expected treatment outcomes for common infectious diseases
Q17_treatment_outcome_filter <- AMU_Survey_Final %>% 
    filter(!(Q17_treatment_outcome %in% 'Unknown'))

Q17_treatment_outcome_ct <- data.table(tally( ~ Q17_treatment_outcome , data = Q17_treatment_outcome_filter))
Q17_treatment_outcome_pct <- data.table(round(tally( ~ Q17_treatment_outcome , data = Q17_treatment_outcome_filter, format("proportion")),4))%>% 
    rename(pct = N)

Q17_treatment_outcome <- merge.data.table(Q17_treatment_outcome_ct, Q17_treatment_outcome_pct) %>% 
    arrange(factor(Q17_treatment_outcome, levels = c("Very confident", "Confident", "Low Confidence", "Not Applicable", "Unknown")))

Q17_treatment_outcome <- Q17_treatment_outcome %>% mutate(question="expected treatment outcomes") %>%
    rename(confidence=Q17_treatment_outcome)

#kable(Q17_treatment_outcome)

#----------------------------
#Create a combined table for all parts of question 17

table_Q17 <- rbind.data.frame(Q17_spectrum, Q17_compare_efficacy, Q17_combined_therapy, Q17_AST, Q17_resist_select, Q17_ancillary_therapy, Q17_post_treat_interval, Q17_duration_therapy, Q17_treatment_outcome)

table_Q17 <- table_Q17 %>% 
  select(question, confidence, N, pct)

#kable(table_Q17)

table_Q17b <-  table_Q17 %>% 
  select(-pct) %>% 
  pivot_wider(names_from = confidence, values_from = N) %>% 
  select(question, "Not Applicable", "Low Confidence", "Confident", "Very confident") %>% 
  arrange(desc(Confident))

table_Q17b[is.na(table_Q17b)] <- 0

kable(table_Q17b)

table_Q17c <-  table_Q17 %>% 
  select(-N) %>% 
  pivot_wider(names_from = confidence, values_from = pct) %>% 
  select(question, "Not Applicable", "Low Confidence", "Confident", "Very confident") %>% 
  arrange(desc(Confident))

table_Q17c[is.na(table_Q17c)] <- 0

kable(table_Q17c)

table_Q17_pct <- table_Q17 %>% 
  mutate(Percent = pct*100)

#---------------------------
table_Q17 <- table_Q17 %>% 
  mutate(question=fct_relevel(question, c("expected treatment outcomes", "comparative efficacy", "spectrum of activity", 
"duration of therapy", "ancillary therapies", "post treatment intervals", "AST", "resistence selection", "combination therapy"))) %>% 
   mutate(confidence=fct_relevel(confidence, c("Not Applicable", "Low Confidence", "Confident",  "Very confident", "Unknown")))

ggplot(table_Q17)+
  geom_bar(aes(x = confidence, y = pct, 
               ),
               stat = 'identity', fill = "#482677FF", position = 'dodge')+
               facet_grid(factor(question)~., scales = 'fixed')+
               scale_x_discrete(labels = c('Not Applicable','Low Confidence','Confident', 'Very Confident'))+
               scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
               theme_bw()+
               labs(x= "Confidence", y = "Percent of Responses", 
                     title = "Confidence in Knowledge Areas Related to Antimicrbial Use in Food Animals")+
               theme(strip.text.y = element_text(angle = 0))+
               theme(legend.position = "none")
            #ggsave('table_Q17e.jpg', height = 11, width = 8.5)
            
            #facet_grid(factor(question)~., scales = 'fixed', switch = "y")
            #theme(strip.text.y.left = element_text(angle = 0))

table_Q17d <- table_Q17 %>% 
    mutate(category=case_when(
    (question %in% c("spectrum of activity", "AST", "resistence selection")) >0~ "resistence",
    (question %in% c("combination therapy", "ancillary therapies", "post treatment intervals", "duration of therapy")) >0~ "regimen selection", 
    (question %in% c("comparative efficacy", "expected treatment outcomes")) >0~ "effectiveness",
    TRUE ~ "Unknown"
  ))

#ggplot(table_Q17d) +
  #geom_count(aes(x = confidence, y = question, color=category, size=N)) 

table_Q17_pct <- table_Q17_pct %>%
  mutate(confidence = recode(confidence, "Very confident"= "Very Confident"))

table_Q17_pct <- table_Q17_pct %>% 
  mutate(question=fct_relevel(question, c("expected treatment outcomes", "comparative efficacy", "spectrum of activity", 
"duration of therapy", "ancillary therapies", "post treatment intervals", "AST", "resistence selection", "combination therapy"))) %>% 
   mutate(confidence=fct_relevel(confidence, c("Not Applicable", "Low Confidence", "Confident",  "Very Confident", "Unknown")))



ggplot(table_Q17_pct) +
  geom_point(aes(x = confidence, y = question, size=Percent), color = 'orange')+
  geom_text(aes(x = confidence, y = question, 
                label=paste0(round(pct*100, digits = 0))), 
            hjust = 0, vjust = 1)+
  theme_bw()+
  guides(fill=guide_legend(title="New Legend Title"))+
  scale_x_discrete(limits = c('Not Applicable','Low Confidence','Confident', 'Very Confident'))+
  scale_y_discrete(limits = c("combination therapy", "resistence selection", "AST", 
      "post treatment intervals", "ancillary therapies", "duration of therapy", 
      "spectrum of activity", "comparative efficacy", "expected treatment outcomes"))+
  labs(x= "Confidence", 
                    title = "Confidence in Knowledge Areas Related
    to Antimicrbial Use in Food Animals", size="Percent of Responses")+
  theme(axis.title.y = element_blank())



```

## Q18 Interest in Certificate Program
```{r echo=FALSE, warning=FALSE}
#count and proportions for certificate program interest
certificate_program_ct <- data.table(tally( ~ certificate_program , data = AMU_Survey_Final))
certificate_program_pct <- data.table(round(tally( ~ certificate_program , data = AMU_Survey_Final, format("proportion")),4))%>% 
    rename(pct = N)

certificate_program <- merge.data.table(certificate_program_ct, certificate_program_pct) %>% 
    arrange(factor(certificate_program, levels = c("No", "10 hrs","20 hrs", "40 hrs", "NA")))
kable(certificate_program)

#-----------------------------------
#reorder certificate hours
certificate_program <- certificate_program %>% 
  mutate(certificate_program=fct_relevel(certificate_program,c("No", "10 hrs","20 hrs", "40 hrs", "NA")))

#bar chart for certificate program interest
ggplot(certificate_program)+
  geom_bar(aes(x = certificate_program, y = pct, 
               fill = factor(certificate_program)),
           stat = 'identity', position = 'dodge', fill = "#238A8DFF")+
  theme_bw()+
  labs(x= "Hours", y = "Percent of Responses", 
                    title = "Certificate Program Interest")+
  scale_x_discrete(labels = c("No", "10", "20", "40"))+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
  theme(strip.text.y = element_text(angle = 0))+
  theme(legend.position = "none")
           #ggsave('test.jpg', height = 11, width = 8.5)
           
#-----------------------------------
#Add graduate year category
certificate_grad_ct <- data.table(tally(certificate_program ~ grad_year_cat , data = grad_yr_revised))
certificate_grad_pct <- data.table(round(tally(certificate_program ~ grad_year_cat , data = grad_yr_revised, format("proportion")),4)) %>% 
    rename(pct = N)                          

certificate_grad <- merge.data.table(certificate_grad_ct, certificate_grad_pct)%>%      
  filter(!(grad_year_cat %in% 'Unknown')) %>% 
    arrange(factor(certificate_program, levels = c("No", "10 hrs","20 hrs", "40 hrs", "NA"))) %>% 
    arrange(factor(grad_year_cat, levels = c("<1987", "1987-1999", "2000-2010", "2011-2016", ">2016")))

certificate_grad <- certificate_grad %>% 
  select(grad_year_cat, certificate_program, N, pct)

#kable(certificate_grad)

certificate_gradb <-  certificate_grad %>% 
  select(-pct) %>% 
  pivot_wider(names_from = certificate_program, values_from = N)

kable(certificate_gradb)

certificate_gradc <-  certificate_grad %>% 
  select(-N) %>% 
  pivot_wider(names_from = certificate_program, values_from =pct)

kable(certificate_gradc)

#-----------------------------------
#Reorder Q18 answers
AMU_Survey_Final <- AMU_Survey_Final %>% 
  mutate(certificate_program=fct_relevel(certificate_program,c("No", "10 hrs","20 hrs", "40 hrs", "NA")))

#kable(table(AMU_Survey_Final$grad_year_cat, AMU_Survey_Final$certificate_program)) 

#-----------------------------------
#reorder certificate hours
certificate_grad <- certificate_grad %>% 
  mutate(certificate_program=fct_relevel(certificate_program,c("No", "10 hrs","20 hrs", "40 hrs", "NA"))) %>%   mutate(grad_year_cat=fct_relevel(grad_year_cat,c("<1987", "1987-1999", "2000-2010", "2011-2016", ">2016")))

certificate_grad_pct <- certificate_grad %>% 
  mutate(Percent = pct*100)

#bar chart for certificate program interest by grad year category
ggplot(certificate_grad)+
  geom_bar(aes(x = certificate_program, y = pct, 
               fill = factor(grad_year_cat)),
               stat = 'identity', position = 'dodge', fill = "#453781FF")+
  facet_grid(factor(grad_year_cat)~., scales = 'fixed')+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
  scale_x_discrete(labels = c("No", "10", "20", "40"))+
  theme_bw()+
  labs(x= "Hours", y = "Percent of Responses", 
                     title = "Certificate Program Interest")+
  theme(strip.text.y = element_text(angle = 0))+
  theme(legend.position = "none")
            ##ggsave('test.jpg', height = 11, width = 8.5)


ggplot(certificate_grad_pct) +
  geom_point(aes(x = certificate_program, y = grad_year_cat , size=Percent), color = 'orange')+
  geom_text(aes(x = certificate_program, y = grad_year_cat , 
                label=paste0(round(pct*100, digits = 0))), 
            hjust = 0, vjust = 1)+
  theme_bw()+
  labs(x= "Hours", y= "Graduation Year", title = "Certificate Program Interest", size= "Percent of Responses")+
  scale_y_discrete(limits = c(">2016","2011-2016", "2000-2010", "1987-1999", "<1987"))+
  scale_x_discrete(labels = c("No", "10", "20", "40"))+
  theme(axis.title.y = element_blank())
```

## Q19 Concern About AMR as Problem for Antimicrobial Efficacy in Treatment, Prevention, and Control of Livestock Diseases
```{r echo=FALSE}
#count and proportions for AMR for antimicrobial efficacy in treatment, prevention, and control of livestock diseases
Q19_ct <- data.table(tally( ~ Q19 , data = AMU_Survey_Final))
Q19_pct <- data.table(round(tally( ~ Q19 , data = AMU_Survey_Final, format("proportion")),4))%>% 
    rename(pct = N)

Q19 <- merge.data.table(Q19_ct, Q19_pct) %>% 
    arrange(factor(Q19, levels = c("None", "Slight","Moderate", "Significant")))

Q19 <- Q19 %>% mutate(question="AMR efficacy livestock diseases") %>%
    rename(concern=Q19)

#kable(Q19)

#Add practice type
Q19_prac_ct <- data.table(tally(Q19 ~ practice_type , data = AMU_Survey_Final))
Q19_prac_pct <- data.table(round(tally(Q19 ~ practice_type , data = AMU_Survey_Final, format("proportion")),4))%>% 
    rename(pct = N)

Q19_prac <- merge.data.table(Q19_prac_ct, Q19_prac_pct) %>% 
    arrange(factor(Q19, levels = c("None", "Slight","Moderate", "Significant")))

Q19_prac <- Q19_prac %>% mutate(question="AMR efficacy livestock diseases") %>%
    rename(concern=Q19) %>% 
    arrange(factor(practice_type, levels = c("Private General Practice", "Food Animal Practice", "Consultant", 
                                     "Staff Vet", "Academia", "None")))

#kable(Q19_prac)

#Add grad year
Q19_grad_ct <- data.table(tally( ~ Q19 | grad_year_cat, data = grad_yr_revised))
Q19_grad_pct <- data.table(round(tally( ~ Q19 | grad_year_cat, data = grad_yr_revised, format("proportion")),4))%>% 
    rename(pct = N)

Q19_grad <- merge.data.table(Q19_grad_ct, Q19_grad_pct) %>% 
    arrange(factor(Q19, levels = c("None", "Slight","Moderate", "Significant")))

Q19_grad <- Q19_grad %>% mutate(question="AMR efficacy livestock diseases") %>%
    rename(concern=Q19) %>% 
    arrange(factor(grad_year_cat, levels = c("<1987", "1987-1999", "2000-2010", "2011-2016", ">2016")))

#kable(Q19_grad)

#Reorder Q19 answers
AMU_Survey_Final <- AMU_Survey_Final %>% 
  mutate(Q19=fct_relevel(Q19,c("None", "Slight","Moderate", "Significant")))

#kable(table(AMU_Survey_Final$practice_type, AMU_Survey_Final$Q19))

#-------------------------------
#reorder concern level
#Q19 <- Q19 %>% 
  #mutate(Q19=fct_relevel(Q19,c("None", "Slight","Moderate", "Significant")))

#bar chart for Q19 answers
#ggplot(Q19)+
  #geom_bar(aes(x = Q19, y = pct, 
               #fill = factor(Q19)),
           #stat = 'identity', position = 'dodge')
           #ggsave('test.jpg', height = 11, width = 8.5)
```

## Q20 Concern About AMR in Livestock to Treat Bacterial Infections in Humans
```{r echo=FALSE}
#count and proportions for AMR for ability to treat bacterial infectious disease in humans
Q20_ct <- data.table(tally( ~ Q20 , data = AMU_Survey_Final))
Q20_pct <- data.table(round(tally( ~ Q20 , data = AMU_Survey_Final, format("proportion")),4))%>% 
    rename(pct = N)

Q20 <- merge.data.table(Q20_ct, Q20_pct) %>% 
    arrange(factor(Q20, levels = c("None", "Slight","Moderate", "Significant")))

Q20 <- Q20 %>% mutate(question="AMR in livestock to treat human diseases") %>%
    rename(concern=Q20)

#kable(Q20)

#Add practice type
Q20_prac_ct <- data.table(tally( Q20 ~ practice_type, data = AMU_Survey_Final))
Q20_prac_pct <- data.table(round(tally( Q20 ~ practice_type , data = AMU_Survey_Final, format("proportion")),4))%>% 
    rename(pct = N)

Q20_prac <- merge.data.table(Q20_prac_ct, Q20_prac_pct) %>% 
    arrange(factor(Q20, levels = c("None", "Slight","Moderate", "Significant")))

Q20_prac <- Q20_prac %>% mutate(question="AMR in livestock to treat human diseases") %>%
    rename(concern=Q20) %>% 
    arrange(factor(practice_type, levels = c("Private General Practice", "Food Animal Practice", "Consultant", 
                                     "Staff Vet", "Academia", "None")))

#kable(Q20_prac)

#Add grad year
Q20_grad_ct <- data.table(tally( ~ Q20 | grad_year_cat, data = grad_yr_revised))
Q20_grad_pct <- data.table(round(tally( ~ Q20 | grad_year_cat, data = grad_yr_revised, format("proportion")),4))%>% 
    rename(pct = N)

Q20_grad <- merge.data.table(Q20_grad_ct, Q20_grad_pct) %>% 
    arrange(factor(Q20, levels = c("None", "Slight","Moderate", "Significant")))

Q20_grad <- Q20_grad %>% mutate(question="AMR in livestock to treat human diseases") %>%
    rename(concern=Q20) %>% 
    arrange(factor(grad_year_cat, levels = c("<1987", "1987-1999", "2000-2010", "2011-2016", ">2016")))

#kable(Q20_grad)

#Reorder Q20 answers
AMU_Survey_Final <- AMU_Survey_Final %>% 
  mutate(Q20=fct_relevel(Q20,c("None", "Slight","Moderate", "Significant")))

#kable(table(AMU_Survey_Final$practice_type, AMU_Survey_Final$Q20))
```

## Q19-Q20 Concern About AMR Combined 
```{r echo=FALSE}
#Create a combined table for question 19-20
table_AMR <- rbind.data.frame(Q19, Q20)

table_AMR <- table_AMR %>% 
  select(question, concern, N, pct)

#kable(table_AMR)

table_AMRb <- table_AMR %>% 
  select(-pct) %>% 
  pivot_wider(names_from = concern, values_from = N)

kable(table_AMRb)

table_AMRc <-  table_AMR %>% 
  select(-N) %>% 
  pivot_wider(names_from = concern, values_from =pct)

kable(table_AMRc)

#reorder concern level
table_AMR <- table_AMR %>% 
  mutate(concern=fct_relevel(concern,c("None", "Slight","Moderate", "Significant")))

#bar chart for Q19-20 answers
ggplot(table_AMR)+
  geom_bar(aes(x = concern, y = pct, 
               fill = factor(question)),
               stat = 'identity', position = 'dodge', fill = "#55C667FF")+
  facet_grid(factor(question)~., scales = 'fixed')+
  theme_bw()+
  labs(x= "Level of Concern", y = "Percent of Responses", 
                    title = "")+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
  theme(strip.text.y = element_text(angle = 0))+
  theme(legend.position = "none")
           #ggsave('test.jpg', height = 11, width = 8.5)
           
#Create a combined table for question 19-20 by practice type
table_AMR_prac <- rbind.data.frame(Q19_prac, Q20_prac)

table_AMR_prac <- table_AMR_prac %>% 
  select(practice_type, question, concern, N, pct)

#kable(table_AMR_prac)
           
#reorder concern and practice type
table_AMR_prac <- table_AMR_prac %>% 
  mutate(concern=fct_relevel(concern,c("None", "Slight","Moderate", "Significant"))) %>% 
  mutate(practice_type=fct_relevel(practice_type,c("Private General Practice", "Food Animal Practice",
                                                   "Consultant", "Staff Vet", "Academia", "None")))

#bar chart for Q19-20 by practice type
#ggplot(table_AMR_prac)+
  #geom_bar(aes(x = concern, y = pct, 
               #fill = factor(question)),
               #stat = 'identity', position = 'dodge')+
               #facet_grid(factor(practice_type)~., scales = 'free')+
               #theme(axis.text.x = element_text(angle = 45, hjust = 1))
               #ggsave('test.jpg', height = 11, width = 8.5)

#Create a combined table for question 19-20 by grad year category
table_AMR_grad <- rbind.data.frame(Q19_grad, Q20_grad)

table_AMR_grad <- table_AMR_grad %>% 
  filter(!(grad_year_cat %in% 'Unknown')) %>% 
  select(grad_year_cat, question, concern, N, pct)

#kable(table_AMR_grad)
           
#reorder for Q19-20 and grad year
table_AMR_grad <- table_AMR_grad %>% 
  mutate(concern=fct_relevel(concern,c("None", "Slight","Moderate", "Significant"))) %>% 
  mutate(grad_year_cat=fct_relevel(grad_year_cat,c("<1987", "1987-1999", "2000-2010", "2011-2016", ">2016")))


#bar chart for Q19-20 by grad year category
#ggplot(table_AMR_grad)+
  #geom_bar(aes(x = concern, y = pct, 
               #fill = factor(question)),
               #stat = 'identity', position = 'dodge')+
               #facet_grid(factor(grad_year_cat)~., scales = 'free')
            #ggsave('test.jpg', height = 11, width = 8.5)
```

## Q21 Client with good working relation requests antimicrobial for prevention and control of disease. How willing are you to take the risk of not authorizing continued use?
```{r echo=FALSE}
##Filter out Owner and Staff vets (displayed as Unknowns)
Q21_filter <- AMU_Survey_Final %>%
  filter(!(Q21_antimicrobial_discontinue_old_client %in% 'Unknown'))

Q21_filter_grad_yr <- Q21_filter %>%
  filter(!(grad_year_cat %in% 'Unknown'))

#count and proportions
Q21_antimicrobial_discontinue_old_client_ct <- data.table(tally( ~ Q21_antimicrobial_discontinue_old_client , 
    data = Q21_filter))
Q21_antimicrobial_discontinue_old_client_pct <- data.table(round(tally( ~ Q21_antimicrobial_discontinue_old_client , 
    data = Q21_filter, format("proportion")),4))%>% 
    rename(pct = N)

Q21_antimicrobial_discontinue_old_client <- merge.data.table(Q21_antimicrobial_discontinue_old_client_ct,
    Q21_antimicrobial_discontinue_old_client_pct) %>% 
    arrange(factor(Q21_antimicrobial_discontinue_old_client, levels = c("Unwilling","Willing but concerned",
    "Willing without hesitation"))) %>% 
    filter(!(Q21_antimicrobial_discontinue_old_client %in% 'Unknown'))

kable(Q21_antimicrobial_discontinue_old_client)

#----------------------------------------
#reorder for Q21 
Q21_antimicrobial_discontinue_old_client <- Q21_antimicrobial_discontinue_old_client %>% 
  mutate(Q21_antimicrobial_discontinue_old_client=fct_relevel(Q21_antimicrobial_discontinue_old_client,c("Unwilling","Willing but concerned","Willing without hesitation")))

#bar chart for Q21
ggplot(Q21_antimicrobial_discontinue_old_client)+
  geom_bar(aes(x = Q21_antimicrobial_discontinue_old_client, y = pct, 
               fill = factor(Q21_antimicrobial_discontinue_old_client)),
               stat = 'identity', position = 'dodge', fill = "#29AF7FFF")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  theme_bw()+
  labs(x= "Willingness", y = "Percent of Responses", 
                    title = "Risk of Not Authorizing Continued Antimicrobial Use 
       for Client with Good Working Relation")+
   scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
  theme(strip.text.y = element_text(angle = 0))+
  theme(legend.position = "none")
            #ggsave('test.jpg', height = 11, width = 8.5)
#----------------------------------------

#Add graduate year category
Q21_antimicrobial_discontinue_old_client_yr_ct <- data.table(tally( ~ Q21_antimicrobial_discontinue_old_client | grad_year_cat ,
    data = Q21_filter_grad_yr))
Q21_antimicrobial_discontinue_old_client_yr_pct <- data.table(round(tally( ~ Q21_antimicrobial_discontinue_old_client | grad_year_cat , data = Q21_filter_grad_yr, format("proportion")),4))%>% 
    rename(pct = N)

Q21_antimicrobial_discontinue_old_client_yr <- merge.data.table(Q21_antimicrobial_discontinue_old_client_yr_ct,
    Q21_antimicrobial_discontinue_old_client_yr_pct) %>% 
    arrange(factor(Q21_antimicrobial_discontinue_old_client, levels = c("Unwilling","Willing but concerned",
    "Willing without hesitation"))) %>% 
    arrange(factor(grad_year_cat, levels = c("<1987", "1987-1999", "2000-2010", "2011-2016", ">2016"))) %>%
    filter(!(Q21_antimicrobial_discontinue_old_client %in% 'Unknown'))

Q21_antimicrobial_discontinue_old_client_yr <- Q21_antimicrobial_discontinue_old_client_yr %>% 
  filter(!(grad_year_cat %in% 'Unknown')) %>% 
  select(grad_year_cat, Q21_antimicrobial_discontinue_old_client, N, pct)

#kable(Q21_antimicrobial_discontinue_old_client_yr)

#Reorder Q21 answers
AMU_Survey_Final <-AMU_Survey_Final %>% 
  mutate(Q21_antimicrobial_discontinue_old_client=fct_relevel(Q21_antimicrobial_discontinue_old_client,c("Unwilling","Willing but concerned","Willing without hesitation")))

#kable(table(AMU_Survey_Final$grad_year_cat, AMU_Survey_Final$Q21_antimicrobial_discontinue_old_client))

Q21_antimicrobial_discontinue_old_client_yrb <-  Q21_antimicrobial_discontinue_old_client_yr %>% 
  select(-pct) %>% 
  pivot_wider(names_from = Q21_antimicrobial_discontinue_old_client, values_from = N) #%>% 
  #arrange(desc(Major))

kable(Q21_antimicrobial_discontinue_old_client_yrb)

Q21_antimicrobial_discontinue_old_client_yrc <-  Q21_antimicrobial_discontinue_old_client_yr %>% 
  select(-N) %>% 
  pivot_wider(names_from = Q21_antimicrobial_discontinue_old_client, values_from =pct) #%>% 
  #arrange(desc(Major))

kable(Q21_antimicrobial_discontinue_old_client_yrc)

#----------------------------------------
#reorder for Q21 and grad year
Q21_antimicrobial_discontinue_old_client_yr <- Q21_antimicrobial_discontinue_old_client_yr %>% 
  mutate(Q21_antimicrobial_discontinue_old_client=fct_relevel(Q21_antimicrobial_discontinue_old_client,c("Unwilling","Willing but concerned","Willing without hesitation"))) %>%   mutate(grad_year_cat=fct_relevel(grad_year_cat,c("<1987", "1987-1999", "2000-2010", "2011-2016", ">2016")))

#bar chart for Q21 by grad year category
ggplot(Q21_antimicrobial_discontinue_old_client_yr)+
  geom_bar(aes(x = Q21_antimicrobial_discontinue_old_client, y = pct, 
               fill = factor(grad_year_cat)),
               stat = 'identity', position = 'dodge', fill = "#73D055FF")+
  facet_grid(factor(grad_year_cat)~., scales = 'fixed')+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  theme_bw()+
  labs(x= "Willingness", y = "Percent of Responses", 
                    title = "Risk of Not Authorizing Continued Antimicrobial Use 
       for Client with Good Working Relation")+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
  theme(strip.text.y = element_text(angle = 0))+
  theme(legend.position = "none")
            #ggsave('test.jpg', height = 11, width = 8.5)

Q21_antimicrobial_discontinue_old_client_yr_pct <- Q21_antimicrobial_discontinue_old_client_yr %>% 
  mutate(Percent = 100*pct)

ggplot(Q21_antimicrobial_discontinue_old_client_yr_pct) +
  geom_point(aes(x = Q21_antimicrobial_discontinue_old_client, y = grad_year_cat, size= Percent), color = 'orange')+
  geom_text(aes(x = Q21_antimicrobial_discontinue_old_client, y = grad_year_cat, 
                label=paste0(round(pct*100, digits = 0))), 
            hjust = 0, vjust = 1)+
  theme_bw()+
  labs(x= "Willingness", y = "Graduation Year", 
                    title = "Risk of Not Authorizing Continued Antimicrobial Use 
       for Client with Good Working Relation", size = "Percent of Responses")+
  scale_y_discrete(limits = c(">2016", "2011-2016", "2000-2010", "1987-1999", "<1987"))
  #scale_x_discrete(labels = c('Not Considered','Very Minor Component',
                                           #'Important Component', 'Major Component'))
```

## Q22 Client with good working relation requests antimicrobial for prevention and control of disease. Risk percieved to relationship if signifcant spike in morbidity or mortality. 
```{r echo=FALSE}
##Filter out Owner and Staff vets (displayed as Unknowns)
#Q22_filter <- AMU_Survey_Final %>%
  #filter(!(Q22_risk_relation_morbidity_spike_old_client %in% ""))

#count and proportions 
Q22_risk_relation_morbidity_spike_old_client_ct <- data.table(tally( ~ Q22_risk_relation_morbidity_spike_old_client , 
    data = Q21_filter))
Q22_risk_relation_morbidity_spike_old_client_pct <- data.table(round(tally( ~ Q22_risk_relation_morbidity_spike_old_client , 
    data = Q21_filter, format("proportion")),4))%>% 
    rename(pct = N)

Q22_risk_relation_morbidity_spike_old_client <- merge.data.table(Q22_risk_relation_morbidity_spike_old_client_ct,
    Q22_risk_relation_morbidity_spike_old_client_pct) %>% 
    arrange(factor(Q22_risk_relation_morbidity_spike_old_client, levels = c("No risk", "Slight risk", 
    "Moderate risk", "High risk" )))

Q22_risk_relation_morbidity_spike_old_client <- Q22_risk_relation_morbidity_spike_old_client %>% mutate(question="morbidity spike with old client") %>%
    rename(risk=Q22_risk_relation_morbidity_spike_old_client)

#kable(Q22_risk_relation_morbidity_spike_old_client)

#Add graduate year category
Q22_risk_relation_morbidity_spike_old_client_yr_ct <- data.table(tally( ~ 
    Q22_risk_relation_morbidity_spike_old_client | grad_year_cat , data = Q21_filter_grad_yr))
Q22_risk_relation_morbidity_spike_old_client_yr_pct <- data.table(round(tally( ~ 
    Q22_risk_relation_morbidity_spike_old_client | grad_year_cat , data = Q21_filter_grad_yr, format("proportion")),4))%>% 
    rename(pct = N)

Q22_risk_relation_morbidity_spike_old_client_yr <- merge.data.table(Q22_risk_relation_morbidity_spike_old_client_yr_ct,
    Q22_risk_relation_morbidity_spike_old_client_yr_pct) %>% 
    arrange(factor(Q22_risk_relation_morbidity_spike_old_client, levels = c("No risk", "Slight risk", 
    "Moderate risk", "High risk" ))) %>% 
    arrange(factor(grad_year_cat, levels = c("<1987", "1987-1999", "2000-2010", "2011-2016", ">2016")))

Q22_risk_relation_morbidity_spike_old_client_yr <- Q22_risk_relation_morbidity_spike_old_client_yr %>% mutate(question="morbidity spike with old client") %>%
    rename(risk=Q22_risk_relation_morbidity_spike_old_client)

#kable(Q22_risk_relation_morbidity_spike_old_client_yr)

#Reorder Q22 answers
AMU_Survey_Final <- AMU_Survey_Final %>% 
  mutate(Q22_risk_relation_morbidity_spike_old_client=fct_relevel(Q22_risk_relation_morbidity_spike_old_client,c("No risk", "Slight risk", "Moderate risk", "High risk" )))

#kable(table(AMU_Survey_Final$grad_year_cat, AMU_Survey_Final$Q22_risk_relation_morbidity_spike_old_client))
```

## Q23 New client requests antimicrobial for prevention and control of disease. Risk percieved to relationship if signifcant spike in morbidity or mortality. 
```{r echo=FALSE}
##Filter out Owner and Staff vets (displayed as Unknowns)
#Q23_filter <- AMU_Survey_Final %>%
  #filter(!(Q23_risk_relation_morbidity_spike_new_client %in% 'Unknown'))

#count and proportions 
Q23_risk_relation_morbidity_spike_new_client_ct <- data.table(tally( ~ Q23_risk_relation_morbidity_spike_new_client , 
    data = Q21_filter))
Q23_risk_relation_morbidity_spike_new_client_pct <- data.table(round(tally( ~ Q23_risk_relation_morbidity_spike_new_client , 
    data = Q21_filter, format("proportion")),4))%>% 
    rename(pct = N)

Q23_risk_relation_morbidity_spike_new_client <- merge.data.table(Q23_risk_relation_morbidity_spike_new_client_ct,
    Q23_risk_relation_morbidity_spike_new_client_pct) %>% 
    arrange(factor(Q23_risk_relation_morbidity_spike_new_client, levels = c("No risk", "Slight risk", 
    "Moderate risk", "High risk" )))

Q23_risk_relation_morbidity_spike_new_client <- Q23_risk_relation_morbidity_spike_new_client %>% mutate(question="morbidity spike with new client") %>%
    rename(risk=Q23_risk_relation_morbidity_spike_new_client)

#kable(Q23_risk_relation_morbidity_spike_new_client)

#Add graduate year category
Q23_risk_relation_morbidity_spike_new_client_yr_ct <- data.table(tally( ~ 
    Q23_risk_relation_morbidity_spike_new_client | grad_year_cat, data = Q21_filter_grad_yr))
Q23_risk_relation_morbidity_spike_new_client_yr_pct <- data.table(round(tally( ~
    Q23_risk_relation_morbidity_spike_new_client | grad_year_cat , data = Q21_filter_grad_yr, format("proportion")),4))%>% 
    rename(pct = N)

Q23_risk_relation_morbidity_spike_new_client_yr <- merge.data.table(Q23_risk_relation_morbidity_spike_new_client_yr_ct,
    Q23_risk_relation_morbidity_spike_new_client_yr_pct) %>% 
    arrange(factor(Q23_risk_relation_morbidity_spike_new_client, levels = c("No risk", "Slight risk", 
    "Moderate risk", "High risk" ))) %>% 
    arrange(factor(grad_year_cat, levels = c("<1987", "1987-1999", "2000-2010", "2011-2016", ">2016")))

Q23_risk_relation_morbidity_spike_new_client_yr <- Q23_risk_relation_morbidity_spike_new_client_yr %>% 
  mutate(question="morbidity spike with new client") %>%
    rename(risk=Q23_risk_relation_morbidity_spike_new_client)

#kable(Q23_risk_relation_morbidity_spike_new_client_yr)

#Reorder Q23 answers
AMU_Survey_Final <- AMU_Survey_Final %>% 
  mutate(Q23_risk_relation_morbidity_spike_new_client=fct_relevel(Q23_risk_relation_morbidity_spike_new_client,c("No risk", "Slight risk", "Moderate risk", "High risk" )))

#kable(table(AMU_Survey_Final$grad_year_cat, AMU_Survey_Final$Q23_risk_relation_morbidity_spike_new_client))
```

## Q22-Q23 Precieved Risk to Relationship with Discontinued Antimicrobial Regimen Combined 
```{r echo=FALSE, warning=FALSE}
#Create a combined table for question 22-23
table_risk <- rbind.data.frame(Q22_risk_relation_morbidity_spike_old_client, Q23_risk_relation_morbidity_spike_new_client)

table_risk <- table_risk %>% 
  select(question, risk, N, pct)

#kable(table_risk)

table_riskb <-  table_risk %>% 
  select(-pct) %>% 
  pivot_wider(names_from = risk, values_from = N) 

kable(table_riskb)

table_riskc <-  table_risk %>% 
  select(-N) %>% 
  pivot_wider(names_from = risk, values_from =pct) 

kable(table_riskc)


#reorder risk level
table_risk <- table_risk %>% 
  mutate(risk=fct_relevel(risk,c("No risk", "Slight risk", "Moderate risk", "High risk" ))) %>% 
  mutate(question=fct_relevel(question,c("morbidity spike with old client", "morbidity spike with new client" )))

#bar chart for Q22-23 answers
ggplot(table_risk)+
  geom_bar(aes(x = risk, y = pct, 
               fill = factor(question)),
              stat = 'identity', position = 'dodge', fill = "#39568CFF")+
  facet_grid(factor(question)~., scales = 'fixed')+
  theme_bw()+
  labs(x= "Level of Risk", y = "Percent of Responses", 
                    title = "Risk to Relationship with Client due to Morbidity Spike 
       after Disconinued Antimicrobial Use")+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
  theme(strip.text.y = element_text(angle = 0))+
  theme(legend.position = "none")
           #ggsave('test.jpg', height = 11, width = 8.5)
           
#Create a combined table for question 22-23 by grad year category
table_risk_yr <- rbind.data.frame(Q22_risk_relation_morbidity_spike_old_client_yr, Q23_risk_relation_morbidity_spike_new_client_yr)

table_risk_yr <- table_risk_yr %>% 
  filter(!(grad_year_cat %in% 'Unknown')) %>% 
  select(grad_year_cat, question, risk, N, pct)

#kable(table_risk_yr)

table_risk_yrb <-  table_risk_yr %>% 
  select(-pct) %>% 
  pivot_wider(names_from = risk, values_from = N) 

kable(table_risk_yrb)

table_risk_yrc <-  table_risk_yr %>% 
  select(-N) %>% 
  pivot_wider(names_from = risk, values_from =pct)  

kable(table_risk_yrc)
           
#reorder risk and grad year category
table_risk_yr <- table_risk_yr %>% 
    mutate(grad_year_cat=fct_relevel(grad_year_cat, c("<1987", "1987-1999", "1999-2010", 
                                                     "2010-2016", ">2016"))) %>%
  mutate(risk=fct_relevel(risk,c("No risk", "Slight risk", "Moderate risk", "High risk" ))) %>% 
  mutate(question=fct_relevel(question,c("morbidity spike with old client", "morbidity spike with new client")))

table_risk_yr <-  table_risk_yr %>% 
 mutate(grad_year_cat=fct_relevel(grad_year_cat,c("<1987", "1987-1999", "2000-2010", "2011-2016", ">2016")))

#bar chart for Q22-23 by grad year category
ggplot(table_risk_yr)+
  geom_bar(aes(x = risk, y = pct, 
               fill = factor(question)),
               stat = 'identity', position = 'dodge')+
  facet_grid(factor(grad_year_cat)~., scales = 'fixed')+
  theme_bw()+
  labs(x= "Level of Risk", y = "Percent of Responses", 
                    title = "Risk to Relationship with Client due to Morbidity Spike 
       after Disconinued Antimicrobial Use")+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
  theme(strip.text.y = element_text(angle = 0))+
  theme(legend.title = element_blank())+
  scale_color_viridis(option = "D")+
  scale_fill_viridis(discrete = TRUE, option = "D")
      #ggsave('test.jpg', height = 11, width = 8.5)

```

## Q24 For what proportion of your food animal clients do you periodically review data which includes:
```{r echo=FALSE, message=FALSE, warning=FALSE}
#Reorder Q24 answers
AMU_Survey_Final <- AMU_Survey_Final %>% 
  mutate(Q24_repro_perform=fct_relevel(Q24_repro_perform,c("None", "< 5%", "6-25%", "26-50%", "> 50%")),
         Q24_econ_perform=fct_relevel(Q24_econ_perform,c("None", "< 5%", "6-25%", "26-50%", "> 50%")),
         Q24_disease_incid=fct_relevel(Q24_disease_incid,c("None", "< 5%", "6-25%", "26-50%", "> 50%")),
         Q24_amu=fct_relevel(Q24_amu,c("None", "< 5%", "6-25%", "26-50%", "> 50%")),
         Q24_treat_outcome=fct_relevel(Q24_treat_outcome,c("None", "< 5%", "6-25%", "26-50%", "> 50%")))

##Filter out Owner and Staff vets (displayed as Unknown)
Q24_filter <- AMU_Survey_Final %>%
  filter(!(Q24_repro_perform %in% 'Unknown'))

#count and proportions reproductive performance
Q24_repro_perform_ct <- data.table(tally( ~ Q24_repro_perform , data = Q24_filter))
Q24_repro_perform_pct <- data.table(round(tally( ~ Q24_repro_perform , data = Q24_filter, format("proportion")),4))%>% 
    rename(pct = N)

Q24_repro_perform <- merge.data.table(Q24_repro_perform_ct, Q24_repro_perform_pct) %>% 
    arrange(factor(Q24_repro_perform, levels = c("None", "< 5%", "6-25%", "26-50%", "> 50%")))

Q24_repro_perform <- Q24_repro_perform %>% mutate(question="reproductive performance") %>%
    rename(proportion=Q24_repro_perform)

#kable(Q24_repro_perform)

#Add practice type
Q24_repro_perform_prac_ct <- data.table(tally(Q24_repro_perform ~ practice_type, data = Q24_filter))
Q24_repro_perform_prac_pct <- data.table(round(tally(Q24_repro_perform ~ practice_type, data = Q24_filter,
    format("proportion")),4))%>%
    rename(pct = N)

Q24_repro_perform_prac <- merge.data.table(Q24_repro_perform_prac_ct, Q24_repro_perform_prac_pct) %>% 
    arrange(factor(Q24_repro_perform, levels = c("None", "< 5%", "6-25%", "26-50%", "> 50%")))

Q24_repro_perform_prac <- Q24_repro_perform_prac %>% mutate(question="reproductive performance") %>%
    rename(proportion=Q24_repro_perform) %>% 
    arrange(factor(practice_type, levels = c("Private General Practice", "Food Animal Practice", "Consultant", 
                                     "Staff Vet", "Academia", "None")))

#kable(Q24_repro_perform_prac)

#kable(table(AMU_Survey_Final$practice_type, AMU_Survey_Final$Q24_repro_perform))

#count and proportions for economic performance
Q24_econ_perform_ct <- data.table(tally( ~ Q24_econ_perform , data = Q24_filter))
Q24_econ_perform_pct <- data.table(round(tally( ~ Q24_econ_perform , data = Q24_filter, format("proportion")),4))%>% 
    rename(pct = N)

Q24_econ_perform <- merge.data.table(Q24_econ_perform_ct, Q24_econ_perform_pct) %>% 
    arrange(factor(Q24_econ_perform, levels = c("None", "< 5%", "6-25%", "26-50%", "> 50%")))

Q24_econ_perform <- Q24_econ_perform %>% mutate(question="economic performance") %>%
    rename(proportion=Q24_econ_perform) 

#kable(Q24_econ_perform)

#Add practice type
Q24_econ_perform_prac_ct <- data.table(tally(Q24_econ_perform ~ practice_type , data = Q24_filter))
Q24_econ_perform_prac_pct <- data.table(round(tally(Q24_econ_perform ~ practice_type, data = Q24_filter,
    format("proportion")),4))%>%
    rename(pct = N)

Q24_econ_perform_prac <- merge.data.table(Q24_econ_perform_prac_ct, Q24_econ_perform_prac_pct) %>% 
    arrange(factor(Q24_econ_perform, levels = c("None", "< 5%", "6-25%", "26-50%", "> 50%")))

Q24_econ_perform_prac <- Q24_econ_perform_prac %>% mutate(question="economic performance") %>%
    rename(proportion=Q24_econ_perform) %>% 
    arrange(factor(practice_type, levels = c("Private General Practice", "Food Animal Practice", "Consultant", 
                                     "Staff Vet", "Academia", "None")))

#kable(Q24_econ_perform_prac)

#kable(table(AMU_Survey_Final$practice_type, AMU_Survey_Final$Q24_econ_perform))

#count and proportions for disease incidence
Q24_disease_incid_ct <- data.table(tally( ~ Q24_disease_incid , data = Q24_filter))
Q24_disease_incid_pct <- data.table(round(tally( ~ Q24_disease_incid , data = Q24_filter, format("proportion")),4))%>% 
    rename(pct = N)

Q24_disease_incid <- merge.data.table(Q24_disease_incid_ct, Q24_disease_incid_pct) %>% 
    arrange(factor(Q24_disease_incid, levels = c("None", "< 5%", "6-25%", "26-50%", "> 50%")))

Q24_disease_incid <- Q24_disease_incid %>% mutate(question="disease incidence") %>%
    rename(proportion=Q24_disease_incid)

#kable(Q24_disease_incid)

#Add practice type
Q24_disease_incid_prac_ct <- data.table(tally(Q24_disease_incid ~ practice_type, data = Q24_filter))
Q24_disease_incid_prac_pct <- data.table(round(tally(Q24_disease_incid ~ practice_type, data = Q24_filter,
    format("proportion")),4))%>%
    rename(pct = N)

Q24_disease_incid_prac <- merge.data.table(Q24_disease_incid_prac_ct, Q24_disease_incid_prac_pct) %>% 
    arrange(factor(Q24_disease_incid, levels = c("None", "< 5%", "6-25%", "26-50%", "> 50%")))

Q24_disease_incid_prac <- Q24_disease_incid_prac %>% mutate(question="disease incidence") %>%
    rename(proportion=Q24_disease_incid) %>% 
    arrange(factor(practice_type, levels = c("Private General Practice", "Food Animal Practice", "Consultant", 
                                     "Staff Vet", "Academia", "None")))

#kable(Q24_disease_incid_prac)

#kable(table(AMU_Survey_Final$practice_type, AMU_Survey_Final$Q24_disease_incid))

#count and proportions for antimicrobial use
Q24_amu_ct <- data.table(tally( ~ Q24_amu , data = Q24_filter))
Q24_amu_pct <- data.table(round(tally( ~ Q24_amu , data = Q24_filter, format("proportion")),4))%>% 
    rename(pct = N)

Q24_amu <- merge.data.table(Q24_amu_ct, Q24_amu_pct) %>% 
    arrange(factor(Q24_amu, levels = c("None", "< 5%", "6-25%", "26-50%", "> 50%")))

Q24_amu <- Q24_amu %>% mutate(question="antimicrobial use") %>%
    rename(proportion=Q24_amu)

#kable(Q24_amu)

#Add practice type
Q24_amu_prac_ct <- data.table(tally(Q24_amu ~ practice_type, data = Q24_filter))
Q24_amu_prac_pct <- data.table(round(tally(Q24_amu ~ practice_type, data = Q24_filter,
    format("proportion")),4))%>%
    rename(pct = N)

Q24_amu_prac <- merge.data.table(Q24_amu_prac_ct, Q24_amu_prac_pct) %>% 
    arrange(factor(Q24_amu, levels = c("None", "< 5%", "6-25%", "26-50%", "> 50%")))

Q24_amu_prac <- Q24_amu_prac %>% mutate(question="antimicrobial use") %>%
    rename(proportion=Q24_amu) %>% 
    arrange(factor(practice_type, levels = c("Private General Practice", "Food Animal Practice", "Consultant", 
                                     "Staff Vet", "Academia", "None")))

#kable(Q24_amu_prac)

#kable(table(AMU_Survey_Final$practice_type, AMU_Survey_Final$Q24_amu))

#count and proportions for treatment outcomes
Q24_treat_outcome_ct <- data.table(tally( ~ Q24_treat_outcome , data = Q24_filter))
Q24_treat_outcome_pct <- data.table(round(tally( ~ Q24_treat_outcome , data = Q24_filter, format("proportion")),4))%>% 
    rename(pct = N)

Q24_treat_outcome <- merge.data.table(Q24_treat_outcome_ct, Q24_treat_outcome_pct) %>% 
    arrange(factor(Q24_treat_outcome, levels = c("None", "< 5%", "6-25%", "26-50%", "> 50%")))

Q24_treat_outcome <- Q24_treat_outcome %>% mutate(question="treatment outcomes") %>%
    rename(proportion=Q24_treat_outcome)

#kable(Q24_treat_outcome)

#Add practice type
Q24_treat_outcome_prac_ct <- data.table(tally(Q24_treat_outcome ~ practice_type, data = Q24_filter))
Q24_treat_outcome_prac_pct <- data.table(round(tally(Q24_treat_outcome ~ practice_type, data = Q24_filter,
    format("proportion")),4))%>%
    rename(pct = N)

Q24_treat_outcome_prac <- merge.data.table(Q24_treat_outcome_prac_ct, Q24_treat_outcome_prac_pct) %>% 
    arrange(factor(Q24_treat_outcome, levels = c("None", "< 5%", "6-25%", "26-50%", "> 50%")))

Q24_treat_outcome_prac <- Q24_treat_outcome_prac %>% mutate(question="treatment outcomes") %>%
    rename(proportion=Q24_treat_outcome) %>% 
    arrange(factor(practice_type, levels = c("Private General Practice", "Food Animal Practice", "Consultant", 
                                     "Staff Vet", "Academia", "None")))

#kable(Q24_treat_outcome_prac)

#kable(table(AMU_Survey_Final$practice_type, AMU_Survey_Final$Q24_treat_outcome))

#----------------------------
#Create a combined table for all parts of question 24

table_Q24 <- rbind.data.frame(Q24_repro_perform, Q24_econ_perform, Q24_disease_incid,
                              Q24_amu, Q24_treat_outcome)

table_Q24 <- table_Q24 %>% 
  select(question, proportion, N, pct) %>% 
  filter(!(proportion %in% "Unknown"))

#kable(table_Q24)

table_Q24b <-  table_Q24 %>% 
  select(-pct) %>% 
  pivot_wider(names_from = proportion, values_from = N) %>% 
  arrange(factor(question, levels = c( "reproductive performance", "disease incidence",
                  "treatment outcomes", "antimicrobial use", "economic performance")))

kable(table_Q24b)

table_Q24c <-  table_Q24 %>% 
  select(-N) %>% 
  pivot_wider(names_from = proportion, values_from =pct) %>% 
  arrange(factor(question, levels = c( "reproductive performance", "disease incidence",
                  "treatment outcomes", "antimicrobial use", "economic performance")))

kable(table_Q24c)

#---------------------------
table_Q24 <- table_Q24 %>% 
  filter(!(proportion %in% 'Unknown')) %>% 
  mutate(question=fct_relevel(question, c("reproductive performance", "disease incidence",
                  "treatment outcomes", "antimicrobial use", "economic performance"))) %>% 
   mutate(proportion=fct_relevel(proportion, c("None", "< 5%", "6-25%", "26-50%", "> 50%"))) 

ggplot(table_Q24)+
  geom_bar(aes(x = proportion, y = pct, 
               fill = factor(question)),
               stat = 'identity', position = 'dodge', fill = "#482677FF")+
  facet_grid(factor(question)~., scales = 'fixed')+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
  theme(strip.text.y = element_text(angle = 0))+
  theme_bw()+
  labs(x= "Proportion", y = "Percentage of Responses", 
                    title = "Proportion of Food Animal Clients with Periodical Data Review")+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
  theme(strip.text.y = element_text(angle = 0))+
  theme(legend.position = "none")
            #ggsave('test.jpg', height = 11, width = 8.5)

table_Q24_pct <- table_Q24 %>% 
  mutate(Percent = 100*pct)

ggplot(table_Q24_pct) +
  geom_point(aes(x = proportion, y = question, size= Percent), color = 'orange')+
  geom_text(aes(x = proportion, y = question, 
                label=paste0(round(pct*100, digits = 0))), 
            hjust = 0, vjust = 1)+
  theme_bw()+
  scale_y_discrete(limits = c("economic performance","antimicrobial use",
                    "treatment outcomes","disease incidence", "reproductive performance"))+
  labs(x= "Proportion", y = "Components", 
                    title = "Proportion of Food Animal Clients with Periodical Data Review",
       size = "Percent of Responses")
#----------------------------
#Create a combined table for all parts of question 24 with practice type

table_Q24_prac <- rbind.data.frame(Q24_repro_perform_prac, Q24_econ_perform_prac, Q24_disease_incid_prac,
                              Q24_amu_prac, Q24_treat_outcome_prac)

table_Q24_prac <- table_Q24_prac %>% 
  select(practice_type, question, proportion, N, pct) %>% 
  filter(!(proportion %in% "Unknown")) %>% 
  filter(!(practice_type %in% 'Staff Vet')) %>% 
  arrange(factor(practice_type, levels = c("Private General Practice", "Food Animal Practice", "Consultant", 
                                     "Staff Vet", "Academia", "None")))

#kable(table_Q24_prac)

table_Q24_pracb <-  table_Q24_prac %>% 
  select(-pct) %>% 
  pivot_wider(names_from = proportion, values_from = N)

kable(table_Q24_pracb)

table_Q24_pracc <-  table_Q24_prac %>% 
  select(-N) %>% 
  pivot_wider(names_from = proportion, values_from =pct)

kable(table_Q24_pracc)

#---------------------------
table_Q24_prac <- table_Q24_prac %>% 
  filter(!(proportion %in% 'Unknown')) %>% 
  filter(!(practice_type %in% 'Staff Vet')) %>%
  mutate(question=fct_relevel(question, c("reproductive performance", "economic performance", "disease incidence", "antimicrobial use","treatment outcomes"))) %>% 
   mutate(proportion=fct_relevel(proportion, c("None", "< 5%", "6-25%", "26-50%", "> 50%"))) %>% 
   mutate(practice_type=fct_relevel(practice_type,c("Private General Practice", 
              "Food Animal Practice", "Consultant", "Staff Vet", "Academia", "None")))

ggplot(table_Q24_prac)+
  geom_bar(aes(x = question, y = pct, 
               fill = factor(proportion)),
               stat = 'identity', position = 'dodge')+
               facet_grid(factor(practice_type)~., scales = 'free')+
               theme(axis.text.x = element_text(angle = 45, hjust = 1))
               #ggsave('test.jpg', height = 11, width = 8.5)

#ggplot(table_Q24_prac)+
  #geom_bar(aes(x = practice_type, y = pct, 
               #fill = factor(proportion)),
               #stat = 'identity', position = 'dodge')+
               #facet_grid(factor(question)~., scales = 'free')+
               #theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

## Q25 For which of the following categories do you routinely review data from the flocks or herds under your care?
```{r echo=FALSE, message=FALSE, warning=FALSE}
#count and proportions for reproductive performance
Q25_repro_perform_ct <- data.table(tally( ~ Q25_repro_perform , data = staffvet))
Q25_repro_perform_pct <- data.table(round(tally( ~ Q25_repro_perform , data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_repro_perform <- merge.data.table(Q25_repro_perform_ct, Q25_repro_perform_pct)

Q25_repro_perform <- Q25_repro_perform %>% mutate(question="reproductive performance") %>%
    rename(answer=Q25_repro_perform)

#kable(Q25_repro_perform)

#count and proportions for economic performance
Q25_econ_perform_ct <- data.table(tally( ~ Q25_econ_perform , data = staffvet))
Q25_econ_perform_pct <- data.table(round(tally( ~ Q25_econ_perform , data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_econ_perform <- merge.data.table(Q25_econ_perform_ct, Q25_econ_perform_pct) 

Q25_econ_perform <- Q25_econ_perform %>% mutate(question="economic performance") %>%
    rename(answer=Q25_econ_perform)

#kable(Q25_econ_perform)

#count and proportions for disease incidence
Q25_disease_incid_ct <- data.table(tally( ~ Q25_disease_incid , data = staffvet))
Q25_disease_incid_pct <- data.table(round(tally( ~ Q25_disease_incid , data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_disease_incid <- merge.data.table(Q25_disease_incid_ct, Q25_disease_incid_pct)

Q25_disease_incid <- Q25_disease_incid %>% mutate(question="disease incidence") %>%
    rename(answer=Q25_disease_incid)

#kable(Q25_disease_incid)

#count and proportions for antimicrobial use
Q25_amu_ct <- data.table(tally( ~ Q25_amu , data = staffvet))
Q25_amu_pct <- data.table(round(tally( ~ Q25_amu , data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_amu <- merge.data.table(Q25_amu_ct, Q25_amu_pct) 

Q25_amu <- Q25_amu %>% mutate(question="antimicrobial use") %>%
    rename(answer=Q25_amu)

#kable(Q25_amu)

#count and proportions for treatment outcomes
Q25_treat_outcome_ct <- data.table(tally( ~ Q25_treat_outcome , data = staffvet))
Q25_treat_outcome_pct <- data.table(round(tally( ~ Q25_treat_outcome , data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_treat_outcome <- merge.data.table(Q25_treat_outcome_ct, Q25_treat_outcome_pct)

Q25_treat_outcome <- Q25_treat_outcome %>% mutate(question="treatment outcomes") %>%
    rename(answer=Q25_treat_outcome)

#kable(Q25_treat_outcome)

#----------------------------
#Create a combined table for all parts of question 25

table_Q25 <- rbind.data.frame(Q25_repro_perform, Q25_econ_perform, Q25_disease_incid,
                              Q25_amu, Q25_treat_outcome)

table_Q25 <- table_Q25 %>% 
  select(question, answer, N, pct)

#kable(table_Q25)

table_Q25b <-  table_Q25 %>% 
  select(-pct) %>% 
  pivot_wider(names_from = answer, values_from = N)

kable(table_Q25b)

table_Q25c <-  table_Q25 %>% 
  select(-N) %>% 
  pivot_wider(names_from = answer, values_from =pct)

kable(table_Q25c)

#---------------------------
table_Q25 <- table_Q25 %>% 
  filter(!(answer %in% 'Unknown')) %>% 
  filter(!(answer %in% 'I do not routinely review these data')) %>% 
  mutate(question=fct_relevel(question, c("disease incidence", "economic performance",
      "treatment outcomes", "antimicrobial use", "reproductive performance"))) %>% 
   mutate(answer=fct_relevel(answer, c("None", "< 5%", "6-25%", "26-50%", "> 50%"))) 

ggplot(table_Q25)+
  geom_bar(aes(x = question, y = pct, 
               fill = factor(question)),
               stat = 'identity', position = 'dodge', fill = "#238A8DFF")+
  facet_grid(factor(answer)~., scales = 'fixed')+
  theme_bw()+
  labs(x= "Categories", y = "Percent of Responses", 
                    title = "Categories of Routine Data Review from the Flocks or Herds Under Your Care")+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  theme(legend.position = "none")
            #ggsave('test.jpg', height = 11, width = 8.5)
```

## Q25 Combined Parts Broke Out By Species (calculated as species response divided by total repsonse per species)
```{r echo=FALSE, message=FALSE, warning=FALSE}
staffvet_spec <- staffvet %>% 
  select(Beef_Cattle, Dairy_Cattle, Swine, Sheep, Goats, Chickens, Turkeys, beef_dairy, 
          sheep_goat, chicken_turkey)

staffvet_spec_ct <- staffvet_spec %>% 
  summarize(Beef_Cattle=sum(Beef_Cattle), Dairy_Cattle=sum(Dairy_Cattle), Swine=sum(Swine), 
            Sheep=sum(Sheep), Goats=sum(Goats), Chickens=sum(Chickens), Turkeys=sum(Turkeys),
            beef_dairy=sum(beef_dairy), sheep_goat=sum(sheep_goat), chicken_turkey=sum(chicken_turkey))

staffvet_spec_ct <- as.data.frame(t(staffvet_spec_ct))

staffvet_spec_ct <- staffvet_spec_ct %>% 
  rownames_to_column(var = "species") %>% 
  rename("N"=V1)

kable(staffvet_spec_ct)

#count and proportions for reproductive performance
##Beef
Q25_repro_perform_beef_ct <- data.table(tally( ~ Q25_repro_perform | Beef_Cattle, data = staffvet))
Q25_repro_perform_beef_pct <- data.table(round(tally( ~ Q25_repro_perform | Beef_Cattle, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_repro_perform_beef <- merge.data.table(Q25_repro_perform_beef_ct, Q25_repro_perform_beef_pct)

Q25_repro_perform_beef <- Q25_repro_perform_beef %>%
    filter(Beef_Cattle %in% 'TRUE')%>%
    mutate(question="reproductive performance") %>%
    rename(answer=Q25_repro_perform) %>% 
    mutate(species="beef cattle") %>%
    rename(response=Beef_Cattle)

#kable(Q25_repro_perform_beef)

##Dairy
Q25_repro_perform_dairy_ct <- data.table(tally( ~ Q25_repro_perform | Dairy_Cattle, data = staffvet))
Q25_repro_perform_dairy_pct <- data.table(round(tally( ~ Q25_repro_perform | Dairy_Cattle, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_repro_perform_dairy <- merge.data.table(Q25_repro_perform_dairy_ct, Q25_repro_perform_dairy_pct)

Q25_repro_perform_dairy <- Q25_repro_perform_dairy %>%
    filter(Dairy_Cattle %in% 'TRUE')%>%
    mutate(question="reproductive performance") %>%
    rename(answer=Q25_repro_perform) %>% 
    mutate(species="dairy cattle") %>%
    rename(response=Dairy_Cattle)

#kable(Q25_repro_perform_dairy)

##Swine
Q25_repro_perform_swine_ct <- data.table(tally( ~ Q25_repro_perform | Swine, data = staffvet))
Q25_repro_perform_swine_pct <- data.table(round(tally( ~ Q25_repro_perform | Swine, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_repro_perform_swine <- merge.data.table(Q25_repro_perform_swine_ct, Q25_repro_perform_swine_pct)

Q25_repro_perform_swine <- Q25_repro_perform_swine %>%
    filter(Swine %in% 'TRUE')%>%
    mutate(question="reproductive performance") %>%
    rename(answer=Q25_repro_perform) %>% 
    mutate(species="swine") %>%
    rename(response=Swine)

#kable(Q25_repro_perform_swine)

##Sheep
Q25_repro_perform_sheep_ct <- data.table(tally( ~ Q25_repro_perform | Sheep, data = staffvet))
Q25_repro_perform_sheep_pct <- data.table(round(tally( ~ Q25_repro_perform | Sheep, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_repro_perform_sheep <- merge.data.table(Q25_repro_perform_sheep_ct, Q25_repro_perform_sheep_pct)

Q25_repro_perform_sheep <- Q25_repro_perform_sheep %>%
    filter(Sheep %in% 'TRUE')%>%
    mutate(question="reproductive performance") %>%
    rename(answer=Q25_repro_perform) %>% 
    mutate(species="sheep") %>%
    rename(response=Sheep)

#kable(Q25_repro_perform_sheep)

##Goats
Q25_repro_perform_goats_ct <- data.table(tally( ~ Q25_repro_perform | Goats, data = staffvet))
Q25_repro_perform_goats_pct <- data.table(round(tally( ~ Q25_repro_perform | Goats, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_repro_perform_goats <- merge.data.table(Q25_repro_perform_goats_ct, Q25_repro_perform_goats_pct)

Q25_repro_perform_goats <- Q25_repro_perform_goats %>%
    filter(Goats %in% 'TRUE')%>%
    mutate(question="reproductive performance") %>%
    rename(answer=Q25_repro_perform) %>% 
    mutate(species="goats") %>%
    rename(response=Goats)

#kable(Q25_repro_perform_goats)

##Chickens
Q25_repro_perform_chickens_ct <- data.table(tally( ~ Q25_repro_perform | Chickens, data = staffvet))
Q25_repro_perform_chickens_pct <- data.table(round(tally( ~ Q25_repro_perform | Chickens, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_repro_perform_chickens <- merge.data.table(Q25_repro_perform_chickens_ct, Q25_repro_perform_chickens_pct)

Q25_repro_perform_chickens <- Q25_repro_perform_chickens %>%
    filter(Chickens %in% 'TRUE')%>%
    mutate(question="reproductive performance") %>%
    rename(answer=Q25_repro_perform) %>% 
    mutate(species="chickens") %>%
    rename(response=Chickens)

#kable(Q25_repro_perform_chickens)

##Turkeys
Q25_repro_perform_turkeys_ct <- data.table(tally( ~ Q25_repro_perform | Turkeys, data = staffvet))
Q25_repro_perform_turkeys_pct <- data.table(round(tally( ~ Q25_repro_perform | Turkeys, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_repro_perform_turkeys <- merge.data.table(Q25_repro_perform_turkeys_ct, Q25_repro_perform_turkeys_pct)

Q25_repro_perform_turkeys <- Q25_repro_perform_turkeys %>%
    filter(Turkeys %in% 'TRUE')%>%
    mutate(question="reproductive performance") %>%
    rename(answer=Q25_repro_perform) %>% 
    mutate(species="turkeys") %>%
    rename(response=Turkeys)

#kable(Q25_repro_perform_turkeys)

##Beef and Dairy
Q25_repro_perform_bd_ct <- data.table(tally( ~ Q25_repro_perform | beef_dairy, data = staffvet))
Q25_repro_perform_bd_pct <- data.table(round(tally( ~ Q25_repro_perform | beef_dairy, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_repro_perform_bd <- merge.data.table(Q25_repro_perform_bd_ct, Q25_repro_perform_bd_pct)

Q25_repro_perform_bd <- Q25_repro_perform_bd %>%
    filter(beef_dairy %in% 'TRUE')%>%
    mutate(question="reproductive performance") %>%
    rename(answer=Q25_repro_perform) %>% 
    mutate(species="beef and dairy") %>%
    rename(response=beef_dairy)

#kable(Q25_repro_perform_bd)

##Sheep and Goats
Q25_repro_perform_sg_ct <- data.table(tally( ~ Q25_repro_perform | sheep_goat, data = staffvet))
Q25_repro_perform_sg_pct <- data.table(round(tally( ~ Q25_repro_perform | sheep_goat, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_repro_perform_sg <- merge.data.table(Q25_repro_perform_sg_ct, Q25_repro_perform_sg_pct)

Q25_repro_perform_sg <- Q25_repro_perform_sg %>%
    filter(sheep_goat %in% 'TRUE')%>%
    mutate(question="reproductive performance") %>%
    rename(answer=Q25_repro_perform) %>% 
    mutate(species="sheep and goats") %>%
    rename(response=sheep_goat)

#kable(Q25_repro_perform_sg)

##Chickens and Turkeys
Q25_repro_perform_ct_ct <- data.table(tally( ~ Q25_repro_perform | chicken_turkey, data = staffvet))
Q25_repro_perform_ct_pct <- data.table(round(tally( ~ Q25_repro_perform | chicken_turkey, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_repro_perform_ct <- merge.data.table(Q25_repro_perform_ct_ct, Q25_repro_perform_ct_pct)

Q25_repro_perform_ct <- Q25_repro_perform_ct %>%
    filter(chicken_turkey %in% 'TRUE')%>%
    mutate(question="reproductive performance") %>%
    rename(answer=Q25_repro_perform) %>% 
    mutate(species="chickens and turkeys") %>%
    rename(response=chicken_turkey)

#kable(Q25_repro_perform_ct)

#Create a combined table for all species reproductive performance

table_Q25_repro_perform_spec <- rbind.data.frame(Q25_repro_perform_beef, Q25_repro_perform_dairy, Q25_repro_perform_swine, Q25_repro_perform_sheep, Q25_repro_perform_goats, Q25_repro_perform_chickens, Q25_repro_perform_turkeys, Q25_repro_perform_bd, Q25_repro_perform_sg, Q25_repro_perform_ct)
#kable(table_Q25_repro_perform_spec)

#-----------------------------------------------------------
#count and proportions for economic performance
##Beef
Q25_econ_perform_beef_ct <- data.table(tally( ~ Q25_econ_perform | Beef_Cattle, data = staffvet))
Q25_econ_perform_beef_pct <- data.table(round(tally( ~ Q25_econ_perform | Beef_Cattle, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_econ_perform_beef <- merge.data.table(Q25_econ_perform_beef_ct, Q25_econ_perform_beef_pct)

Q25_econ_perform_beef <- Q25_econ_perform_beef %>%
    filter(Beef_Cattle %in% 'TRUE')%>%
    mutate(question="economic performance") %>%
    rename(answer=Q25_econ_perform) %>% 
    mutate(species="beef cattle") %>%
    rename(response=Beef_Cattle)

#kable(Q25_econ_perform_beef)

##Dairy
Q25_econ_perform_dairy_ct <- data.table(tally( ~ Q25_econ_perform | Dairy_Cattle, data = staffvet))
Q25_econ_perform_dairy_pct <- data.table(round(tally( ~ Q25_econ_perform | Dairy_Cattle, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_econ_perform_dairy <- merge.data.table(Q25_econ_perform_dairy_ct, Q25_econ_perform_dairy_pct)

Q25_econ_perform_dairy <- Q25_econ_perform_dairy %>%
    filter(Dairy_Cattle %in% 'TRUE')%>%
    mutate(question="economic performance") %>%
    rename(answer=Q25_econ_perform) %>% 
    mutate(species="dairy cattle") %>%
    rename(response=Dairy_Cattle)

#kable(Q25_econ_perform_dairy)

##Swine
Q25_econ_perform_swine_ct <- data.table(tally( ~ Q25_econ_perform | Swine, data = staffvet))
Q25_econ_perform_swine_pct <- data.table(round(tally( ~ Q25_econ_perform | Swine, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_econ_perform_swine <- merge.data.table(Q25_econ_perform_swine_ct, Q25_econ_perform_swine_pct)

Q25_econ_perform_swine <- Q25_econ_perform_swine %>%
    filter(Swine %in% 'TRUE')%>%
    mutate(question="economic performance") %>%
    rename(answer=Q25_econ_perform) %>% 
    mutate(species="swine") %>%
    rename(response=Swine)

#kable(Q25_econ_perform_swine)

##Sheep
Q25_econ_perform_sheep_ct <- data.table(tally( ~ Q25_econ_perform | Sheep, data = staffvet))
Q25_econ_perform_sheep_pct <- data.table(round(tally( ~ Q25_econ_perform | Sheep, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_econ_perform_sheep <- merge.data.table(Q25_econ_perform_sheep_ct, Q25_econ_perform_sheep_pct)

Q25_econ_perform_sheep <- Q25_econ_perform_sheep %>%
    filter(Sheep %in% 'TRUE')%>%
    mutate(question="economic performance") %>%
    rename(answer=Q25_econ_perform) %>% 
    mutate(species="sheep") %>%
    rename(response=Sheep)

#kable(Q25_econ_perform_sheep)

##Goats
Q25_econ_perform_goats_ct <- data.table(tally( ~ Q25_econ_perform | Goats, data = staffvet))
Q25_econ_perform_goats_pct <- data.table(round(tally( ~ Q25_econ_perform | Goats, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_econ_perform_goats <- merge.data.table(Q25_econ_perform_goats_ct, Q25_econ_perform_goats_pct)

Q25_econ_perform_goats <- Q25_econ_perform_goats %>%
    filter(Goats %in% 'TRUE')%>%
    mutate(question="economic performance") %>%
    rename(answer=Q25_econ_perform) %>% 
    mutate(species="goats") %>%
    rename(response=Goats)

#kable(Q25_econ_perform_goats)

##Chickens
Q25_econ_perform_chickens_ct <- data.table(tally( ~ Q25_econ_perform | Chickens, data = staffvet))
Q25_econ_perform_chickens_pct <- data.table(round(tally( ~ Q25_econ_perform | Chickens, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_econ_perform_chickens <- merge.data.table(Q25_econ_perform_chickens_ct, Q25_econ_perform_chickens_pct)

Q25_econ_perform_chickens <- Q25_econ_perform_chickens %>%
    filter(Chickens %in% 'TRUE')%>%
    mutate(question="economic performance") %>%
    rename(answer=Q25_econ_perform) %>% 
    mutate(species="chickens") %>%
    rename(response=Chickens)

#kable(Q25_econ_perform_chickens)

##Turkeys
Q25_econ_perform_turkeys_ct <- data.table(tally( ~ Q25_econ_perform | Turkeys, data = staffvet))
Q25_econ_perform_turkeys_pct <- data.table(round(tally( ~ Q25_econ_perform | Turkeys, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_econ_perform_turkeys <- merge.data.table(Q25_econ_perform_turkeys_ct, Q25_econ_perform_turkeys_pct)

Q25_econ_perform_turkeys <- Q25_econ_perform_turkeys %>%
    filter(Turkeys %in% 'TRUE')%>%
    mutate(question="economic performance") %>%
    rename(answer=Q25_econ_perform) %>% 
    mutate(species="turkeys") %>%
    rename(response=Turkeys)

#kable(Q25_econ_perform_turkeys)

##Beef and Dairy
Q25_econ_perform_bd_ct <- data.table(tally( ~ Q25_econ_perform | beef_dairy, data = staffvet))
Q25_econ_perform_bd_pct <- data.table(round(tally( ~ Q25_econ_perform | beef_dairy, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_econ_perform_bd <- merge.data.table(Q25_econ_perform_bd_ct, Q25_econ_perform_bd_pct)

Q25_econ_perform_bd <- Q25_econ_perform_bd %>%
    filter(beef_dairy %in% 'TRUE')%>%
    mutate(question="economic performance") %>%
    rename(answer=Q25_econ_perform) %>% 
    mutate(species="beef and dairy") %>%
    rename(response=beef_dairy)

#kable(Q25_econ_perform_bd)

##Sheep and Goats
Q25_econ_perform_sg_ct <- data.table(tally( ~ Q25_econ_perform | sheep_goat, data = staffvet))
Q25_econ_perform_sg_pct <- data.table(round(tally( ~ Q25_econ_perform | sheep_goat, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_econ_perform_sg <- merge.data.table(Q25_econ_perform_sg_ct, Q25_econ_perform_sg_pct)

Q25_econ_perform_sg <- Q25_econ_perform_sg %>%
    filter(sheep_goat %in% 'TRUE')%>%
    mutate(question="economic performance") %>%
    rename(answer=Q25_econ_perform) %>% 
    mutate(species="sheep and goats") %>%
    rename(response=sheep_goat)

#kable(Q25_econ_perform_sg)

##Chickens and Turkeys
Q25_econ_perform_ct_ct <- data.table(tally( ~ Q25_econ_perform | chicken_turkey, data = staffvet))
Q25_econ_perform_ct_pct <- data.table(round(tally( ~ Q25_econ_perform | chicken_turkey, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_econ_perform_ct <- merge.data.table(Q25_econ_perform_ct_ct, Q25_econ_perform_ct_pct)

Q25_econ_perform_ct <- Q25_econ_perform_ct %>%
    filter(chicken_turkey %in% 'TRUE')%>%
    mutate(question="economic performance") %>%
    rename(answer=Q25_econ_perform) %>% 
    mutate(species="chickens and turkeys") %>%
    rename(response=chicken_turkey)

#kable(Q25_econ_perform_ct)

#Create a combined table for all species economic performance

table_Q25_econ_perform_spec <- rbind.data.frame(Q25_econ_perform_beef, Q25_econ_perform_dairy, Q25_econ_perform_swine, Q25_econ_perform_sheep, Q25_econ_perform_goats, Q25_econ_perform_chickens, Q25_econ_perform_turkeys, Q25_econ_perform_bd, Q25_econ_perform_sg, Q25_econ_perform_ct)
#kable(table_Q25_econ_perform_spec)

#-----------------------------------------------------------
#count and proportions for disease incidence
##Beef
Q25_disease_incid_beef_ct <- data.table(tally( ~ Q25_disease_incid | Beef_Cattle, data = staffvet))
Q25_disease_incid_beef_pct <- data.table(round(tally( ~ Q25_disease_incid | Beef_Cattle, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_disease_incid_beef <- merge.data.table(Q25_disease_incid_beef_ct, Q25_disease_incid_beef_pct)

Q25_disease_incid_beef <- Q25_disease_incid_beef %>%
    filter(Beef_Cattle %in% 'TRUE')%>%
    mutate(question="disease incidence") %>%
    rename(answer=Q25_disease_incid) %>% 
    mutate(species="beef cattle") %>%
    rename(response=Beef_Cattle)

#kable(Q25_disease_incid_beef)

##Dairy
Q25_disease_incid_dairy_ct <- data.table(tally( ~ Q25_disease_incid | Dairy_Cattle, data = staffvet))
Q25_disease_incid_dairy_pct <- data.table(round(tally( ~ Q25_disease_incid | Dairy_Cattle, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_disease_incid_dairy <- merge.data.table(Q25_disease_incid_dairy_ct, Q25_disease_incid_dairy_pct)

Q25_disease_incid_dairy <- Q25_disease_incid_dairy %>%
    filter(Dairy_Cattle %in% 'TRUE')%>%
    mutate(question="disease incidence") %>%
    rename(answer=Q25_disease_incid) %>% 
    mutate(species="dairy cattle") %>%
    rename(response=Dairy_Cattle)

#kable(Q25_disease_incid_dairy)

##Swine
Q25_disease_incid_swine_ct <- data.table(tally( ~ Q25_disease_incid | Swine, data = staffvet))
Q25_disease_incid_swine_pct <- data.table(round(tally( ~ Q25_disease_incid | Swine, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_disease_incid_swine <- merge.data.table(Q25_disease_incid_swine_ct, Q25_disease_incid_swine_pct)

Q25_disease_incid_swine <- Q25_disease_incid_swine %>%
    filter(Swine %in% 'TRUE')%>%
    mutate(question="disease incidence") %>%
    rename(answer=Q25_disease_incid) %>% 
    mutate(species="swine") %>%
    rename(response=Swine)

#kable(Q25_disease_incid_swine)

##Sheep
Q25_disease_incid_sheep_ct <- data.table(tally( ~ Q25_disease_incid | Sheep, data = staffvet))
Q25_disease_incid_sheep_pct <- data.table(round(tally( ~ Q25_disease_incid | Sheep, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_disease_incid_sheep <- merge.data.table(Q25_disease_incid_sheep_ct, Q25_disease_incid_sheep_pct)

Q25_disease_incid_sheep <- Q25_disease_incid_sheep %>%
    filter(Sheep %in% 'TRUE')%>%
    mutate(question="disease incidence") %>%
    rename(answer=Q25_disease_incid) %>% 
    mutate(species="sheep") %>%
    rename(response=Sheep)

#kable(Q25_disease_incid_sheep)

##Goats
Q25_disease_incid_goats_ct <- data.table(tally( ~ Q25_disease_incid | Goats, data = staffvet))
Q25_disease_incid_goats_pct <- data.table(round(tally( ~ Q25_disease_incid | Goats, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_disease_incid_goats <- merge.data.table(Q25_disease_incid_goats_ct, Q25_disease_incid_goats_pct)

Q25_disease_incid_goats <- Q25_disease_incid_goats %>%
    filter(Goats %in% 'TRUE')%>%
    mutate(question="disease incidence") %>%
    rename(answer=Q25_disease_incid) %>% 
    mutate(species="goats") %>%
    rename(response=Goats)

#kable(Q25_disease_incid_goats)

##Chickens
Q25_disease_incid_chickens_ct <- data.table(tally( ~ Q25_disease_incid | Chickens, data = staffvet))
Q25_disease_incid_chickens_pct <- data.table(round(tally( ~ Q25_disease_incid | Chickens, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_disease_incid_chickens <- merge.data.table(Q25_disease_incid_chickens_ct, Q25_disease_incid_chickens_pct)

Q25_disease_incid_chickens <- Q25_disease_incid_chickens %>%
    filter(Chickens %in% 'TRUE')%>%
    mutate(question="disease incidence") %>%
    rename(answer=Q25_disease_incid) %>% 
    mutate(species="chickens") %>%
    rename(response=Chickens)

#kable(Q25_disease_incid_chickens)

##Turkeys
Q25_disease_incid_turkeys_ct <- data.table(tally( ~ Q25_disease_incid | Turkeys, data = staffvet))
Q25_disease_incid_turkeys_pct <- data.table(round(tally( ~ Q25_disease_incid | Turkeys, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_disease_incid_turkeys <- merge.data.table(Q25_disease_incid_turkeys_ct, Q25_disease_incid_turkeys_pct)

Q25_disease_incid_turkeys <- Q25_disease_incid_turkeys %>%
    filter(Turkeys %in% 'TRUE')%>%
    mutate(question="disease incidence") %>%
    rename(answer=Q25_disease_incid) %>% 
    mutate(species="turkeys") %>%
    rename(response=Turkeys)

#kable(Q25_disease_incid_turkeys)

##Beef and Dairy
Q25_disease_incid_bd_ct <- data.table(tally( ~ Q25_disease_incid | beef_dairy, data = staffvet))
Q25_disease_incid_bd_pct <- data.table(round(tally( ~ Q25_disease_incid | beef_dairy, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_disease_incid_bd <- merge.data.table(Q25_disease_incid_bd_ct, Q25_disease_incid_bd_pct)

Q25_disease_incid_bd <- Q25_disease_incid_bd %>%
    filter(beef_dairy %in% 'TRUE')%>%
    mutate(question="disease incidence") %>%
    rename(answer=Q25_disease_incid) %>% 
    mutate(species="beef and dairy") %>%
    rename(response=beef_dairy)

#kable(Q25_disease_incid_bd)

##Sheep and Goats
Q25_disease_incid_sg_ct <- data.table(tally( ~ Q25_disease_incid | sheep_goat, data = staffvet))
Q25_disease_incid_sg_pct <- data.table(round(tally( ~ Q25_disease_incid | sheep_goat, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_disease_incid_sg <- merge.data.table(Q25_disease_incid_sg_ct, Q25_disease_incid_sg_pct)

Q25_disease_incid_sg <- Q25_disease_incid_sg %>%
    filter(sheep_goat %in% 'TRUE')%>%
    mutate(question="disease incidence") %>%
    rename(answer=Q25_disease_incid) %>% 
    mutate(species="sheep and goats") %>%
    rename(response=sheep_goat)

#kable(Q25_disease_incid_sg)

##Chickens and Turkeys
Q25_disease_incid_ct_ct <- data.table(tally( ~ Q25_disease_incid | chicken_turkey, data = staffvet))
Q25_disease_incid_ct_pct <- data.table(round(tally( ~ Q25_disease_incid | chicken_turkey, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_disease_incid_ct <- merge.data.table(Q25_disease_incid_ct_ct, Q25_disease_incid_ct_pct)

Q25_disease_incid_ct <- Q25_disease_incid_ct %>%
    filter(chicken_turkey %in% 'TRUE')%>%
    mutate(question="disease incidence") %>%
    rename(answer=Q25_disease_incid) %>% 
    mutate(species="chickens and turkeys") %>%
    rename(response=chicken_turkey)

#kable(Q25_disease_incid_ct)

#Create a combined table for all species disease incidence

table_Q25_disease_incid_spec <- rbind.data.frame(Q25_disease_incid_beef, Q25_disease_incid_dairy, Q25_disease_incid_swine, Q25_disease_incid_sheep, Q25_disease_incid_goats, Q25_disease_incid_chickens, Q25_disease_incid_turkeys, Q25_disease_incid_bd, Q25_disease_incid_sg, Q25_disease_incid_ct)
#kable(table_Q25_disease_incid_spec)

#-----------------------------------------------------------
#count and proportions for antimicrobial use 
##Beef
Q25_amu_beef_ct <- data.table(tally( ~ Q25_amu | Beef_Cattle, data = staffvet))
Q25_amu_beef_pct <- data.table(round(tally( ~ Q25_amu | Beef_Cattle, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_amu_beef <- merge.data.table(Q25_amu_beef_ct, Q25_amu_beef_pct)

Q25_amu_beef <- Q25_amu_beef %>%
    filter(Beef_Cattle %in% 'TRUE')%>%
    mutate(question="antimicrobial use") %>%
    rename(answer=Q25_amu) %>% 
    mutate(species="beef cattle") %>%
    rename(response=Beef_Cattle)

#kable(Q25_amu_beef)

##Dairy
Q25_amu_dairy_ct <- data.table(tally( ~ Q25_amu | Dairy_Cattle, data = staffvet))
Q25_amu_dairy_pct <- data.table(round(tally( ~ Q25_amu | Dairy_Cattle, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_amu_dairy <- merge.data.table(Q25_amu_dairy_ct, Q25_amu_dairy_pct)

Q25_amu_dairy <- Q25_amu_dairy %>%
    filter(Dairy_Cattle %in% 'TRUE')%>%
    mutate(question="antimicrobial use") %>%
    rename(answer=Q25_amu) %>% 
    mutate(species="dairy cattle") %>%
    rename(response=Dairy_Cattle)

#kable(Q25_amu_dairy)

##Swine
Q25_amu_swine_ct <- data.table(tally( ~ Q25_amu | Swine, data = staffvet))
Q25_amu_swine_pct <- data.table(round(tally( ~ Q25_amu | Swine, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_amu_swine <- merge.data.table(Q25_amu_swine_ct, Q25_amu_swine_pct)

Q25_amu_swine <- Q25_amu_swine %>%
    filter(Swine %in% 'TRUE')%>%
    mutate(question="antimicrobial use") %>%
    rename(answer=Q25_amu) %>% 
    mutate(species="swine") %>%
    rename(response=Swine)

#kable(Q25_amu_swine)

##Sheep
Q25_amu_sheep_ct <- data.table(tally( ~ Q25_amu | Sheep, data = staffvet))
Q25_amu_sheep_pct <- data.table(round(tally( ~ Q25_amu | Sheep, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_amu_sheep <- merge.data.table(Q25_amu_sheep_ct, Q25_amu_sheep_pct)

Q25_amu_sheep <- Q25_amu_sheep %>%
    filter(Sheep %in% 'TRUE')%>%
    mutate(question="antimicrobial use") %>%
    rename(answer=Q25_amu) %>% 
    mutate(species="sheep") %>%
    rename(response=Sheep)

#kable(Q25_amu_sheep)

##Goats
Q25_amu_goats_ct <- data.table(tally( ~ Q25_amu | Goats, data = staffvet))
Q25_amu_goats_pct <- data.table(round(tally( ~ Q25_amu | Goats, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_amu_goats <- merge.data.table(Q25_amu_goats_ct, Q25_amu_goats_pct)

Q25_amu_goats <- Q25_amu_goats %>%
    filter(Goats %in% 'TRUE')%>%
    mutate(question="antimicrobial use") %>%
    rename(answer=Q25_amu) %>% 
    mutate(species="goats") %>%
    rename(response=Goats)

#kable(Q25_amu_goats)

##Chickens
Q25_amu_chickens_ct <- data.table(tally( ~ Q25_amu | Chickens, data = staffvet))
Q25_amu_chickens_pct <- data.table(round(tally( ~ Q25_amu | Chickens, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_amu_chickens <- merge.data.table(Q25_amu_chickens_ct, Q25_amu_chickens_pct)

Q25_amu_chickens <- Q25_amu_chickens %>%
    filter(Chickens %in% 'TRUE')%>%
    mutate(question="antimicrobial use") %>%
    rename(answer=Q25_amu) %>% 
    mutate(species="chickens") %>%
    rename(response=Chickens)

#kable(Q25_amu_chickens)

##Turkeys
Q25_amu_turkeys_ct <- data.table(tally( ~ Q25_amu | Turkeys, data = staffvet))
Q25_amu_turkeys_pct <- data.table(round(tally( ~ Q25_amu | Turkeys, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_amu_turkeys <- merge.data.table(Q25_amu_turkeys_ct, Q25_amu_turkeys_pct)

Q25_amu_turkeys <- Q25_amu_turkeys %>%
    filter(Turkeys %in% 'TRUE')%>%
    mutate(question="antimicrobial use") %>%
    rename(answer=Q25_amu) %>% 
    mutate(species="turkeys") %>%
    rename(response=Turkeys)

#kable(Q25_amu_turkeys)

##Beef and Dairy
Q25_amu_bd_ct <- data.table(tally( ~ Q25_amu | beef_dairy, data = staffvet))
Q25_amu_bd_pct <- data.table(round(tally( ~ Q25_amu | beef_dairy, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_amu_bd <- merge.data.table(Q25_amu_bd_ct, Q25_amu_bd_pct)

Q25_amu_bd <- Q25_amu_bd %>%
    filter(beef_dairy %in% 'TRUE')%>%
    mutate(question="antimicrobial use") %>%
    rename(answer=Q25_amu) %>% 
    mutate(species="beef and dairy") %>%
    rename(response=beef_dairy)

#kable(Q25_amu_bd)

##Sheep and Goats
Q25_amu_sg_ct <- data.table(tally( ~ Q25_amu | sheep_goat, data = staffvet))
Q25_amu_sg_pct <- data.table(round(tally( ~ Q25_amu | sheep_goat, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_amu_sg <- merge.data.table(Q25_amu_sg_ct, Q25_amu_sg_pct)

Q25_amu_sg <- Q25_amu_sg %>%
    filter(sheep_goat %in% 'TRUE')%>%
    mutate(question="antimicrobial use") %>%
    rename(answer=Q25_amu) %>% 
    mutate(species="sheep and goats") %>%
    rename(response=sheep_goat)

#kable(Q25_amu_sg)

##Chickens and Turkeys
Q25_amu_ct_ct <- data.table(tally( ~ Q25_amu | chicken_turkey, data = staffvet))
Q25_amu_ct_pct <- data.table(round(tally( ~ Q25_amu | chicken_turkey, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_amu_ct <- merge.data.table(Q25_amu_ct_ct, Q25_amu_ct_pct)

Q25_amu_ct <- Q25_amu_ct %>%
    filter(chicken_turkey %in% 'TRUE')%>%
    mutate(question="antimicrobial use") %>%
    rename(answer=Q25_amu) %>% 
    mutate(species="chickens and turkeys") %>%
    rename(response=chicken_turkey)

#kable(Q25_amu_ct)

#Create a combined table for all species antimicrobial use

table_Q25_amu_spec <- rbind.data.frame(Q25_amu_beef, Q25_amu_dairy, Q25_amu_swine, Q25_amu_sheep, Q25_amu_goats, Q25_amu_chickens, Q25_amu_turkeys, Q25_amu_bd, Q25_amu_sg, Q25_amu_ct)
#kable(table_Q25_amu_spec)

#-----------------------------------------------------------
#count and proportions for treatment outcomes 
##Beef
Q25_treat_outcome_beef_ct <- data.table(tally( ~ Q25_treat_outcome | Beef_Cattle, data = staffvet))
Q25_treat_outcome_beef_pct <- data.table(round(tally( ~ Q25_treat_outcome | Beef_Cattle, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_treat_outcome_beef <- merge.data.table(Q25_treat_outcome_beef_ct, Q25_treat_outcome_beef_pct)

Q25_treat_outcome_beef <- Q25_treat_outcome_beef %>%
    filter(Beef_Cattle %in% 'TRUE')%>%
    mutate(question="treatment outcomes") %>%
    rename(answer=Q25_treat_outcome) %>% 
    mutate(species="beef cattle") %>%
    rename(response=Beef_Cattle)

#kable(Q25_treat_outcome_beef)

##Dairy
Q25_treat_outcome_dairy_ct <- data.table(tally( ~ Q25_treat_outcome | Dairy_Cattle, data = staffvet))
Q25_treat_outcome_dairy_pct <- data.table(round(tally( ~ Q25_treat_outcome | Dairy_Cattle, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_treat_outcome_dairy <- merge.data.table(Q25_treat_outcome_dairy_ct, Q25_treat_outcome_dairy_pct)

Q25_treat_outcome_dairy <- Q25_treat_outcome_dairy %>%
    filter(Dairy_Cattle %in% 'TRUE')%>%
    mutate(question="treatment outcomes") %>%
    rename(answer=Q25_treat_outcome) %>% 
    mutate(species="dairy cattle") %>%
    rename(response=Dairy_Cattle)

#kable(Q25_treat_outcome_dairy)

##Swine
Q25_treat_outcome_swine_ct <- data.table(tally( ~ Q25_treat_outcome | Swine, data = staffvet))
Q25_treat_outcome_swine_pct <- data.table(round(tally( ~ Q25_treat_outcome | Swine, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_treat_outcome_swine <- merge.data.table(Q25_treat_outcome_swine_ct, Q25_treat_outcome_swine_pct)

Q25_treat_outcome_swine <- Q25_treat_outcome_swine %>%
    filter(Swine %in% 'TRUE')%>%
    mutate(question="treatment outcomes") %>%
    rename(answer=Q25_treat_outcome) %>% 
    mutate(species="swine") %>%
    rename(response=Swine)

#kable(Q25_treat_outcome_swine)

##Sheep
Q25_treat_outcome_sheep_ct <- data.table(tally( ~ Q25_treat_outcome | Sheep, data = staffvet))
Q25_treat_outcome_sheep_pct <- data.table(round(tally( ~ Q25_treat_outcome | Sheep, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_treat_outcome_sheep <- merge.data.table(Q25_treat_outcome_sheep_ct, Q25_treat_outcome_sheep_pct)

Q25_treat_outcome_sheep <- Q25_treat_outcome_sheep %>%
    filter(Sheep %in% 'TRUE')%>%
    mutate(question="treatment outcomes") %>%
    rename(answer=Q25_treat_outcome) %>% 
    mutate(species="sheep") %>%
    rename(response=Sheep)

#kable(Q25_treat_outcome_sheep)

##Goats
Q25_treat_outcome_goats_ct <- data.table(tally( ~ Q25_treat_outcome | Goats, data = staffvet))
Q25_treat_outcome_goats_pct <- data.table(round(tally( ~ Q25_treat_outcome | Goats, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_treat_outcome_goats <- merge.data.table(Q25_treat_outcome_goats_ct, Q25_treat_outcome_goats_pct)

Q25_treat_outcome_goats <- Q25_treat_outcome_goats %>%
    filter(Goats %in% 'TRUE')%>%
    mutate(question="treatment outcomes") %>%
    rename(answer=Q25_treat_outcome) %>% 
    mutate(species="goats") %>%
    rename(response=Goats)

#kable(Q25_treat_outcome_goats)

##Chickens
Q25_treat_outcome_chickens_ct <- data.table(tally( ~ Q25_treat_outcome | Chickens, data = staffvet))
Q25_treat_outcome_chickens_pct <- data.table(round(tally( ~ Q25_treat_outcome | Chickens, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_treat_outcome_chickens <- merge.data.table(Q25_treat_outcome_chickens_ct, Q25_treat_outcome_chickens_pct)

Q25_treat_outcome_chickens <- Q25_treat_outcome_chickens %>%
    filter(Chickens %in% 'TRUE')%>%
    mutate(question="treatment outcomes") %>%
    rename(answer=Q25_treat_outcome) %>% 
    mutate(species="chickens") %>%
    rename(response=Chickens)

#kable(Q25_treat_outcome_chickens)

##Turkeys
Q25_treat_outcome_turkeys_ct <- data.table(tally( ~ Q25_treat_outcome | Turkeys, data = staffvet))
Q25_treat_outcome_turkeys_pct <- data.table(round(tally( ~ Q25_treat_outcome | Turkeys, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_treat_outcome_turkeys <- merge.data.table(Q25_treat_outcome_turkeys_ct, Q25_treat_outcome_turkeys_pct)

Q25_treat_outcome_turkeys <- Q25_treat_outcome_turkeys %>%
    filter(Turkeys %in% 'TRUE')%>%
    mutate(question="treatment outcomes") %>%
    rename(answer=Q25_treat_outcome) %>% 
    mutate(species="turkeys") %>%
    rename(response=Turkeys)

#kable(Q25_treat_outcome_turkeys)

##Beef and Dairy
Q25_treat_outcome_bd_ct <- data.table(tally( ~ Q25_treat_outcome | beef_dairy, data = staffvet))
Q25_treat_outcome_bd_pct <- data.table(round(tally( ~ Q25_treat_outcome | beef_dairy, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_treat_outcome_bd <- merge.data.table(Q25_treat_outcome_bd_ct, Q25_treat_outcome_bd_pct)

Q25_treat_outcome_bd <- Q25_treat_outcome_bd %>%
    filter(beef_dairy %in% 'TRUE')%>%
    mutate(question="treatment outcomes") %>%
    rename(answer=Q25_treat_outcome) %>% 
    mutate(species="beef and dairy") %>%
    rename(response=beef_dairy)

#kable(Q25_treat_outcome_bd)

##Sheep and Goats
Q25_treat_outcome_sg_ct <- data.table(tally( ~ Q25_treat_outcome | sheep_goat, data = staffvet))
Q25_treat_outcome_sg_pct <- data.table(round(tally( ~ Q25_treat_outcome | sheep_goat, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_treat_outcome_sg <- merge.data.table(Q25_treat_outcome_sg_ct, Q25_treat_outcome_sg_pct)

Q25_treat_outcome_sg <- Q25_treat_outcome_sg %>%
    filter(sheep_goat %in% 'TRUE')%>%
    mutate(question="treatment outcomes") %>%
    rename(answer=Q25_treat_outcome) %>% 
    mutate(species="sheep and goats") %>%
    rename(response=sheep_goat)

#kable(Q25_treat_outcome_sg)

##Chickens and Turkeys
Q25_treat_outcome_ct_ct <- data.table(tally( ~ Q25_treat_outcome | chicken_turkey, data = staffvet))
Q25_treat_outcome_ct_pct <- data.table(round(tally( ~ Q25_treat_outcome | chicken_turkey, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q25_treat_outcome_ct <- merge.data.table(Q25_treat_outcome_ct_ct, Q25_treat_outcome_ct_pct)

Q25_treat_outcome_ct <- Q25_treat_outcome_ct %>%
    filter(chicken_turkey %in% 'TRUE')%>%
    mutate(question="treatment outcomes") %>%
    rename(answer=Q25_treat_outcome) %>% 
    mutate(species="chickens and turkeys") %>%
    rename(response=chicken_turkey)

#kable(Q25_treat_outcome_ct)

#Create a combined table for all species treatment outcome

table_Q25_treat_outcome_spec <- rbind.data.frame(Q25_treat_outcome_beef, Q25_treat_outcome_dairy, Q25_treat_outcome_swine, Q25_treat_outcome_sheep, Q25_treat_outcome_goats, Q25_treat_outcome_chickens, Q25_treat_outcome_turkeys, Q25_treat_outcome_bd, Q25_treat_outcome_sg, Q25_treat_outcome_ct)
#kable(table_Q25_treat_outcome_spec)

#----------------------------
#Create a combined table for all parts of question 25 with species

table_Q25_spec_1 <- rbind.data.frame(table_Q25_repro_perform_spec, table_Q25_econ_perform_spec, table_Q25_disease_incid_spec, table_Q25_amu_spec, table_Q25_treat_outcome_spec)

table_Q25_spec_1 <- table_Q25_spec_1 %>% 
  select(question, species, answer, N, pct)

#kable(table_Q25_spec_1)

table_Q25_spec_1b <-  table_Q25_spec_1 %>% 
  select(-pct) %>% 
  pivot_wider(names_from = answer, values_from = N) %>% 
  pivot_wider(names_from = species, values_from ="I  routinely review these data")

#kable(table_Q25_spec_1b)

table_Q25_spec_1c <-  table_Q25_spec_1 %>% 
  select(-N) %>% 
  pivot_wider(names_from = answer, values_from =pct) %>% 
  #select(-"I do not routinely review these data") %>% 
  pivot_wider(names_from = species, values_from ="I  routinely review these data")

#kable(table_Q25_spec_1c)

#---------------------------
table_Q25_spec_1 <- table_Q25_spec_1 %>% 
  filter(!(answer %in% 'I do not routinely review these data'))%>%
  mutate(question=fct_relevel(question, c("reproductive performance", "economic performance", "disease incidence", "antimicrobial use","treatment outcomes"))) %>% 
   mutate(species=fct_relevel(species,c('beef cattle', 'dairy cattle', 'swine', 'sheep',
                  'goats', 'chickens', 'turkeys', 'beef and dairy', 'sheep and goats', 'chickens and turkeys')))

ggplot(table_Q25_spec_1)+
  geom_bar(aes(x = species, y = pct, 
               fill = factor(question)),
               stat = 'identity', position = 'dodge', fill = "#55C667FF")+
  facet_grid(factor(question)~., scales = 'fixed')+
  theme_bw()+
  labs(x= "Species
       ", y = "Percent of Responses", 
      title = "Categories of Routine Data Review from the Flocks or Herds Under Your Care")+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
  theme(strip.text.y = element_text(angle = 0))+
  theme(legend.title = element_blank())+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  theme(legend.position = "none")
               #ggsave('test.jpg', height = 11, width = 8.5)
```

## Q25 Combined Parts Broke Out By Species (calculated as species response divided by total response per part)
```{r include=FALSE}
#create total count and proportion responses for Q25 by species(long format)
##Reproductive performance
table_Q25_repro_spec <- staffvet %>%
  select(rowid, Q25_repro_perform, Beef_Cattle, Dairy_Cattle, Swine, Sheep, Goats, Chickens, Turkeys, beef_dairy, sheep_goat, chicken_turkey)%>%
  pivot_longer(cols = c(Beef_Cattle, Dairy_Cattle, Swine, Sheep, Goats, Chickens, Turkeys, beef_dairy, sheep_goat, chicken_turkey), 
               names_to = 'Species', 
               values_to = 'Response')%>%
  group_by(Q25_repro_perform)%>%
  mutate(total = n_distinct(rowid), 
         total_sum = sum(n()))%>%
  ungroup()%>%
  filter(Response %in% 'TRUE')%>%

  group_by(Q25_repro_perform, total, Species, Response)%>%
  summarize(species_ct = sum(n()))%>%
  ungroup()%>%
  mutate(pct = species_ct/total) %>% 
  mutate(question="reproductive performance") %>% 
  rename(answer=Q25_repro_perform)
  
kable(table_Q25_repro_spec)

#-------------------------------
##Economic performance
table_Q25_econ_spec <- staffvet %>%
  select(rowid, Q25_econ_perform, Beef_Cattle, Dairy_Cattle, Swine, Sheep, Goats, Chickens, Turkeys, beef_dairy, sheep_goat, chicken_turkey)%>%
  pivot_longer(cols = c(Beef_Cattle, Dairy_Cattle, Swine, Sheep, Goats, Chickens, Turkeys, beef_dairy, sheep_goat, chicken_turkey), 
               names_to = 'Species', 
               values_to = 'Response')%>%
  group_by(Q25_econ_perform)%>%
  mutate(total = n_distinct(rowid), 
         total_sum = sum(n()))%>%
  ungroup()%>%
  filter(Response %in% 'TRUE')%>%

  group_by(Q25_econ_perform, total, Species, Response)%>%
  summarize(species_ct = sum(n()))%>%
  ungroup()%>%
  mutate(pct = species_ct/total) %>% 
  mutate(question="economic performance") %>% 
  rename(answer=Q25_econ_perform)
  
kable(table_Q25_econ_spec)

#-------------------------------
##Disease incidence
table_Q25_di_spec <- staffvet %>%
  select(rowid, Q25_disease_incid, Beef_Cattle, Dairy_Cattle, Swine, Sheep, Goats, Chickens, Turkeys, beef_dairy, sheep_goat, chicken_turkey)%>%
  pivot_longer(cols = c(Beef_Cattle, Dairy_Cattle, Swine, Sheep, Goats, Chickens, Turkeys, beef_dairy, sheep_goat, chicken_turkey), 
               names_to = 'Species', 
               values_to = 'Response')%>%
  group_by(Q25_disease_incid)%>%
  mutate(total = n_distinct(rowid), 
         total_sum = sum(n()))%>%
  ungroup()%>%
  filter(Response %in% 'TRUE')%>%

  group_by(Q25_disease_incid, total, Species, Response)%>%
  summarize(species_ct = sum(n()))%>%
  ungroup()%>%
  mutate(pct = species_ct/total) %>% 
  mutate(question="disease incidence") %>% 
  rename(answer=Q25_disease_incid)
  
kable(table_Q25_di_spec)

#-------------------------------
##Antimicrobial use
table_Q25_amuse_spec <- staffvet %>%
  select(rowid, Q25_amu, Beef_Cattle, Dairy_Cattle, Swine, Sheep, Goats, Chickens, Turkeys, beef_dairy, sheep_goat, chicken_turkey)%>%
  pivot_longer(cols = c(Beef_Cattle, Dairy_Cattle, Swine, Sheep, Goats, Chickens, Turkeys, beef_dairy, sheep_goat, chicken_turkey), 
               names_to = 'Species', 
               values_to = 'Response')%>%
  group_by(Q25_amu)%>%
  mutate(total = n_distinct(rowid), 
         total_sum = sum(n()))%>%
  ungroup()%>%
  filter(Response %in% 'TRUE')%>%

  group_by(Q25_amu, total, Species, Response)%>%
  summarize(species_ct = sum(n()))%>%
  ungroup()%>%
  mutate(pct = species_ct/total) %>% 
  mutate(question="antimicrobial use") %>% 
  rename(answer=Q25_amu)
  
kable(table_Q25_amuse_spec)

#-------------------------------
##Treatment outcomes
table_Q25_to_spec <- staffvet %>%
  select(rowid, Q25_treat_outcome, Beef_Cattle, Dairy_Cattle, Swine, Sheep, Goats, Chickens, Turkeys, beef_dairy, sheep_goat, chicken_turkey)%>%
  pivot_longer(cols = c(Beef_Cattle, Dairy_Cattle, Swine, Sheep, Goats, Chickens, Turkeys, beef_dairy, sheep_goat, chicken_turkey), 
               names_to = 'Species', 
               values_to = 'Response')%>%
  group_by(Q25_treat_outcome)%>%
  mutate(total = n_distinct(rowid), 
         total_sum = sum(n()))%>%
  ungroup()%>%
  filter(Response %in% 'TRUE')%>%

  group_by(Q25_treat_outcome, total, Species, Response)%>%
  summarize(species_ct = sum(n()))%>%
  ungroup()%>%
  mutate(pct = species_ct/total) %>% 
  mutate(question="treatment outcome") %>% 
  rename(answer=Q25_treat_outcome)
  
kable(table_Q25_to_spec)

#----------------------------
#Create a combined table for all parts of question 25 with species

table_Q25_spec_2 <- rbind.data.frame(table_Q25_repro_spec, table_Q25_econ_spec, 
                  table_Q25_di_spec, table_Q25_amuse_spec, table_Q25_to_spec)
kable(table_Q25_spec_2)

#---------------------------
table_Q25_spec_2 <- table_Q25_spec_2 %>%
  filter(!(answer %in% 'I do not routinely review these data'))%>%
  mutate(question=fct_relevel(question, c("reproductive performance", "economic performance", "disease incidence", "antimicrobial use","treatment outcomes"))) %>% 
   mutate(Species=fct_relevel(Species,c('Beef_Cattle', 'Dairy_Cattle', 'Swine', 'Sheep',
                  'Goats', 'Chickens', 'Turkeys', 'beef_dairy', 'sheep_goat', 'chicken_turkey')))

ggplot(table_Q25_spec_2)+
  geom_bar(aes(x = Species, y = pct, 
               fill = factor(question)),
               stat = 'identity', position = 'dodge')+
               facet_grid(factor(question)~., scales = 'free')+
               theme(axis.text.x = element_text(angle = 45, hjust = 1))
               #ggsave('test.jpg', height = 11, width = 8.5)

```

## Q26 Given that adequate data tools were available and you were appropriately compensated, would you be willing to begin or expand routine analysis of disease incidence, antimicrobial use, and treatment outcome data with your clients? (Y/N)
```{r echo=FALSE}
#Filter out Staff Vet
Q26_filter <- AMU_Survey_Final %>%
  filter(!(practice_type %in% 'Staff Vet')) 
  
Q26_filter_grad_yr <- Q26_filter %>% 
  filter(!(grad_year_cat %in% 'Unknown'))

#count and proportions
Q26_expand_routine_analysis_ct <- data.table(tally( ~ Q26_expand_routine_analysis , data = Q26_filter))
Q26_expand_routine_analysis_pct <- data.table(round(tally( ~ Q26_expand_routine_analysis , data = Q26_filter,
    format("proportion")),4))%>% 
    rename(pct = N)

Q26_expand_routine_analysis <- merge.data.table(Q26_expand_routine_analysis_ct, Q26_expand_routine_analysis_pct) 
kable(Q26_expand_routine_analysis)

#Add graduate year
Q26_expand_routine_analysis_yr_ct <- data.table(tally( ~ Q26_expand_routine_analysis | grad_year_cat , data = Q26_filter_grad_yr))
Q26_expand_routine_analysis_yr_pct <- data.table(round(tally( ~ Q26_expand_routine_analysis | grad_year_cat , 
    data = Q26_filter_grad_yr, format("proportion")),4))%>% 
    rename(pct = N)

Q26_expand_routine_analysis_yr <- merge.data.table(Q26_expand_routine_analysis_yr_ct, Q26_expand_routine_analysis_yr_pct) %>% 
    arrange(factor(grad_year_cat, levels = c("<1987", "1987-1999", "2000-2010", "2011-2016", ">2016")))
   

Q26_expand_routine_analysis_yr <- Q26_expand_routine_analysis_yr %>% 
    filter(!(grad_year_cat %in% 'Unknown')) %>% 
    select(grad_year_cat, Q26_expand_routine_analysis, N, pct)

#kable(Q26_expand_routine_analysis_yr)

Q26_expand_routine_analysis_yrb <-  Q26_expand_routine_analysis_yr %>% 
  select(-pct) %>% 
  pivot_wider(names_from = Q26_expand_routine_analysis, values_from = N)  %>% 
  arrange(desc(Yes))

kable(Q26_expand_routine_analysis_yrb)

Q26_expand_routine_analysis_yrc <-  Q26_expand_routine_analysis_yr %>% 
  select(-N) %>% 
  pivot_wider(names_from = Q26_expand_routine_analysis, values_from =pct) %>% 
  arrange(desc(Yes))

kable(Q26_expand_routine_analysis_yrc)

#kable(table(Q26_filter$grad_year_cat, Q26_filter$Q26_expand_routine_analysis))

#Add practice type
Q26_expand_routine_analysis_prac_ct <- data.table(tally(Q26_expand_routine_analysis ~ practice_type , data = Q26_filter))
Q26_expand_routine_analysis_prac_pct <- data.table(round(tally(Q26_expand_routine_analysis ~ practice_type , 
    data = Q26_filter, format("proportion")),4))%>% 
    rename(pct = N)

Q26_expand_routine_analysis_prac <- merge.data.table(Q26_expand_routine_analysis_prac_ct, 
    Q26_expand_routine_analysis_prac_pct) %>% 
    arrange(factor(practice_type, levels = c("Private General Practice", "Food Animal Practice", "Consultant", 
                                     "Staff Vet", "Academia", "None")))

Q26_expand_routine_analysis_prac <- Q26_expand_routine_analysis_prac %>% 
  select(practice_type, Q26_expand_routine_analysis, N, pct) %>% 
  filter(!(practice_type %in% "Staff Vet"))

#kable(Q26_expand_routine_analysis_prac)

Q26_expand_routine_analysis_pracb <-  Q26_expand_routine_analysis_prac %>% 
  select(-pct) %>% 
  pivot_wider(names_from = Q26_expand_routine_analysis, values_from = N)  %>% 
  arrange(desc(Yes)) 

kable(Q26_expand_routine_analysis_pracb)

Q26_expand_routine_analysis_pracc <-  Q26_expand_routine_analysis_prac %>% 
  select(-N) %>% 
  pivot_wider(names_from = Q26_expand_routine_analysis, values_from =pct)  %>% 
  arrange(desc(Yes))

kable(Q26_expand_routine_analysis_pracc)

#kable(table(Q26_filter$practice_type, Q26_filter$Q26_expand_routine_analysis))
```

## Q27 Considering the clients for which you do not review data related to disease incidence, antimicrobial use, or treatment outcome, which of these barriers do you perceive as contributing to this lack of interaction for at least some clients? 
```{r echo=FALSE, message=FALSE, warning=FALSE}
#Filter out Staff Vet
Q27_filter <- AMU_Survey_Final %>%
  filter(!(practice_type %in% 'Staff Vet'))

Q27_filter_grad_yr <- Q27_filter %>% 
  filter(!(grad_year_cat %in% 'Unknown'))

#-------------------------------
#create total count and proportion responses for reason (long format)
Q27_2 <- Q27_filter %>%
  select(rowid, Q27_not_applicable, Q27_lack_data, Q27_unwilling_compensate, Q27_unwilling_share_data, Q27_few_animals, Q27_unsure_returns, Q27_not_priority, Q27_no_time)%>%
  pivot_longer(cols = c(Q27_not_applicable, Q27_lack_data, Q27_unwilling_compensate, Q27_unwilling_share_data, Q27_few_animals, Q27_unsure_returns, Q27_not_priority, Q27_no_time), 
               names_to = 'Reason', 
               values_to = 'Answer')%>%
  mutate(total = n_distinct(rowid), 
         total_sum = sum(n()))%>%
  filter(Answer %in% 'TRUE')%>%

  group_by(total, Reason, Answer)%>%
  summarize(reason_ct = sum(n()))%>%
  ungroup()%>%
  mutate(pct = reason_ct/total)

#kable(Q27_2)

#-----------------------------------
#rename reasons
Q27_2 <- Q27_2 %>% 
  mutate(Reason=fct_relevel(Reason, c('Q27_not_applicable', 'Q27_lack_data', 'Q27_unwilling_compensate', 'Q27_unwilling_share_data', 'Q27_few_animals', 'Q27_unsure_returns', 'Q27_not_priority', 'Q27_no_time')))

levels(Q27_2$Reason) <- c("not applicable", "lack of data system", "client unwilling to compensate", "client is unwilling to share data", "too few animals", "unsure how to return value", "not priority to client", "I don't have time")

Q27_2 <- Q27_2 %>% 
  mutate(Reason=fct_relevel(Reason, c("not applicable", "lack of data system", "client unwilling to compensate", "client is unwilling to share data", "too few animals", "unsure how to return value", "not priority to client", "I don't have time"))) %>% 
  arrange(factor(Reason, levels = c("not applicable", "lack of data system", "client unwilling to compensate", "client is unwilling to share data", "too few animals", "unsure how to return value", "not priority to client", "I don't have time")))

Q27_2 <- Q27_2 %>% 
  select(-total, -Answer) %>% 
  arrange(desc(pct))

kable(Q27_2)

Q27_2 <- Q27_2 %>% 
  mutate(Reason=fct_relevel(Reason, c("lack of data system", "client unwilling to compensate", 
        "not priority to client", "too few animals", "client is unwilling to share data",
        "unsure how to return value", "I don't have time", "not applicable")))

#bar chart of reason for not reviewing data
ggplot(Q27_2)+
  geom_bar(aes(x = Reason, y = pct, 
               fill = factor(Reason)),
               stat = 'identity', position = 'dodge', fill = "#404788FF")+
  theme_bw()+
  labs(x= "Barriers", y = "Percent of Responses", 
                    title = "Barriers to Lack of Data Review")+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
  theme(strip.text.y = element_text(angle = 0))+
  theme(legend.position = "none")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
          #ggsave('test.jpg', height = 11, width = 8.5)

#--------------------------------------
#create total count and proportion responses for reason by grad year category (wide format)
Q27_1 <- Q27_filter_grad_yr %>%
group_by(grad_year_cat) %>%
summarise(total = sum(n()), 
          total_n_dist = n_distinct(rowid), 
          Q27_not_applicable_ct = sum(Q27_not_applicable), 
          Q27_lack_data_ct = sum(Q27_lack_data), 
          Q27_unwilling_compensate_ct = sum(Q27_unwilling_compensate),
          Q27_unwilling_share_data_ct = sum(Q27_unwilling_share_data),
          Q27_few_animals_ct = sum(Q27_few_animals),
          Q27_unsure_returns_ct = sum(Q27_unsure_returns),
          Q27_not_priority_ct = sum(Q27_not_priority),
          Q27_no_time_ct = sum(Q27_no_time))%>%
  ungroup()%>%
  mutate(pct_Q27_not_applicable = Q27_not_applicable_ct/total_n_dist, 
         pct_Q27_lack_data = Q27_lack_data_ct/total_n_dist,
         pct_Q27_unwilling_compensate = Q27_unwilling_compensate_ct/total_n_dist,
         pct_Q27_unwilling_share_data = Q27_unwilling_share_data_ct/total_n_dist, 
         pct_Q27_few_animals = Q27_few_animals_ct/total_n_dist,
         pct_Q27_unsure_returns = Q27_unsure_returns_ct/total_n_dist,
         Q27_not_priority_data = Q27_not_priority_ct/total_n_dist,
         pct_Q27_no_time = Q27_no_time_ct/total_n_dist)

#kable(Q27_1)
```

## Q28 If you do not review data related to disease incidence, antimicrobial use, or treatment outcome within the herds or flocks under your care, which of these barriers do you perceive as contributing to this lack of review? 
```{r echo=FALSE, message=FALSE, warning=FALSE}
#Filter in only Staff Vet
Q28_filter <- AMU_Survey_Final %>%
  filter(practice_type %in% 'Staff Vet')

Q28_filter_grad_yr <- Q28_filter %>% 
  filter(!(grad_year_cat %in% 'Unknown'))

#-------------------------------
#create total count and proportion responses for reason (long format)
Q28_2 <- Q28_filter %>%
  select(rowid, Q28_not_applicable, Q28_lack_data, Q28_unsure_returns, Q28_no_time)%>%
  pivot_longer(cols = c(Q28_not_applicable, Q28_lack_data, Q28_unsure_returns, Q28_no_time), 
               names_to = 'Reason', 
               values_to = 'Answer')%>%
  mutate(total = n_distinct(rowid), 
         total_sum = sum(n()))%>%
  filter(Answer %in% 'TRUE')%>%

  group_by(total, Reason, Answer)%>%
  summarize(reason_ct = sum(n()))%>%
  ungroup()%>%
  mutate(pct = reason_ct/total)

#kable(Q28_2)

#-----------------------------------
#rename reasons
Q28_2 <- Q28_2 %>% 
  mutate(Reason=fct_relevel(Reason, c('Q28_not_applicable', 'Q28_lack_data', 'Q28_unsure_returns',
                                      'Q28_no_time')))

levels(Q28_2$Reason) <- c("not applicable", "lack of data system", "unsure how to return value",
                                      "I don't have time")

Q28_2 <- Q28_2 %>% 
  mutate(Reason=fct_relevel(Reason, c("not applicable", "lack of data system", 
                                      "I don't have time", "unsure how to return value" ))) %>% 
    arrange(factor(Reason, levels = c("not applicable", "lack of data system", "I don't have time",
                                      "unsure how to return value"))) %>% 
  select(-total, -Answer)

kable(Q28_2)

#bar chart of reason for reviewing data
ggplot(Q28_2)+
  geom_bar(aes(x = Reason, y = pct, 
               fill = factor(Reason)),
               stat = 'identity', position = 'dodge', fill = "#29AF7FFF")+
  theme_bw()+
  labs(x= "Barriers", y = "Percent of Responses", 
                    title = "Barriers to Lack of Data Review")+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
  theme(strip.text.y = element_text(angle = 0))+
  theme(legend.position = "none")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
          #ggsave('test.jpg', height = 11, width = 8.5)

#-------------------------------
#create total count and proportion responses for reason by grad year category (wide format)
Q28_1 <- Q28_filter_grad_yr %>%
group_by(grad_year_cat) %>%
summarise(total = sum(n()), 
          total_n_dist = n_distinct(rowid), 
          Q28_not_applicable_ct = sum(Q28_not_applicable), 
          Q28_lack_data_ct = sum(Q28_lack_data), 
          Q28_unsure_returns_ct = sum(Q28_unsure_returns),
          Q28_no_time_ct = sum(Q28_no_time))%>%
  ungroup()%>%
  mutate(pct_Q28_not_applicable = Q28_not_applicable_ct/total_n_dist, 
         pct_Q28_lack_data = Q28_lack_data_ct/total_n_dist,
         pct_Q28_unsure_returns = Q28_unsure_returns_ct/total_n_dist,
         pct_Q28_no_time = Q28_no_time_ct/total_n_dist)

#kable(Q28_1)
```

## Q28 Reason Staff Vet Not Reviewing Data Broken out by Species
```{r echo=FALSE, message=FALSE, warning=FALSE}
#count and proportions for not applicable
##Beef
Q28_not_applicable_beef_ct <- data.table(tally( ~ Q28_not_applicable | Beef_Cattle, data = staffvet))
Q28_not_applicable_beef_pct <- data.table(round(tally( ~ Q28_not_applicable | Beef_Cattle, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_not_applicable_beef <- merge.data.table(Q28_not_applicable_beef_ct, Q28_not_applicable_beef_pct)

Q28_not_applicable_beef <- Q28_not_applicable_beef %>%
    filter(Beef_Cattle %in% 'TRUE')%>%
    mutate(Reason="not applicable") %>%
    rename(answer=Q28_not_applicable) %>% 
    mutate(species="beef cattle") %>%
    rename(response=Beef_Cattle)

#kable(Q28_not_applicable_beef)

##Dairy
Q28_not_applicable_dairy_ct <- data.table(tally( ~ Q28_not_applicable | Dairy_Cattle, data = staffvet))
Q28_not_applicable_dairy_pct <- data.table(round(tally( ~ Q28_not_applicable | Dairy_Cattle, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_not_applicable_dairy <- merge.data.table(Q28_not_applicable_dairy_ct, Q28_not_applicable_dairy_pct)

Q28_not_applicable_dairy <- Q28_not_applicable_dairy %>%
    filter(Dairy_Cattle %in% 'TRUE')%>%
    mutate(Reason="not applicable") %>%
    rename(answer=Q28_not_applicable) %>% 
    mutate(species="dairy cattle") %>%
    rename(response=Dairy_Cattle)

#kable(Q28_not_applicable_dairy)

##Swine
Q28_not_applicable_swine_ct <- data.table(tally( ~ Q28_not_applicable | Swine, data = staffvet))
Q28_not_applicable_swine_pct <- data.table(round(tally( ~ Q28_not_applicable | Swine, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_not_applicable_swine <- merge.data.table(Q28_not_applicable_swine_ct, Q28_not_applicable_swine_pct)

Q28_not_applicable_swine <- Q28_not_applicable_swine %>%
    filter(Swine %in% 'TRUE')%>%
    mutate(Reason="not applicable") %>%
    rename(answer=Q28_not_applicable) %>% 
    mutate(species="swine") %>%
    rename(response=Swine)

#kable(Q28_not_applicable_swine)

##Sheep
Q28_not_applicable_sheep_ct <- data.table(tally( ~ Q28_not_applicable | Sheep, data = staffvet))
Q28_not_applicable_sheep_pct <- data.table(round(tally( ~ Q28_not_applicable | Sheep, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_not_applicable_sheep <- merge.data.table(Q28_not_applicable_sheep_ct, Q28_not_applicable_sheep_pct)

Q28_not_applicable_sheep <- Q28_not_applicable_sheep %>%
    filter(Sheep %in% 'TRUE')%>%
    mutate(Reason="not applicable") %>%
    rename(answer=Q28_not_applicable) %>% 
    mutate(species="sheep") %>%
    rename(response=Sheep)

#kable(Q28_not_applicable_sheep)

##Goats
Q28_not_applicable_goats_ct <- data.table(tally( ~ Q28_not_applicable | Goats, data = staffvet))
Q28_not_applicable_goats_pct <- data.table(round(tally( ~ Q28_not_applicable | Goats, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_not_applicable_goats <- merge.data.table(Q28_not_applicable_goats_ct, Q28_not_applicable_goats_pct)

Q28_not_applicable_goats <- Q28_not_applicable_goats %>%
    filter(Goats %in% 'TRUE')%>%
    mutate(Reason="not applicable") %>%
    rename(answer=Q28_not_applicable) %>% 
    mutate(species="goats") %>%
    rename(response=Goats)

#kable(Q28_not_applicable_goats)

##Chickens
Q28_not_applicable_chickens_ct <- data.table(tally( ~ Q28_not_applicable | Chickens, data = staffvet))
Q28_not_applicable_chickens_pct <- data.table(round(tally( ~ Q28_not_applicable | Chickens, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_not_applicable_chickens <- merge.data.table(Q28_not_applicable_chickens_ct, Q28_not_applicable_chickens_pct)

Q28_not_applicable_chickens <- Q28_not_applicable_chickens %>%
    filter(Chickens %in% 'TRUE')%>%
    mutate(Reason="not applicable") %>%
    rename(answer=Q28_not_applicable) %>% 
    mutate(species="chickens") %>%
    rename(response=Chickens)

#kable(Q28_not_applicable_chickens)

##Turkeys
Q28_not_applicable_turkeys_ct <- data.table(tally( ~ Q28_not_applicable | Turkeys, data = staffvet))
Q28_not_applicable_turkeys_pct <- data.table(round(tally( ~ Q28_not_applicable | Turkeys, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_not_applicable_turkeys <- merge.data.table(Q28_not_applicable_turkeys_ct, Q28_not_applicable_turkeys_pct)

Q28_not_applicable_turkeys <- Q28_not_applicable_turkeys %>%
    filter(Turkeys %in% 'TRUE')%>%
    mutate(Reason="not applicable") %>%
    rename(answer=Q28_not_applicable) %>% 
    mutate(species="turkeys") %>%
    rename(response=Turkeys)

#kable(Q28_not_applicable_turkeys)

##Beef and Dairy
Q28_not_applicable_bd_ct <- data.table(tally( ~ Q28_not_applicable | beef_dairy, data = staffvet))
Q28_not_applicable_bd_pct <- data.table(round(tally( ~ Q28_not_applicable | beef_dairy, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_not_applicable_bd <- merge.data.table(Q28_not_applicable_bd_ct, Q28_not_applicable_bd_pct)

Q28_not_applicable_bd <- Q28_not_applicable_bd %>%
    filter(beef_dairy %in% 'TRUE')%>%
    mutate(Reason="not applicable") %>%
    rename(answer=Q28_not_applicable) %>% 
    mutate(species="beef and dairy") %>%
    rename(response=beef_dairy)

#kable(Q28_not_applicable_bd)

##Sheep and Goats
Q28_not_applicable_sg_ct <- data.table(tally( ~ Q28_not_applicable | sheep_goat, data = staffvet))
Q28_not_applicable_sg_pct <- data.table(round(tally( ~ Q28_not_applicable | sheep_goat, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_not_applicable_sg <- merge.data.table(Q28_not_applicable_sg_ct, Q28_not_applicable_sg_pct)

Q28_not_applicable_sg <- Q28_not_applicable_sg %>%
    filter(sheep_goat %in% 'TRUE')%>%
    mutate(Reason="not applicable") %>%
    rename(answer=Q28_not_applicable) %>% 
    mutate(species="sheep and goats") %>%
    rename(response=sheep_goat)

#kable(Q28_not_applicable_sg)

##Chickens and Turkeys
Q28_not_applicable_ct_ct <- data.table(tally( ~ Q28_not_applicable | chicken_turkey, data = staffvet))
Q28_not_applicable_ct_pct <- data.table(round(tally( ~ Q28_not_applicable | chicken_turkey, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_not_applicable_ct <- merge.data.table(Q28_not_applicable_ct_ct, Q28_not_applicable_ct_pct)

Q28_not_applicable_ct <- Q28_not_applicable_ct %>%
    filter(chicken_turkey %in% 'TRUE')%>%
    mutate(Reason="not applicable") %>%
    rename(answer=Q28_not_applicable) %>% 
    mutate(species="chickens and turkeys") %>%
    rename(response=chicken_turkey)

#kable(Q28_not_applicable_ct)

#Create a combined table for all species not applicable

table_Q28_not_applicable_spec <- rbind.data.frame(Q28_not_applicable_beef, Q28_not_applicable_dairy, Q28_not_applicable_swine, Q28_not_applicable_sheep, Q28_not_applicable_goats, Q28_not_applicable_chickens, Q28_not_applicable_turkeys, Q28_not_applicable_bd, Q28_not_applicable_sg, Q28_not_applicable_ct)
#kable(table_Q28_not_applicable_spec)

#--------------------------------------------------------
#count and proportions for lack of data system
##Beef
Q28_lack_data_beef_ct <- data.table(tally( ~ Q28_lack_data | Beef_Cattle, data = staffvet))
Q28_lack_data_beef_pct <- data.table(round(tally( ~ Q28_lack_data | Beef_Cattle, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_lack_data_beef <- merge.data.table(Q28_lack_data_beef_ct, Q28_lack_data_beef_pct)

Q28_lack_data_beef <- Q28_lack_data_beef %>%
    filter(Beef_Cattle %in% 'TRUE')%>%
    mutate(Reason="lack of data system") %>%
    rename(answer=Q28_lack_data) %>% 
    mutate(species="beef cattle") %>%
    rename(response=Beef_Cattle)

#kable(Q28_lack_data_beef)

##Dairy
Q28_lack_data_dairy_ct <- data.table(tally( ~ Q28_lack_data | Dairy_Cattle, data = staffvet))
Q28_lack_data_dairy_pct <- data.table(round(tally( ~ Q28_lack_data | Dairy_Cattle, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_lack_data_dairy <- merge.data.table(Q28_lack_data_dairy_ct, Q28_lack_data_dairy_pct)

Q28_lack_data_dairy <- Q28_lack_data_dairy %>%
    filter(Dairy_Cattle %in% 'TRUE')%>%
    mutate(Reason="lack of data system") %>%
    rename(answer=Q28_lack_data) %>% 
    mutate(species="dairy cattle") %>%
    rename(response=Dairy_Cattle)

#kable(Q28_lack_data_dairy)

##Swine
Q28_lack_data_swine_ct <- data.table(tally( ~ Q28_lack_data | Swine, data = staffvet))
Q28_lack_data_swine_pct <- data.table(round(tally( ~ Q28_lack_data | Swine, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_lack_data_swine <- merge.data.table(Q28_lack_data_swine_ct, Q28_lack_data_swine_pct)

Q28_lack_data_swine <- Q28_lack_data_swine %>%
    filter(Swine %in% 'TRUE')%>%
    mutate(Reason="lack of data system") %>%
    rename(answer=Q28_lack_data) %>% 
    mutate(species="swine") %>%
    rename(response=Swine)

#kable(Q28_lack_data_swine)

##Sheep
Q28_lack_data_sheep_ct <- data.table(tally( ~ Q28_lack_data | Sheep, data = staffvet))
Q28_lack_data_sheep_pct <- data.table(round(tally( ~ Q28_lack_data | Sheep, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_lack_data_sheep <- merge.data.table(Q28_lack_data_sheep_ct, Q28_lack_data_sheep_pct)

Q28_lack_data_sheep <- Q28_lack_data_sheep %>%
    filter(Sheep %in% 'TRUE')%>%
    mutate(Reason="lack of data system") %>%
    rename(answer=Q28_lack_data) %>% 
    mutate(species="sheep") %>%
    rename(response=Sheep)

#kable(Q28_lack_data_sheep)

##Goats
Q28_lack_data_goats_ct <- data.table(tally( ~ Q28_lack_data | Goats, data = staffvet))
Q28_lack_data_goats_pct <- data.table(round(tally( ~ Q28_lack_data | Goats, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_lack_data_goats <- merge.data.table(Q28_lack_data_goats_ct, Q28_lack_data_goats_pct)

Q28_lack_data_goats <- Q28_lack_data_goats %>%
    filter(Goats %in% 'TRUE')%>%
    mutate(Reason="lack of data system") %>%
    rename(answer=Q28_lack_data) %>% 
    mutate(species="goats") %>%
    rename(response=Goats)

#kable(Q28_lack_data_goats)

##Chickens
Q28_lack_data_chickens_ct <- data.table(tally( ~ Q28_lack_data | Chickens, data = staffvet))
Q28_lack_data_chickens_pct <- data.table(round(tally( ~ Q28_lack_data | Chickens, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_lack_data_chickens <- merge.data.table(Q28_lack_data_chickens_ct, Q28_lack_data_chickens_pct)

Q28_lack_data_chickens <- Q28_lack_data_chickens %>%
    filter(Chickens %in% 'TRUE')%>%
    mutate(Reason="lack of data system") %>%
    rename(answer=Q28_lack_data) %>% 
    mutate(species="chickens") %>%
    rename(response=Chickens)

#kable(Q28_lack_data_chickens)

##Turkeys
Q28_lack_data_turkeys_ct <- data.table(tally( ~ Q28_lack_data | Turkeys, data = staffvet))
Q28_lack_data_turkeys_pct <- data.table(round(tally( ~ Q28_lack_data | Turkeys, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_lack_data_turkeys <- merge.data.table(Q28_lack_data_turkeys_ct, Q28_lack_data_turkeys_pct)

Q28_lack_data_turkeys <- Q28_lack_data_turkeys %>%
    filter(Turkeys %in% 'TRUE')%>%
    mutate(Reason="lack of data system") %>%
    rename(answer=Q28_lack_data) %>% 
    mutate(species="turkeys") %>%
    rename(response=Turkeys)

#kable(Q28_lack_data_turkeys)

##Beef and Dairy
Q28_lack_data_bd_ct <- data.table(tally( ~ Q28_lack_data | beef_dairy, data = staffvet))
Q28_lack_data_bd_pct <- data.table(round(tally( ~ Q28_lack_data | beef_dairy, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_lack_data_bd <- merge.data.table(Q28_lack_data_bd_ct, Q28_lack_data_bd_pct)

Q28_lack_data_bd <- Q28_lack_data_bd %>%
    filter(beef_dairy %in% 'TRUE')%>%
    mutate(Reason="lack of data system") %>%
    rename(answer=Q28_lack_data) %>% 
    mutate(species="beef and dairy") %>%
    rename(response=beef_dairy)

#kable(Q28_lack_data_bd)

##Sheep and Goats
Q28_lack_data_sg_ct <- data.table(tally( ~ Q28_lack_data | sheep_goat, data = staffvet))
Q28_lack_data_sg_pct <- data.table(round(tally( ~ Q28_lack_data | sheep_goat, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_lack_data_sg <- merge.data.table(Q28_lack_data_sg_ct, Q28_lack_data_sg_pct)

Q28_lack_data_sg <- Q28_lack_data_sg %>%
    filter(sheep_goat %in% 'TRUE')%>%
    mutate(Reason="lack of data system") %>%
    rename(answer=Q28_lack_data) %>% 
    mutate(species="sheep and goats") %>%
    rename(response=sheep_goat)

#kable(Q28_lack_data_sg)

##Chickens and Turkeys
Q28_lack_data_ct_ct <- data.table(tally( ~ Q28_lack_data | chicken_turkey, data = staffvet))
Q28_lack_data_ct_pct <- data.table(round(tally( ~ Q28_lack_data | chicken_turkey, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_lack_data_ct <- merge.data.table(Q28_lack_data_ct_ct, Q28_lack_data_ct_pct)

Q28_lack_data_ct <- Q28_lack_data_ct %>%
    filter(chicken_turkey %in% 'TRUE')%>%
    mutate(Reason="lack of data system") %>%
    rename(answer=Q28_lack_data) %>% 
    mutate(species="chickens and turkeys") %>%
    rename(response=chicken_turkey)

#kable(Q28_lack_data_ct)

#Create a combined table for all species lack of data system

table_Q28_lack_data_spec <- rbind.data.frame(Q28_lack_data_beef, Q28_lack_data_dairy, Q28_lack_data_swine, Q28_lack_data_sheep, Q28_lack_data_goats, Q28_lack_data_chickens, Q28_lack_data_turkeys, Q28_lack_data_bd, Q28_lack_data_sg, Q28_lack_data_ct)
#kable(table_Q28_lack_data_spec)

#--------------------------------------------------------
#count and proportions for unsure how to return value
##Beef
Q28_unsure_returns_beef_ct <- data.table(tally( ~ Q28_unsure_returns | Beef_Cattle, data = staffvet))
Q28_unsure_returns_beef_pct <- data.table(round(tally( ~ Q28_unsure_returns | Beef_Cattle, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_unsure_returns_beef <- merge.data.table(Q28_unsure_returns_beef_ct, Q28_unsure_returns_beef_pct)

Q28_unsure_returns_beef <- Q28_unsure_returns_beef %>%
    filter(Beef_Cattle %in% 'TRUE')%>%
    mutate(Reason="unsure how to return value") %>%
    rename(answer=Q28_unsure_returns) %>% 
    mutate(species="beef cattle") %>%
    rename(response=Beef_Cattle)

#kable(Q28_unsure_returns_beef)

##Dairy
Q28_unsure_returns_dairy_ct <- data.table(tally( ~ Q28_unsure_returns | Dairy_Cattle, data = staffvet))
Q28_unsure_returns_dairy_pct <- data.table(round(tally( ~ Q28_unsure_returns | Dairy_Cattle, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_unsure_returns_dairy <- merge.data.table(Q28_unsure_returns_dairy_ct, Q28_unsure_returns_dairy_pct)

Q28_unsure_returns_dairy <- Q28_unsure_returns_dairy %>%
    filter(Dairy_Cattle %in% 'TRUE')%>%
    mutate(Reason="unsure how to return value") %>%
    rename(answer=Q28_unsure_returns) %>% 
    mutate(species="dairy cattle") %>%
    rename(response=Dairy_Cattle)

#kable(Q28_unsure_returns_dairy)

##Swine
Q28_unsure_returns_swine_ct <- data.table(tally( ~ Q28_unsure_returns | Swine, data = staffvet))
Q28_unsure_returns_swine_pct <- data.table(round(tally( ~ Q28_unsure_returns | Swine, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_unsure_returns_swine <- merge.data.table(Q28_unsure_returns_swine_ct, Q28_unsure_returns_swine_pct)

Q28_unsure_returns_swine <- Q28_unsure_returns_swine %>%
    filter(Swine %in% 'TRUE')%>%
    mutate(Reason="unsure how to return value") %>%
    rename(answer=Q28_unsure_returns) %>% 
    mutate(species="swine") %>%
    rename(response=Swine)

#kable(Q28_unsure_returns_swine)

##Sheep
Q28_unsure_returns_sheep_ct <- data.table(tally( ~ Q28_unsure_returns | Sheep, data = staffvet))
Q28_unsure_returns_sheep_pct <- data.table(round(tally( ~ Q28_unsure_returns | Sheep, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_unsure_returns_sheep <- merge.data.table(Q28_unsure_returns_sheep_ct, Q28_unsure_returns_sheep_pct)

Q28_unsure_returns_sheep <- Q28_unsure_returns_sheep %>%
    filter(Sheep %in% 'TRUE')%>%
    mutate(Reason="unsure how to return value") %>%
    rename(answer=Q28_unsure_returns) %>% 
    mutate(species="sheep") %>%
    rename(response=Sheep)

#kable(Q28_unsure_returns_sheep)

##Goats
Q28_unsure_returns_goats_ct <- data.table(tally( ~ Q28_unsure_returns | Goats, data = staffvet))
Q28_unsure_returns_goats_pct <- data.table(round(tally( ~ Q28_unsure_returns | Goats, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_unsure_returns_goats <- merge.data.table(Q28_unsure_returns_goats_ct, Q28_unsure_returns_goats_pct)

Q28_unsure_returns_goats <- Q28_unsure_returns_goats %>%
    filter(Goats %in% 'TRUE')%>%
    mutate(Reason="unsure how to return value") %>%
    rename(answer=Q28_unsure_returns) %>% 
    mutate(species="goats") %>%
    rename(response=Goats)

#kable(Q28_unsure_returns_goats)

##Chickens
Q28_unsure_returns_chickens_ct <- data.table(tally( ~ Q28_unsure_returns | Chickens, data = staffvet))
Q28_unsure_returns_chickens_pct <- data.table(round(tally( ~ Q28_unsure_returns | Chickens, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_unsure_returns_chickens <- merge.data.table(Q28_unsure_returns_chickens_ct, Q28_unsure_returns_chickens_pct)

Q28_unsure_returns_chickens <- Q28_unsure_returns_chickens %>%
    filter(Chickens %in% 'TRUE')%>%
    mutate(Reason="unsure how to return value") %>%
    rename(answer=Q28_unsure_returns) %>% 
    mutate(species="chickens") %>%
    rename(response=Chickens)

#kable(Q28_unsure_returns_chickens)

##Turkeys
Q28_unsure_returns_turkeys_ct <- data.table(tally( ~ Q28_unsure_returns | Turkeys, data = staffvet))
Q28_unsure_returns_turkeys_pct <- data.table(round(tally( ~ Q28_unsure_returns | Turkeys, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_unsure_returns_turkeys <- merge.data.table(Q28_unsure_returns_turkeys_ct, Q28_unsure_returns_turkeys_pct)

Q28_unsure_returns_turkeys <- Q28_unsure_returns_turkeys %>%
    filter(Turkeys %in% 'TRUE')%>%
    mutate(Reason="unsure how to return value") %>%
    rename(answer=Q28_unsure_returns) %>% 
    mutate(species="turkeys") %>%
    rename(response=Turkeys)

#kable(Q28_unsure_returns_turkeys)

##Beef and Dairy
Q28_unsure_returns_bd_ct <- data.table(tally( ~ Q28_unsure_returns | beef_dairy, data = staffvet))
Q28_unsure_returns_bd_pct <- data.table(round(tally( ~ Q28_unsure_returns | beef_dairy, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_unsure_returns_bd <- merge.data.table(Q28_unsure_returns_bd_ct, Q28_unsure_returns_bd_pct)

Q28_unsure_returns_bd <- Q28_unsure_returns_bd %>%
    filter(beef_dairy %in% 'TRUE')%>%
    mutate(Reason="unsure how to return value") %>%
    rename(answer=Q28_unsure_returns) %>% 
    mutate(species="beef and dairy") %>%
    rename(response=beef_dairy)

#kable(Q28_unsure_returns_bd)

##Sheep and Goats
Q28_unsure_returns_sg_ct <- data.table(tally( ~ Q28_unsure_returns | sheep_goat, data = staffvet))
Q28_unsure_returns_sg_pct <- data.table(round(tally( ~ Q28_unsure_returns | sheep_goat, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_unsure_returns_sg <- merge.data.table(Q28_unsure_returns_sg_ct, Q28_unsure_returns_sg_pct)

Q28_unsure_returns_sg <- Q28_unsure_returns_sg %>%
    filter(sheep_goat %in% 'TRUE')%>%
    mutate(Reason="unsure how to return value") %>%
    rename(answer=Q28_unsure_returns) %>% 
    mutate(species="sheep and goats") %>%
    rename(response=sheep_goat)

#kable(Q28_unsure_returns_sg)

##Chickens and Turkeys
Q28_unsure_returns_ct_ct <- data.table(tally( ~ Q28_unsure_returns | chicken_turkey, data = staffvet))
Q28_unsure_returns_ct_pct <- data.table(round(tally( ~ Q28_unsure_returns | chicken_turkey, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_unsure_returns_ct <- merge.data.table(Q28_unsure_returns_ct_ct, Q28_unsure_returns_ct_pct)

Q28_unsure_returns_ct <- Q28_unsure_returns_ct %>%
    filter(chicken_turkey %in% 'TRUE')%>%
    mutate(Reason="unsure how to return value") %>%
    rename(answer=Q28_unsure_returns) %>% 
    mutate(species="chickens and turkeys") %>%
    rename(response=chicken_turkey)

#kable(Q28_unsure_returns_ct)

#Create a combined table for all species unsure how to return value

table_Q28_unsure_returns_spec <- rbind.data.frame(Q28_unsure_returns_beef, Q28_unsure_returns_dairy, Q28_unsure_returns_swine, Q28_unsure_returns_sheep, Q28_unsure_returns_goats, Q28_unsure_returns_chickens, Q28_unsure_returns_turkeys, Q28_unsure_returns_bd, Q28_unsure_returns_sg, Q28_unsure_returns_ct)
#kable(table_Q28_unsure_returns_spec)

#--------------------------------------------------------
#count and proportions for I don't have time
##Beef
Q28_no_time_beef_ct <- data.table(tally( ~ Q28_no_time | Beef_Cattle, data = staffvet))
Q28_no_time_beef_pct <- data.table(round(tally( ~ Q28_no_time | Beef_Cattle, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_no_time_beef <- merge.data.table(Q28_no_time_beef_ct, Q28_no_time_beef_pct)

Q28_no_time_beef <- Q28_no_time_beef %>%
    filter(Beef_Cattle %in% 'TRUE')%>%
    mutate(Reason="I don't have time") %>%
    rename(answer=Q28_no_time) %>% 
    mutate(species="beef cattle") %>%
    rename(response=Beef_Cattle)

#kable(Q28_no_time_beef)

##Dairy
Q28_no_time_dairy_ct <- data.table(tally( ~ Q28_no_time | Dairy_Cattle, data = staffvet))
Q28_no_time_dairy_pct <- data.table(round(tally( ~ Q28_no_time | Dairy_Cattle, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_no_time_dairy <- merge.data.table(Q28_no_time_dairy_ct, Q28_no_time_dairy_pct)

Q28_no_time_dairy <- Q28_no_time_dairy %>%
    filter(Dairy_Cattle %in% 'TRUE')%>%
    mutate(Reason="I don't have time") %>%
    rename(answer=Q28_no_time) %>% 
    mutate(species="dairy cattle") %>%
    rename(response=Dairy_Cattle)

#kable(Q28_no_time_dairy)

##Swine
Q28_no_time_swine_ct <- data.table(tally( ~ Q28_no_time | Swine, data = staffvet))
Q28_no_time_swine_pct <- data.table(round(tally( ~ Q28_no_time | Swine, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_no_time_swine <- merge.data.table(Q28_no_time_swine_ct, Q28_no_time_swine_pct)

Q28_no_time_swine <- Q28_no_time_swine %>%
    filter(Swine %in% 'TRUE')%>%
    mutate(Reason="I don't have time") %>%
    rename(answer=Q28_no_time) %>% 
    mutate(species="swine") %>%
    rename(response=Swine)

#kable(Q28_no_time_swine)

##Sheep
Q28_no_time_sheep_ct <- data.table(tally( ~ Q28_no_time | Sheep, data = staffvet))
Q28_no_time_sheep_pct <- data.table(round(tally( ~ Q28_no_time | Sheep, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_no_time_sheep <- merge.data.table(Q28_no_time_sheep_ct, Q28_no_time_sheep_pct)

Q28_no_time_sheep <- Q28_no_time_sheep %>%
    filter(Sheep %in% 'TRUE')%>%
    mutate(Reason="I don't have time") %>%
    rename(answer=Q28_no_time) %>% 
    mutate(species="sheep") %>%
    rename(response=Sheep)

#kable(Q28_no_time_sheep)

##Goats
Q28_no_time_goats_ct <- data.table(tally( ~ Q28_no_time | Goats, data = staffvet))
Q28_no_time_goats_pct <- data.table(round(tally( ~ Q28_no_time | Goats, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_no_time_goats <- merge.data.table(Q28_no_time_goats_ct, Q28_no_time_goats_pct)

Q28_no_time_goats <- Q28_no_time_goats %>%
    filter(Goats %in% 'TRUE')%>%
    mutate(Reason="I don't have time") %>%
    rename(answer=Q28_no_time) %>% 
    mutate(species="goats") %>%
    rename(response=Goats)

#kable(Q28_no_time_goats)

##Chickens
Q28_no_time_chickens_ct <- data.table(tally( ~ Q28_no_time | Chickens, data = staffvet))
Q28_no_time_chickens_pct <- data.table(round(tally( ~ Q28_no_time | Chickens, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_no_time_chickens <- merge.data.table(Q28_no_time_chickens_ct, Q28_no_time_chickens_pct)

Q28_no_time_chickens <- Q28_no_time_chickens %>%
    filter(Chickens %in% 'TRUE')%>%
    mutate(Reason="I don't have time") %>%
    rename(answer=Q28_no_time) %>% 
    mutate(species="chickens") %>%
    rename(response=Chickens)

#kable(Q28_no_time_chickens)

##Turkeys
Q28_no_time_turkeys_ct <- data.table(tally( ~ Q28_no_time | Turkeys, data = staffvet))
Q28_no_time_turkeys_pct <- data.table(round(tally( ~ Q28_no_time | Turkeys, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_no_time_turkeys <- merge.data.table(Q28_no_time_turkeys_ct, Q28_no_time_turkeys_pct)

Q28_no_time_turkeys <- Q28_no_time_turkeys %>%
    filter(Turkeys %in% 'TRUE')%>%
    mutate(Reason="I don't have time") %>%
    rename(answer=Q28_no_time) %>% 
    mutate(species="turkeys") %>%
    rename(response=Turkeys)

#kable(Q28_no_time_turkeys)

##Beef and Dairy
Q28_no_time_bd_ct <- data.table(tally( ~ Q28_no_time | beef_dairy, data = staffvet))
Q28_no_time_bd_pct <- data.table(round(tally( ~ Q28_no_time | beef_dairy, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_no_time_bd <- merge.data.table(Q28_no_time_bd_ct, Q28_no_time_bd_pct)

Q28_no_time_bd <- Q28_no_time_bd %>%
    filter(beef_dairy %in% 'TRUE')%>%
    mutate(Reason="I don't have time") %>%
    rename(answer=Q28_no_time) %>% 
    mutate(species="beef and dairy") %>%
    rename(response=beef_dairy)

#kable(Q28_no_time_bd)

##Sheep and Goats
Q28_no_time_sg_ct <- data.table(tally( ~ Q28_no_time | sheep_goat, data = staffvet))
Q28_no_time_sg_pct <- data.table(round(tally( ~ Q28_no_time | sheep_goat, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_no_time_sg <- merge.data.table(Q28_no_time_sg_ct, Q28_no_time_sg_pct)

Q28_no_time_sg <- Q28_no_time_sg %>%
    filter(sheep_goat %in% 'TRUE')%>%
    mutate(Reason="I don't have time") %>%
    rename(answer=Q28_no_time) %>% 
    mutate(species="sheep and goats") %>%
    rename(response=sheep_goat)

#kable(Q28_no_time_sg)

##Chickens and Turkeys
Q28_no_time_ct_ct <- data.table(tally( ~ Q28_no_time | chicken_turkey, data = staffvet))
Q28_no_time_ct_pct <- data.table(round(tally( ~ Q28_no_time | chicken_turkey, data = staffvet, format("proportion")),4))%>% 
    rename(pct = N)

Q28_no_time_ct <- merge.data.table(Q28_no_time_ct_ct, Q28_no_time_ct_pct)

Q28_no_time_ct <- Q28_no_time_ct %>%
    filter(chicken_turkey %in% 'TRUE')%>%
    mutate(Reason="I don't have time") %>%
    rename(answer=Q28_no_time) %>% 
    mutate(species="chickens and turkeys") %>%
    rename(response=chicken_turkey)

#kable(Q28_no_time_ct)

#Create a combined table for all species I don't have time

table_Q28_no_time_spec <- rbind.data.frame(Q28_no_time_beef, Q28_no_time_dairy, Q28_no_time_swine, Q28_no_time_sheep, Q28_no_time_goats, Q28_no_time_chickens, Q28_no_time_turkeys, Q28_no_time_bd, Q28_no_time_sg, Q28_no_time_ct)
#kable(table_Q28_no_time_spec)

#----------------------------
#Create a combined table for all parts of question 28 with species

table_Q28_spec <- rbind.data.frame(table_Q28_not_applicable_spec, table_Q28_lack_data_spec, table_Q28_unsure_returns_spec, table_Q28_no_time_spec)

#---------------------------
table_Q28_spec <- table_Q28_spec %>% 
  filter(!(answer %in% FALSE))%>%
  mutate(Reason=fct_relevel(Reason, c("not applicable", "lack of data system", "unsure how to return value",
                                      "I don't have time"))) %>% 
   mutate(species=fct_relevel(species,c('beef cattle', 'dairy cattle', 'swine', 'sheep',
                  'goats', 'chickens', 'turkeys', 'beef and dairy', 'sheep and goats', 'chickens and turkeys')))

table_Q28_spec <- table_Q28_spec %>% 
  select(Reason, species, answer, N, pct)

#kable(table_Q28_spec)

ggplot(table_Q28_spec)+
  geom_bar(aes(x = species, y = pct, 
               fill = factor(Reason)),
               stat = 'identity', position = 'dodge', fill = "#55C667FF")+
  facet_grid(factor(Reason)~., scales = 'fixed')+
  theme_bw()+
  labs(x= "Species
       ", y = "Percent of Responses", 
      title = "Categories of Routine Data Review from the Flocks or Herds Under Your Care")+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
  theme(strip.text.y = element_text(angle = 0))+
  theme(legend.title = element_blank())+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  theme(legend.position = "none")
               #ggsave('test.jpg', height = 11, width = 8.5)

#ggplot(table_Q28_spec)+
  #geom_bar(aes(x = Reason, y = pct, 
               #fill = factor(species)),
               #stat = 'identity', position = 'dodge')+
               #facet_grid(factor(species)~., scales = 'free')+
               #theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

## Q31 Would you find value in having a confidential report comparing your antimicrobial use and prescribing practices to an aggregate of antimicrobial use data from other veterinarians in a similar practice situation?
```{r echo=FALSE}
#count and proportions
Q31_confidential_report_amu_ct <- data.table(tally( ~ Q31_confidential_report_amu , data = AMU_Survey_Final))
Q31_confidential_report_amu_pct <- data.table(round(tally( ~ Q31_confidential_report_amu , data = AMU_Survey_Final,
    format("proportion")),4))%>% 
    rename(pct = N)

Q31_confidential_report_amu <- merge.data.table(Q31_confidential_report_amu_ct, Q31_confidential_report_amu_pct) %>% 
    arrange(factor(Q31_confidential_report_amu, levels = c("No", "Possibly", "Definitely yes")))
kable(Q31_confidential_report_amu)


Q31_confidential_report_amu <- Q31_confidential_report_amu %>% 
  mutate(Q31_confidential_report_amu=fct_relevel(Q31_confidential_report_amu,c("No", "Possibly", "Definitely yes")))

#-------------------------------------------------
#bar chart of reason for confidential report
ggplot(Q31_confidential_report_amu)+
  geom_bar(aes(x = Q31_confidential_report_amu	, y = pct),
           stat = 'identity', position = 'dodge', fill = "#1F968BFF")+
  theme_bw()+
  labs(x= "Value", y = "Percent of Responses", 
                    title = "Value in Confidential Antimicrobial Use Report")+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
  theme(strip.text.y = element_text(angle = 0))+
  theme(legend.position = "none")
          #ggsave('test.jpg', height = 11, width = 8.5)
#-------------------------------------------------

#Add graduate year
Q31_confidential_report_amu_yr_ct <- data.table(tally( ~ Q31_confidential_report_amu | grad_year_cat, data = grad_yr_revised))
Q31_confidential_report_amu_yr_pct <- data.table(round(tally( ~ Q31_confidential_report_amu | grad_year_cat, 
    data = grad_yr_revised, format("proportion")),4))%>% 
    rename(pct = N)

Q31_confidential_report_amu_yr <- merge.data.table(Q31_confidential_report_amu_yr_ct, Q31_confidential_report_amu_yr_pct) %>% 
    arrange(factor(Q31_confidential_report_amu, levels = c("No", "Possibly", "Definitely yes"))) %>% 
    arrange(factor(grad_year_cat, levels = c("<1987", "1987-1999", "2000-2010", "2011-2016", ">2016")))

Q31_confidential_report_amu_yr <- Q31_confidential_report_amu_yr %>% 
  filter(!(grad_year_cat %in% 'Unknown')) %>% 
  select(grad_year_cat, Q31_confidential_report_amu, N, pct)

#kable(Q31_confidential_report_amu_yr)

#Reorder Q31 answers
AMU_Survey_Final <- AMU_Survey_Final %>% 
  mutate(Q31_confidential_report_amu=fct_relevel(Q31_confidential_report_amu,c("No", "Possibly", "Definitely yes")))

#kable(table(AMU_Survey_Final$grad_year_cat, AMU_Survey_Final$Q31_confidential_report_amu))

#Add practice type
Q31_confidential_report_amu_prac_ct <- data.table(tally( Q31_confidential_report_amu ~ practice_type , data = AMU_Survey_Final))
Q31_confidential_report_amu_prac_pct <- data.table(round(tally( Q31_confidential_report_amu ~ practice_type , 
    data = AMU_Survey_Final, format("proportion")),4))%>% 
    rename(pct = N)

Q31_confidential_report_amu_prac <- merge.data.table(Q31_confidential_report_amu_prac_ct, 
    Q31_confidential_report_amu_prac_pct)%>% 
    arrange(factor(Q31_confidential_report_amu, levels = c("No", "Possibly", "Definitely yes"))) %>% 
    arrange(factor(practice_type, levels = c("Private General Practice", "Food Animal Practice", "Consultant", 
                                     "Staff Vet", "Academia", "None")))

Q31_confidential_report_amu_prac <- Q31_confidential_report_amu_prac %>% 
  select(practice_type, Q31_confidential_report_amu, N, pct)

#kable(Q31_confidential_report_amu_prac)
```

## Q32 Guidance Documents

## AVMA Principles Guidance Document Tables
```{r echo=FALSE, message=FALSE, warning=FALSE}
#Filter out Unknowns
AVMA_principles <- AMU_Survey_Final %>% 
  filter(!(Q32_AVMA_principles %in% 'Unknown'))


#create table for counts 
table_Q32_AVMA_principles_ct<-data.table(tally( ~ Q32_AVMA_principles , data = AVMA_principles))

#read table 
#table_Q32_AVMA_principles_ct

#create table for proportions
table_Q32_AVMA_principles_pct<-data.table(round(tally( ~ Q32_AVMA_principles , data = AVMA_principles, 
    format('proportion')),4)) %>% 
    rename(pct = N)

#read table
#table_Q32_AVMA_principles_pct 

#merge count and proportion to one table
table_Q32_AVMA_principles <- merge.data.table(table_Q32_AVMA_principles_ct, table_Q32_AVMA_principles_pct)%>% 
    arrange(factor(Q32_AVMA_principles, levels = c("unaware", "have not read", 
              "cannot recall content", "no practical guidance", "limited practical guidance", 
              "provided practical guidance", "Unknown")))

table_Q32_AVMA_principles <- table_Q32_AVMA_principles %>% mutate(document="AVMA principles") %>%
    rename(answer=Q32_AVMA_principles)%>% 
    mutate(group="all")

table_Q32_AVMA_principles <- table_Q32_AVMA_principles %>% 
  select(document, group, answer, N, pct)

#read table
kable(table_Q32_AVMA_principles)

#-------------------------------
#create table for counts 
table_Q32_AVMA_principles_org_ct <- data.table(tally( ~ Q32_AVMA_principles | AVMA, data = AVMA_principles))%>% 
  filter(AVMA == 'TRUE')

#read table 
#table_Q32_AVMA_principles_org_ct

#create table for proportions
table_Q32_AVMA_principles_org_pct <- data.table(round(tally( ~ Q32_AVMA_principles | AVMA, data = AVMA_principles, format('proportion')),4)) %>% 
    rename(pct = N)%>% filter(AVMA == 'TRUE')

#read table
#table_Q32_AVMA_principles_org_pct 

#merge count and proportion to one table
table_Q32_AVMA_principles_org <- merge.data.table(table_Q32_AVMA_principles_org_ct, table_Q32_AVMA_principles_org_pct)%>% 
    arrange(factor(Q32_AVMA_principles, levels = c("unaware", "have not read", 
              "cannot recall content", "no practical guidance", "limited practical guidance", 
              "provided practical guidance", "Unknown")))

table_Q32_AVMA_principles_org <- table_Q32_AVMA_principles_org %>% mutate(document="AVMA principles") %>%
    rename(answer=Q32_AVMA_principles) %>% 
    mutate(group="AVMA") %>%
    rename(response=AVMA) 

table_Q32_AVMA_principles_org <- table_Q32_AVMA_principles_org %>% 
  select(document, group, answer, N, pct, -response)

#read table
kable(table_Q32_AVMA_principles_org)
```

## AVMA Checklist Guidance Document Tables
```{r echo=FALSE}
#Filter out Unknowns
AVMA_checklist <- AMU_Survey_Final %>% 
  filter(!(Q32_AVMA_checklist %in% 'Unknown'))

#create table for counts 
table_Q32_AVMA_checklist_ct <- data.table(tally( ~ Q32_AVMA_checklist , data = AVMA_checklist))

#read table 
#table_Q32_AVMA_checklist_ct

#create table for proportions
table_Q32_AVMA_checklist_pct <- data.table(round(tally( ~ Q32_AVMA_checklist , data = AVMA_checklist, 
    format('proportion')),4)) %>% 
    rename(pct = N)

#read table
#table_Q32_AVMA_checklist_pct

#merge count and proportion to one table
table_Q32_AVMA_checklist <- merge.data.table(table_Q32_AVMA_checklist_ct, table_Q32_AVMA_checklist_pct)%>% 
    arrange(factor(Q32_AVMA_checklist, levels = c("unaware", "have not read", 
              "cannot recall content", "no practical guidance", "limited practical guidance", 
              "provided practical guidance", "Unknown")))

table_Q32_AVMA_checklist <- table_Q32_AVMA_checklist %>% mutate(document="AVMA checklist") %>%
    rename(answer=Q32_AVMA_checklist) %>% 
    mutate(group="all")

table_Q32_AVMA_checklist <- table_Q32_AVMA_checklist %>% 
  select(document, group, answer, N, pct)

#read table
kable(table_Q32_AVMA_checklist)

#----------------------------------
#create table for counts with AVMA members
table_Q32_AVMA_checklist_org_ct <- data.table(tally( ~ Q32_AVMA_checklist | AVMA , data = AVMA_checklist))%>% 
  filter(AVMA == 'TRUE')

#read table 
#table_Q32_AVMA_checklist_org_ct

#create table for proportions with AVMA members
table_Q32_AVMA_checklist_org_pct <- data.table(round(tally( ~ Q32_AVMA_checklist | AVMA , data = AVMA_checklist, format('proportion')),4)) %>% 
    rename(pct = N)%>% filter(AVMA == 'TRUE')

#read table
#table_Q32_AVMA_checklist_org_pct

#merge count and proportion to one table
table_Q32_AVMA_checklist_org <- merge.data.table(table_Q32_AVMA_checklist_org_ct, table_Q32_AVMA_checklist_org_pct)%>% 
    arrange(factor(Q32_AVMA_checklist, levels = c("unaware", "have not read", 
              "cannot recall content", "no practical guidance", "limited practical guidance", 
              "provided practical guidance", "Unknown")))

table_Q32_AVMA_checklist_org <- table_Q32_AVMA_checklist_org %>% mutate(document="AVMA checklist") %>%
    rename(answer=Q32_AVMA_checklist) %>% 
    mutate(group="AVMA") %>%
    rename(response=AVMA) 

table_Q32_AVMA_checklist_org <- table_Q32_AVMA_checklist_org %>% 
  select(document, group, answer, N, pct)

#read table
kable(table_Q32_AVMA_checklist_org)
```

## AABP Key Element Guidance Document Tables
```{r echo=FALSE}
#Filter out Unknowns
AABP_key_elements <- AMU_Survey_Final %>% 
  filter(!(Q32_AABP_key_elements %in% 'Unknown'))

#create table for beef and dairy combined counts 
table_Q32_AABP_key_elements_sp_ct <- data.table(
  tally( ~ Q32_AABP_key_elements | beef_dairy , data = AABP_key_elements)) %>% filter(beef_dairy == 'TRUE')

#read table 
#table_Q32_AABP_key_elements_sp_ct

#create table for beef and dairy combined proportions
table_Q32_AABP_key_elements_sp_pct <- data.table(round(tally( ~ Q32_AABP_key_elements | beef_dairy , data = AABP_key_elements, format('proportion')),4)) %>% 
    rename(pct = N) %>% filter(beef_dairy == 'TRUE')

#read table
#table_Q32_AABP_key_elements_sp_pct

#merge count and proportion to one table
table_Q32_AABP_key_elements_sp <- merge.data.table(table_Q32_AABP_key_elements_sp_ct, table_Q32_AABP_key_elements_sp_pct)%>% 
    arrange(factor(Q32_AABP_key_elements, levels = c("unaware", "have not read", 
              "cannot recall content", "no practical guidance", "limited practical guidance", 
              "provided practical guidance", "Unknown")))

table_Q32_AABP_key_elements_sp <- table_Q32_AABP_key_elements_sp %>% mutate(document="AABP key elements") %>%
    rename(answer=Q32_AABP_key_elements) %>% 
    mutate(group="beef and/or dairy") %>% 
    rename(response=beef_dairy) 

table_Q32_AABP_key_elements_sp <- table_Q32_AABP_key_elements_sp %>% 
  select(document, group, answer, N, pct)

#read table
kable(table_Q32_AABP_key_elements_sp)

#--------------------------------------------------------

#create table for AABP combined counts 
table_Q32_AABP_key_elements_org_ct <- data.table(
  tally( ~ Q32_AABP_key_elements | AABP , data = AABP_key_elements)) %>% filter(AABP == 'TRUE')

#read table 
#table_Q32_AABP_key_elements_org_ct

#create table for AABP combined proportions
table_Q32_AABP_key_elements_org_pct <- data.table(round(tally( ~ Q32_AABP_key_elements | AABP , data = AABP_key_elements, format('proportion')),4)) %>% 
    rename(pct = N) %>% filter(AABP == 'TRUE')

#read table
#table_Q32_AABP_key_elements_org_pct

#merge count and proportion to one table
table_Q32_AABP_key_elements_org <- merge.data.table(table_Q32_AABP_key_elements_org_ct, table_Q32_AABP_key_elements_org_pct)%>% 
    arrange(factor(Q32_AABP_key_elements, levels = c("unaware", "have not read", 
              "cannot recall content", "no practical guidance", "limited practical guidance", 
              "provided practical guidance", "Unknown")))

table_Q32_AABP_key_elements_org <- table_Q32_AABP_key_elements_org %>% mutate(document="AABP key elements") %>%
    rename(answer=Q32_AABP_key_elements) %>% 
    mutate(group="AABP") %>%
    rename(response=AABP) 

table_Q32_AABP_key_elements_org <- table_Q32_AABP_key_elements_org %>% 
  select(document, group, answer, N, pct)

#read table
kable(table_Q32_AABP_key_elements_org)
```

## Joint AABP AVC Guidance Document Tables
```{r echo=FALSE}
#Filter out Unknowns
joint_AABP_AVC <- AMU_Survey_Final %>% 
  filter(!(Q32_joint_AABP_AVC %in% 'Unknown'))

#create table for beef and dairy combined counts 
table_Q32_joint_AABP_AVC_sp_ct <- data.table(
  tally( ~ Q32_joint_AABP_AVC | beef_dairy , data = joint_AABP_AVC)) %>% filter(beef_dairy == 'TRUE')

#read table 
#table_Q32_joint_AABP_AVC_sp_ct

#create table for beef and dairy combined proportions
table_Q32_joint_AABP_AVC_sp_pct <- data.table(round(tally( ~ Q32_joint_AABP_AVC | beef_dairy , data = joint_AABP_AVC, format('proportion')),4)) %>% 
    rename(pct = N) %>% filter(beef_dairy == 'TRUE')

#read table
#table_Q32_joint_AABP_AVC_sp_pct

#merge count and proportion to one table
table_Q32_joint_AABP_AVC_sp <- merge.data.table(table_Q32_joint_AABP_AVC_sp_ct, table_Q32_joint_AABP_AVC_sp_pct)%>% 
    arrange(factor(Q32_joint_AABP_AVC, levels = c("unaware", "have not read", 
              "cannot recall content", "no practical guidance", "limited practical guidance", 
              "provided practical guidance", "Unknown")))

table_Q32_joint_AABP_AVC_sp <- table_Q32_joint_AABP_AVC_sp %>% mutate(document="joint AABP/AVC") %>%
    rename(answer=Q32_joint_AABP_AVC) %>% 
    mutate(group="beef and/or dairy") %>% 
    rename(response=beef_dairy) 

table_Q32_joint_AABP_AVC_sp <- table_Q32_joint_AABP_AVC_sp %>% 
  select(document, group, answer, N, pct)


#read table
kable(table_Q32_joint_AABP_AVC_sp)

#--------------------------------------------------------
#create table for AABP and AVC combined counts 
table_Q32_joint_AABP_AVC_org_ct <- data.table(
  tally( ~ Q32_joint_AABP_AVC | AABP_AVC , data = joint_AABP_AVC)) %>% filter(AABP_AVC == 'TRUE')

#read table 
#table_Q32_joint_AABP_AVC_org_ct

#create table for AABP and AVC combined proportions
table_Q32_joint_AABP_AVC_org_pct <- data.table(round(tally( ~ Q32_joint_AABP_AVC | AABP_AVC , data = joint_AABP_AVC, format('proportion')),4)) %>% 
    rename(pct = N) %>% filter(AABP_AVC == 'TRUE')

#read table
#table_Q32_joint_AABP_AVC_org_pct

#merge count and proportion to one table
table_Q32_joint_AABP_AVC_org <- merge.data.table(table_Q32_joint_AABP_AVC_org_ct, table_Q32_joint_AABP_AVC_org_pct)%>% 
    arrange(factor(Q32_joint_AABP_AVC, levels = c("unaware", "have not read", 
              "cannot recall content", "no practical guidance", "limited practical guidance", 
              "provided practical guidance", "Unknown")))

table_Q32_joint_AABP_AVC_org <- table_Q32_joint_AABP_AVC_org %>% mutate(document="joint AABP/AVC") %>%
    rename(answer=Q32_joint_AABP_AVC) %>% 
    mutate(group="AABP and/or AVC") %>%
    rename(response=AABP_AVC) 

table_Q32_joint_AABP_AVC_org <- table_Q32_joint_AABP_AVC_org %>% 
  select(document, group, answer, N, pct)

#read table
kable(table_Q32_joint_AABP_AVC_org)
```

## AASV Basic Guidelines Guidance Document Tables
```{r echo=FALSE}
#Filter out Unknowns
AASV_guidelines <- AMU_Survey_Final %>% 
  filter(!(Q32_AASV_guidelines %in% 'Unknown'))

#create table for swine combined counts 
table_Q32_AASV_sp_ct <- data.table(
  tally( ~ Q32_AASV_guidelines | Swine , data = AASV_guidelines)) %>% filter(Swine == 'TRUE')

#read table 
#table_Q32_AASV_sp_ct

#create table for swine combined proportions
table_Q32_AASV_sp_pct <- data.table(round(tally( ~ Q32_AASV_guidelines | Swine , data = AASV_guidelines, 
    format('proportion')),4)) %>% 
    rename(pct = N) %>% filter(Swine == 'TRUE')

#read table
#table_Q32_AASV_sp_pct

#merge count and proportion to one table
table_Q32_AASV_sp <- merge.data.table(table_Q32_AASV_sp_ct, table_Q32_AASV_sp_pct)%>% 
    arrange(factor(Q32_AASV_guidelines, levels = c("unaware", "have not read", 
              "cannot recall content", "no practical guidance", "limited practical guidance", 
              "provided practical guidance", "Unknown")))

table_Q32_AASV_sp <- table_Q32_AASV_sp %>% mutate(document="AASV guidelines") %>%
    rename(answer=Q32_AASV_guidelines) %>% 
    mutate(group="swine") %>% 
    rename(response=Swine) 

table_Q32_AASV_sp <- table_Q32_AASV_sp %>% 
  select(document, group, answer, N, pct)

#read table
kable(table_Q32_AASV_sp)

#--------------------------------------------------------
#create table for AASV combined counts 
table_Q32_AASV_org_ct <- data.table(
  tally( ~ Q32_AASV_guidelines | AASV , data = AASV_guidelines)) %>% filter(AASV == 'TRUE')

#read table 
#table_Q32_AASV_org_ct

#create table for AASV combined proportions
table_Q32_AASV_org_pct <- data.table(round(tally( ~ Q32_AASV_guidelines | AASV , data = AASV_guidelines, 
    format('proportion')),4)) %>% 
    rename(pct = N) %>% filter(AASV == 'TRUE')

#read table
#table_Q32_AASV_org_pct

#merge count and proportion to one table
table_Q32_AASV_org <- merge.data.table(table_Q32_AASV_org_ct, table_Q32_AASV_org_pct)%>% 
    arrange(factor(Q32_AASV_guidelines, levels = c("unaware", "have not read", 
              "cannot recall content", "no practical guidance", "limited practical guidance", 
              "provided practical guidance", "Unknown")))

table_Q32_AASV_org <- table_Q32_AASV_org %>% mutate(document="AASV guidelines") %>%
    rename(answer=Q32_AASV_guidelines) %>% 
    mutate(group="AASV") %>%
    rename(response=AASV) 

table_Q32_AASV_org <- table_Q32_AASV_org %>% 
  select(document, group, answer, N, pct)

#read table
kable(table_Q32_AASV_org)
```

## AASRP AMS Guidelines Guidance Document Tables
```{r echo=FALSE}
#Filter out Unknowns
AASRP_guidelines <- AMU_Survey_Final %>% 
  filter(!(Q32_AASRP_guidelines %in% 'Unknown'))

#create table for sheep and goats combined counts 
table_Q32_AASRP_sp_ct <- data.table(
  tally( ~ Q32_AASRP_guidelines | sheep_goat , data = AASRP_guidelines)) %>% filter(sheep_goat == 'TRUE')

#read table 
#table_Q32_AASRP_sp_ct

#create table for sheep and goats combined proportions
table_Q32_AASRP_sp_pct <- data.table(round(tally( ~ Q32_AASRP_guidelines | sheep_goat , data = AASRP_guidelines, format('proportion')),4)) %>% 
    rename(pct = N) %>% filter(sheep_goat == 'TRUE')

#read table
#table_Q32_AASRP_sp_pct

#merge count and proportion to one table
table_Q32_AASRP_sp <- merge.data.table(table_Q32_AASRP_sp_ct, table_Q32_AASRP_sp_pct)%>% 
    arrange(factor(Q32_AASRP_guidelines, levels = c("unaware", "have not read", 
              "cannot recall content", "no practical guidance", "limited practical guidance", 
              "provided practical guidance", "Unknown")))

table_Q32_AASRP_sp <- table_Q32_AASRP_sp %>% mutate(document="AASRP guidelines") %>%
    rename(answer=Q32_AASRP_guidelines) %>% 
    mutate(group="sheep and/or goats") %>% 
    rename(response=sheep_goat) 

table_Q32_AASRP_sp <- table_Q32_AASRP_sp %>% 
  select(document, group, answer, N, pct)

#read table
kable(table_Q32_AASRP_sp)

#--------------------------------------------------------
#create table for AASRP combined counts 
table_Q32_AASRP_org_ct <- data.table(
  tally( ~ Q32_AASRP_guidelines | AASRP , data = AASRP_guidelines)) %>% filter(AASRP == 'TRUE')

#read table 
#table_Q32_AASRP_org_ct

#create table for AASRP combined proportions
table_Q32_AASRP_org_pct <- data.table(round(tally( ~ Q32_AASRP_guidelines | AASRP , data = AASRP_guidelines, 
    format('proportion')),4)) %>% 
    rename(pct = N) %>% filter(AASRP == 'TRUE')

#read table
#table_Q32_AASRP_org_pct

#merge count and proportion to one table
table_Q32_AASRP_org <- merge.data.table(table_Q32_AASRP_org_ct, table_Q32_AASRP_org_pct)%>% 
    arrange(factor(Q32_AASRP_guidelines, levels = c("unaware", "have not read", 
              "cannot recall content", "no practical guidance", "limited practical guidance", 
              "provided practical guidance", "Unknown")))

table_Q32_AASRP_org <- table_Q32_AASRP_org %>% mutate(document="AASRP guidelines") %>%
    rename(answer=Q32_AASRP_guidelines) %>% 
    mutate(group="AASRP") %>%
    rename(response=AASRP) 

table_Q32_AASRP_org <- table_Q32_AASRP_org %>% 
  select(document, group, answer, N, pct)

#read table
kable(table_Q32_AASRP_org)
```

## AAAP-AVMA Guidelines Guidance Document Tables
```{r echo=FALSE}
#Filter out Unknowns
AAAP_guidelines <- AMU_Survey_Final %>% 
  filter(!(Q32_AAAP_guidelines %in% 'Unknown'))

#create table for chickens and turkeys combined counts 
table_Q32_AAAP_sp_ct <- data.table(
  tally( ~ Q32_AAAP_guidelines | chicken_turkey , data = AAAP_guidelines)) %>% filter(chicken_turkey == 'TRUE')

#read table 
#table_Q32_AAAP_sp_ct

#create table for chickens and turkeys combined proportions
table_Q32_AAAP_sp_pct <- data.table(round(tally( ~ Q32_AAAP_guidelines | chicken_turkey , data = AAAP_guidelines, format('proportion')),4)) %>% 
    rename(pct = N) %>% filter(chicken_turkey == 'TRUE')

#read table
#table_Q32_AAAP_sp_pct

#merge count and proportion to one table
table_Q32_AAAP_sp <- merge.data.table(table_Q32_AAAP_sp_ct, table_Q32_AAAP_sp_pct)%>% 
    arrange(factor(Q32_AAAP_guidelines, levels = c("unaware", "have not read", 
              "cannot recall content", "no practical guidance", "limited practical guidance", 
              "provided practical guidance", "Unknown")))

table_Q32_AAAP_sp <- table_Q32_AAAP_sp %>% mutate(document="AAAP guidelines") %>%
    rename(answer=Q32_AAAP_guidelines) %>% 
    mutate(group="chickens and/or turkeys") %>% 
    rename(response=chicken_turkey) 

table_Q32_AAAP_sp <- table_Q32_AAAP_sp %>% 
  select(document, group, answer, N, pct)

#read table
kable(table_Q32_AAAP_sp)
#--------------------------------------------------------
#create table for AAAP combined counts 
table_Q32_AAAP_org_ct <- data.table(
  tally( ~ Q32_AAAP_guidelines | AAAP , data = AAAP_guidelines)) %>% filter(AAAP == 'TRUE')

#read table 
#table_Q32_AAAP_org_ct

#create table for AAAP combined proportions
table_Q32_AAAP_org_pct <- data.table(round(tally( ~ Q32_AAAP_guidelines | AAAP , data = AAAP_guidelines, 
    format('proportion')),4)) %>% 
    rename(pct = N) %>% filter(AAAP == 'TRUE')

#read table
#table_Q32_AAAP_org_pct

#merge count and proportion to one table
table_Q32_AAAP_org <- merge.data.table(table_Q32_AAAP_org_ct, table_Q32_AAAP_org_pct)%>% 
    arrange(factor(Q32_AAAP_guidelines, levels = c("unaware", "have not read", 
              "cannot recall content", "no practical guidance", "limited practical guidance", 
              "provided practical guidance", "Unknown")))

table_Q32_AAAP_org <- table_Q32_AAAP_org %>% mutate(document="AAAP guidelines") %>%
    rename(answer=Q32_AAAP_guidelines) %>% 
    mutate(group="AAAP") %>%
    rename(response=AAAP) 

table_Q32_AAAP_org <- table_Q32_AAAP_org %>% 
  select(document, group, answer, N, pct)

#read table
kable(table_Q32_AAAP_org)
```

## Q32 Guidance Documents Combined Tables and Graphs
```{r echo=FALSE, message=FALSE, warning=FALSE}
#Create a combined table for guidance documents by species in practice

table_Q32_spec <- rbind.data.frame(table_Q32_AVMA_principles, table_Q32_AVMA_checklist, table_Q32_AABP_key_elements_sp, table_Q32_joint_AABP_AVC_sp, table_Q32_AASV_sp, table_Q32_AASRP_sp, table_Q32_AAAP_sp)
#kable(table_Q32_spec)

table_Q32_specb <-  table_Q32_spec %>% 
  select(-pct) %>% 
  pivot_wider(names_from = answer, values_from = N) 

table_Q32_specb[is.na(table_Q32_specb)] <- 0

kable(table_Q32_specb)

table_Q32_specc <-  table_Q32_spec %>% 
  select(-N) %>% 
  pivot_wider(names_from = answer, values_from =pct) 

table_Q32_specc[is.na(table_Q32_specc)] <- 0

kable(table_Q32_specc)

#---------------------------
table_Q32_spec <- table_Q32_spec %>% 
          mutate(document=fct_relevel(document, c('AVMA principles', 'AVMA checklist', 'AABP key elements',
          'joint AABP/AVC','AASV guidelines', 'AASRP guidelines', 'AAAP guidelines'))) %>% 
          mutate(answer=fct_relevel(answer, c("unaware", "have not read", 
              "cannot recall content", "no practical guidance", "limited practical guidance", 
              "provided practical guidance", "Unknown"))) %>% 
          mutate(group=fct_relevel(group, c("all", "beef and/or dairy", 
              "swine", "sheep and/or goats", "chickens and/or turkeys")))

ggplot(table_Q32_spec)+
  geom_bar(aes(x = answer, y = pct, 
               fill = factor(group)),
               stat = 'identity', position = 'dodge')+
  facet_grid(factor(document)~., scales = 'fixed')+
  theme_bw()+
  labs(x= "Awareness", y = "Percentage of Responses", 
                    title = "Guidance Documents")+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  theme(strip.text.y = element_text(angle = 0))+
  theme(legend.title = element_blank())+
  scale_color_viridis(option = "D")+
  scale_fill_viridis(discrete = TRUE, option = "D")
               #ggsave('Q7.jpg', height = 11, width = 8.5)

table_Q32_spec_pct <- table_Q32_spec %>% 
  mutate(Percent = 100*pct)

ggplot(table_Q32_spec_pct) +
  geom_point(aes(x = answer, y = document, size= Percent), color = 'orange')+
  geom_text(aes(x = answer, y = document, 
                label=paste0(round(pct*100, digits = 0))), 
            hjust = 0, vjust = 1)+
  theme_bw()+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  labs(x= "Awareness", title = "Guidance Document by Species in Practice",
       size = "Percent of Responses")+
  scale_y_discrete(limits = c('AAAP guidelines','AASRP guidelines','AASV guidelines',
        'joint AABP/AVC','AABP key elements', 'AVMA checklist','AVMA principles'))+
  theme(axis.title.y=element_blank())
#------------------------------
#Create a combined table for guidance documents by organization membership

table_Q32_org <- rbind.data.frame(table_Q32_AVMA_principles_org, table_Q32_AVMA_checklist_org, 
                    table_Q32_AABP_key_elements_org, table_Q32_joint_AABP_AVC_org, 
                    table_Q32_AASV_org, table_Q32_AASRP_org, table_Q32_AAAP_org)
#kable(table_Q32_org)

table_Q32_orgb <-  table_Q32_org %>% 
  select(-pct) %>% 
  pivot_wider(names_from = answer, values_from = N) 

table_Q32_orgb[is.na(table_Q32_orgb)] <- 0

kable(table_Q32_orgb)

table_Q32_orgc <-  table_Q32_org %>% 
  select(-N) %>% 
  pivot_wider(names_from = answer, values_from =pct) 

table_Q32_orgc[is.na(table_Q32_orgc)] <- 0

kable(table_Q32_orgc)

#---------------------------
table_Q32_org <- table_Q32_org %>% 
          mutate(document=fct_relevel(document, c('AVMA principles', 'AVMA checklist', 'AABP key elements',
          'joint AABP/AVC','AASV guidelines', 'AASRP guidelines', 'AAAP guidelines'))) %>% 
          mutate(answer=fct_relevel(answer, c("unaware", "have not read", 
              "cannot recall content", "no practical guidance", "limited practical guidance", 
              "provided practical guidance", "Unknown"))) %>% 
          mutate(group=fct_relevel(group, c("AVMA", "AABP", 
              "AABP and/or AVC", "AASV", "AASRP", "AAAP")))

ggplot(table_Q32_org)+
  geom_bar(aes(x = answer, y = pct, 
               fill = factor(group)),
               stat = 'identity', position = 'dodge')+
    facet_grid(factor(document)~., scales = 'fixed')+
  theme_bw()+
  labs(x= "Awareness", y = "Percentage of Responses", 
                    title = "Guidance Documents")+
  scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  theme(strip.text.y = element_text(angle = 0))+
  theme(legend.title = element_blank())+
  scale_color_viridis(option = "D")+
  scale_fill_viridis(discrete = TRUE, option = "D")
            #ggsave('test.jpg', height = 11, width = 8.5)

table_Q32_org_pct <- table_Q32_org %>% 
  mutate(Percent = 100*pct)

ggplot(table_Q32_org_pct) +
  geom_point(aes(x = answer, y = document, size= Percent), color = 'orange')+
  geom_text(aes(x = answer, y = document, 
                label=paste0(round(pct*100, digits = 0))), 
            hjust = 0, vjust = 1)+
  theme_bw()+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  labs(x= "Awareness", title = "Guidance Document by Organization Membership",
       size = "Percent of Responses")+
  scale_y_discrete(limits = c('AAAP guidelines','AASRP guidelines','AASV guidelines',
        'joint AABP/AVC','AABP key elements', 'AVMA checklist','AVMA principles'))+
  theme(axis.title.y=element_blank())
```

## Q33 How many times a year do you find yourself in need of additional information to support an antimicrobial use or prescribing decision for food animals?
```{r echo=FALSE, message=FALSE, warning=FALSE}
#Filter out Unknowns
Q33_filter <- AMU_Survey_Final %>% 
  filter(!(Q33_need_amu_info %in% 'Unknown'))

Q33_filter_grad_yr <- Q33_filter %>% 
  filter(!(grad_year_cat %in% 'Unknown'))

#count and proportions
Q33_need_amu_info_ct <- data.table(tally( ~ Q33_need_amu_info , data = Q33_filter))
Q33_need_amu_info_pct <- data.table(round(tally( ~ Q33_need_amu_info , data = Q33_filter,
    format("proportion")),4))%>% 
    rename(pct = N)

Q33_need_amu_info <- merge.data.table(Q33_need_amu_info_ct, Q33_need_amu_info_pct)

#kable(Q33_need_amu_info)

#-----------------------------------
#reorder times a year
Q33_need_amu_info <- Q33_need_amu_info %>% 
  filter(!(Q33_need_amu_info %in% 'Unknown')) %>% 
  arrange(factor(Q33_need_amu_info, levels = c("None", "1-2", "3-5", ">5", 'Unknown'))) %>%
  mutate(Q33_need_amu_info=fct_relevel(Q33_need_amu_info,c("None", "1-2", "3-5", ">5", 'Unknown')))

kable(Q33_need_amu_info)

#bar chart for times a year need additional AMU information
ggplot(Q33_need_amu_info)+
  geom_bar(aes(x = Q33_need_amu_info, y = pct, 
               fill = factor(Q33_need_amu_info)),
               stat = 'identity', position = 'dodge', fill = "#33638DFF")+
               theme(strip.text.y = element_text(angle = 0))+
               theme(legend.position = "none")+
               theme_bw()+
               labs(x = "Times per Year", y = "Percentage of Responses", 
                     title = "Need of Additional Information to Support an Antimicrobial Prescribing Decision")+
               scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
               theme(strip.text.y = element_text(angle = 0))+
               theme(legend.position = "none")
           #ggsave('test.jpg', height = 11, width = 8.5)

#-----------------------------------
#Add graduate year
Q33_need_amu_info_yr_ct <- data.table(tally( ~ Q33_need_amu_info | grad_year_cat, data = Q33_filter_grad_yr))
Q33_need_amu_info_yr_pct <- data.table(round(tally( ~ Q33_need_amu_info | grad_year_cat, 
    data = Q33_filter_grad_yr, format("proportion")),4))%>% 
    rename(pct = N)

Q33_need_amu_info_yr <- merge.data.table(Q33_need_amu_info_yr_ct, Q33_need_amu_info_yr_pct) %>% 
    arrange(factor(Q33_need_amu_info, levels = c("None", "1-2", "3-5", ">5", 'Unknown'))) %>% 
    arrange(factor(grad_year_cat, levels = c("<1987", "1987-1999", "2000-2010", "2011-2016", ">2016")))

Q33_need_amu_info_yr <- Q33_need_amu_info_yr %>%
  filter(!(grad_year_cat %in% 'Unknown')) %>% 
  select(grad_year_cat, Q33_need_amu_info, N, pct)
    
#kable(Q33_need_amu_info_yr)

#Reorder Q33 answers
AMU_Survey_Final <- AMU_Survey_Final %>% 
  mutate(Q33_need_amu_info=fct_relevel(Q33_need_amu_info,c("None", "1-2", "3-5", ">5", 'Unknown')))

#kable(table(AMU_Survey_Final$grad_year_cat, AMU_Survey_Final$Q33_need_amu_info))

Q33_need_amu_info_yrb <-  Q33_need_amu_info_yr %>% 
  select(-pct) %>% 
  pivot_wider(names_from = Q33_need_amu_info, values_from = N) 

kable(Q33_need_amu_info_yrb)

Q33_need_amu_info_yrc <-  Q33_need_amu_info_yr %>% 
  select(-N) %>% 
  pivot_wider(names_from = Q33_need_amu_info, values_from = pct) 

kable(Q33_need_amu_info_yrc)

#-----------------------------------
#reorder
Q33_need_amu_info_yr <- Q33_need_amu_info_yr %>% 
  filter(!(Q33_need_amu_info %in% 'Unknown')) %>%
  mutate(Q33_need_amu_info=fct_relevel(Q33_need_amu_info,c("None", "1-2", "3-5", ">5", 'Unknown'))) %>%  
  mutate(grad_year_cat=fct_relevel(grad_year_cat,c("<1987", "1987-1999", "2000-2010", "2011-2016", ">2016")))

#kable(Q33_need_amu_info_yr)

#bar chart for times a year need additional AMU information by grad year category
ggplot(Q33_need_amu_info_yr)+
  geom_bar(aes(x = Q33_need_amu_info, y = pct, 
               fill = factor(Q33_need_amu_info)),
               stat = 'identity', position = 'dodge', fill = "#481567FF")+
               facet_grid(factor(grad_year_cat)~., scales = 'fixed')+
               theme(strip.text.y = element_text(angle = 0))+
               theme(legend.position = "none")+
               theme_bw()+
               labs(x = "Times per Year", y = "Percentage of Responses", 
                     title = "Need of Additional Information to Support an Antimicrobial Prescribing Decision")+
               scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
               theme(strip.text.y = element_text(angle = 0))+
               theme(legend.position = "none")
              #ggsave('Q34_yr_2.jpg', height = 11, width = 8.5)


Q33_need_amu_info_yr_pct <- Q33_need_amu_info_yr %>% 
  mutate(Percent = pct*100)

ggplot(Q33_need_amu_info_yr_pct) +
  geom_point(aes(x = Q33_need_amu_info, y = grad_year_cat, size= Percent), color = 'orange')+
  geom_text(aes(x = Q33_need_amu_info, y = grad_year_cat, 
                label=paste0(round(pct*100, digits = 0))), 
            hjust = 0, vjust = 1)+
  theme_bw()+
  scale_y_discrete(limits = c(">2016", "2011-2016", "2000-2010", "1987-1999", "<1987"))+
  labs(x= "Times per Year", y = "Graduation Year", 
      title = "Need of Additional Information to Support 
  an Antimicrobial Prescribing Decision", 
      size = "Percent of Responses")

#-----------------------------------
#Add practice type
Q33_need_amu_info_prac_ct <- data.table(tally(~ Q33_need_amu_info | practice_type , data = Q33_filter))
Q33_need_amu_info_prac_pct <- data.table(round(tally(~ Q33_need_amu_info | practice_type , 
    data = Q33_filter, format("proportion")),4))%>% 
    rename(pct = N)

Q33_need_amu_info_prac <- merge.data.table(Q33_need_amu_info_prac_ct, 
    Q33_need_amu_info_prac_pct) %>% 
    arrange(factor(Q33_need_amu_info, levels = c("None", "1-2", "3-5", ">5", 'Unknown'))) %>% 
    arrange(factor(practice_type, levels = c("Private General Practice", "Food Animal Practice", "Consultant", 
                                     "Staff Vet", "Academia", "None")))

Q33_need_amu_info_prac <- Q33_need_amu_info_prac %>% 
  select(practice_type, Q33_need_amu_info, N, pct)

Q33_need_amu_info_pracb <-  Q33_need_amu_info_prac %>% 
  select(-pct) %>% 
  pivot_wider(names_from = Q33_need_amu_info, values_from = N) 

kable(Q33_need_amu_info_pracb)

Q33_need_amu_info_pracc <-  Q33_need_amu_info_prac %>% 
  select(-N) %>% 
  pivot_wider(names_from = Q33_need_amu_info, values_from = pct) 

kable(Q33_need_amu_info_pracc)

#kable(Q33_need_amu_info_prac)

#kable(table(AMU_Survey_Final$practice_type, AMU_Survey_Final$Q33_need_amu_info)) 

#-----------------------------------
#reorder
Q33_need_amu_info_prac <- Q33_need_amu_info_prac %>%
  filter(!(Q33_need_amu_info %in% 'Unknown')) %>%
  mutate(Q33_need_amu_info=fct_relevel(Q33_need_amu_info,c("None", "1-2", "3-5", ">5", 'Unknown'))) %>%  
  mutate(practice_type=fct_relevel(practice_type,c( "Consultant", "Private General Practice", 
                    "Academia", "None", "Staff Vet", "Food Animal Practice"))) 

#kable(Q33_need_amu_info_prac)

#bar chart for times a year need additional AMU information by practice type
ggplot(Q33_need_amu_info_prac)+
  geom_bar(aes(x = Q33_need_amu_info, y = pct, 
               fill = factor(Q33_need_amu_info)),
               stat = 'identity', position = 'dodge', fill = "#3CBB75FF")+
               facet_grid(factor(practice_type)~., scales = 'fixed')+
               theme(strip.text.y = element_text(angle = 0))+
               theme(legend.position = "none")+
               theme_bw()+
               labs(x = "Times per Year", y = "Percentage of Responses", 
                     title = "Need of Additional Information to Support an Antimicrobial Prescribing Decision")+
               scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
               theme(strip.text.y = element_text(angle = 0))+
               theme(legend.position = "none")
              #ggsave('Q34_yr_2.jpg', height = 11, width = 8.5)


Q33_need_amu_info_prac_pct <- Q33_need_amu_info_prac %>% 
  mutate(Percent = pct*100)

ggplot(Q33_need_amu_info_prac_pct) +
  geom_point(aes(x = Q33_need_amu_info, y = practice_type, size= Percent), color = 'orange')+
  geom_text(aes(x = Q33_need_amu_info, y = practice_type, 
                label=paste0(round(pct*100, digits = 0))), 
            hjust = 0, vjust = 1)+
  theme_bw()+
  scale_y_discrete(limits = c("Food Animal Practice", "Staff Vet", "None",
                    "Academia","Private General Practice", "Consultant"))+
  labs(x= "Times per Year", y = "Practice Type", 
      title = "Need of Additional Information to Support
  an Antimicrobial Prescribing Decision", 
      size = "Percent of Responses")
```

## Q34 In the last year, which of the following resources have you utilized for information to support an antimicrobial use or prescribing decision?  
```{r echo=FALSE, message=FALSE, warning=FALSE}
#create total count and proportion responses for resources (wide long)
Q34_1 <- AMU_Survey_Final %>%
  select(rowid, Q34_FARAD, Q34_textbook, Q34_web_search, Q34_literature_search, Q34_CE_notes, Q34_vet_school_notes, Q34_vet_assoc, Q34_pharma_company, Q34_university_contact, Q34_product_label, Q34_reg_doc, Q34_colleague, Q34_listserv, Q34_social_media)%>%
  pivot_longer(cols = c(Q34_FARAD, Q34_textbook, Q34_web_search, Q34_literature_search, Q34_CE_notes, Q34_vet_school_notes, Q34_vet_assoc, Q34_pharma_company, Q34_university_contact, Q34_product_label, Q34_reg_doc, Q34_colleague, Q34_listserv, Q34_social_media), 
               names_to = 'Resources', 
               values_to = 'Answer')%>%
  mutate(total = n_distinct(rowid), 
         total_sum = sum(n()))%>%
  filter(Answer %in% 'TRUE')%>%

  group_by(total, Resources, Answer)%>%
  summarize(resources_ct = sum(n()))%>%
  ungroup()%>%
  mutate(pct = resources_ct/total)

#kable(Q34_1)

#-----------------------------------
#rename reasons
Q34_1 <- Q34_1 %>% 
  mutate(Resources=fct_relevel(Resources, c('Q34_FARAD', 'Q34_textbook', 'Q34_web_search', 'Q34_literature_search', 
  'Q34_CE_notes', 'Q34_vet_school_notes', 'Q34_vet_assoc', 'Q34_pharma_company', 'Q34_university_contact', 
  'Q34_product_label', 'Q34_reg_doc', 'Q34_colleague', 'Q34_listserv', 'Q34_social_media')))

levels(Q34_1$Resources) <- c('FARAD', 'textbook', 'web search', 'literature search', 
  'CE notes', 'vet school notes', 'vet association guidance', 'pharma company', 'university contact', 
  'product label', 'regulatory documents', 'colleague', 'listserv', 'social media')

Q34_1 <- Q34_1 %>% 
  mutate(Resources=fct_relevel(Resources, c('product label', 'textbook', 'web search', 
          'FARAD', 'colleague', 'CE notes', 'pharma company', 'university contact',
          'literature search', 'listserv', 'vet school notes', 'regulatory documents',
          'vet association guidance', 'social media'))) %>% 
  arrange(factor(Resources, levels = c('product label', 'textbook', 'web search', 
          'FARAD', 'colleague', 'CE notes', 'pharma company', 'university contact',
          'literature search', 'listserv', 'vet school notes', 'regulatory documents',
          'vet association guidance', 'social media')))

Q34_1 <- Q34_1 %>% 
  arrange(desc(resources_ct)) %>% 
  select(-total, -Answer)

kable(Q34_1)

#bar chart for resources
ggplot(Q34_1)+
  geom_bar(aes(x = Resources, y = pct, 
               fill = factor(Resources)),
               stat = 'identity', position = 'dodge')+
               theme(axis.text.x = element_text(angle = 45, hjust = 1))+
               theme_bw()+
               theme(legend.position = "none")+
               scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
               theme(axis.text.x = element_text(angle = 45, hjust = 1))+
               labs(x= "Resources", y = "Percentage of Responses", 
                    title = "Resources to Support an Antimicrobial Prescribing Decision")+
               scale_color_viridis(option = "D")+
               scale_fill_viridis(discrete = TRUE, option = "D")
           #ggsave('test.jpg', height = 11, width = 8.5)


#-------------------------------
#create total count and proportion responses for resources by grad year category (wide format)
Q34_2 <- grad_yr_revised %>%
group_by(grad_year_cat) %>%
summarise(total = sum(n()), 
          total_n_dist = n_distinct(rowid), 
          Q34_FARAD_ct = sum(Q34_FARAD), 
          Q34_textbook_ct = sum(Q34_textbook),
          Q34_web_search_ct = sum(Q34_web_search),
          Q34_literature_search_ct = sum(Q34_literature_search),
          Q34_CE_notes_ct = sum(Q34_CE_notes),
          Q34_vet_school_notes_ct = sum(Q34_vet_school_notes),
          Q34_vet_assoc_ct = sum(Q34_vet_assoc),
          Q34_pharma_company_ct = sum(Q34_pharma_company),
          Q34_university_contact_ct = sum(Q34_university_contact),
          Q34_product_label_ct = sum(Q34_product_label),
          Q34_reg_doc_ct = sum(Q34_reg_doc),
          Q34_colleague_ct = sum(Q34_colleague),
          Q34_listserv_ct = sum(Q34_listserv),
          Q34_social_media_ct = sum(Q34_social_media))%>%
  ungroup()%>%
  mutate(pct_Q34_FARAD = Q34_FARAD_ct/total_n_dist, 
         pct_Q34_textbook = Q34_textbook_ct/total_n_dist,
         pct_Q34_web_search = Q34_web_search_ct/total_n_dist,
         pct_Q34_literature_search = Q34_literature_search_ct/total_n_dist,
         pct_Q34_CE_notes = Q34_CE_notes_ct/total_n_dist,
         pct_Q34_vet_school_notes = Q34_vet_school_notes_ct/total_n_dist,
         pct_Q34_vet_assoc = Q34_vet_assoc_ct/total_n_dist,
         pct_Q34_pharma_company = Q34_pharma_company_ct/total_n_dist,
         pct_Q34_university_contact = Q34_university_contact_ct/total_n_dist,
         pct_Q34_product_label = Q34_product_label_ct/total_n_dist,
         pct_Q34_reg_doc = Q34_reg_doc_ct/total_n_dist,
         pct_Q34_colleague = Q34_colleague_ct/total_n_dist,
         pct_Q34_listserv = Q34_listserv_ct/total_n_dist,
         pct_Q34_social_media = Q34_social_media_ct/total_n_dist)

#kable(Q34_2)

#--------------------------
#create total count and proportion responses for resources by grad year category (long format)
Q34_3 <- AMU_Survey_Final %>% rename("FARAD" = Q34_FARAD, "textbook" = Q34_textbook, "web search" = Q34_web_search,
        "literature search" = Q34_literature_search,  "CE notes" = Q34_CE_notes, "vet school notes" = Q34_vet_school_notes, 
        "vet association guidance" = Q34_vet_assoc, "pharma company" = Q34_pharma_company, "university contact" =
        Q34_university_contact, "product label" = Q34_product_label, "regulatory documents" = Q34_reg_doc, "colleague" =
        Q34_colleague, "listserv" = Q34_listserv, "social media" = Q34_social_media)

Q34_3_grad_yr <- Q34_3 %>% 
  filter(!(grad_year_cat %in% 'Unknown'))

Q34_3_yr <- Q34_3_grad_yr %>%
  select(rowid, grad_year_cat, "FARAD", "textbook", "web search", "literature search", 
          "CE notes", "vet school notes", "vet association guidance", "pharma company", "university contact", 
          "product label", "regulatory documents", "colleague", "listserv", "social media")%>%
  pivot_longer(cols = c("FARAD", "textbook", "web search", "literature search", 
          "CE notes", "vet school notes", "vet association guidance", "pharma company", "university contact", 
          "product label", "regulatory documents", "colleague", "listserv", "social media"), 
               names_to = 'Resources', 
               values_to = 'Answer')%>%
  group_by(grad_year_cat)%>%
  mutate(total = n_distinct(rowid), 
         total_sum = sum(n()))%>%
  ungroup()%>%
  filter(Answer %in% 'TRUE')%>%

  group_by(grad_year_cat, total, Resources, Answer)%>%
  summarize(resources_ct = sum(n()))%>%
  ungroup()%>%
  mutate(pct = resources_ct/total)

Q34_3_yr <- Q34_3_yr %>% 
  mutate(Resources=fct_relevel(Resources, c('FARAD', 'textbook', 'web search', 'literature search', 
  'CE notes', 'vet school notes', 'vet association guidance', 'pharma company', 'university contact', 
  'product label', 'regulatory documents', 'colleague', 'listserv', 'social media'))) %>% 
   arrange(factor(Resources, levels = c('FARAD', 'textbook', 'web search', 'literature search', 
  'CE notes', 'vet school notes', 'vet association guidance', 'pharma company', 'university contact', 
  'product label', 'regulatory documents', 'colleague', 'listserv', 'social media'))) %>% 
  arrange(factor(grad_year_cat, levels = c("<1987", "1987-1999", "2000-2010", "2011-2016", ">2016")))

#kable(Q34_3_yr)

Q34_3_yrb <-  Q34_3_yr %>% 
  select(-pct) %>% 
  pivot_wider(names_from = Resources, values_from = resources_ct) %>% 
  select(-total, -Answer)

kable(Q34_3_yrb)

Q34_3_yrc <-  Q34_3_yr %>% 
  select(-resources_ct) %>% 
  pivot_wider(names_from = Resources, values_from = pct) %>% 
  select(-total, -Answer)

kable(Q34_3_yrc)

#bar chart for resources by practice type
#ggplot(Q34_3_yr)+
  #geom_bar(aes(x = Resources, y = pct, 
               #fill = factor(Resources)),
               #stat = 'identity', position = 'dodge')+
               #facet_grid(factor(grad_year_cat)~., scales = 'free')+
               #theme(axis.text.x = element_text(angle = 45, hjust = 1))
               #ggsave('Q34_yr_1.jpg', height = 11, width = 8.5)

ggplot(Q34_3_yr)+
  geom_bar(aes(x = grad_year_cat, y = pct, 
               fill = factor(Resources)),
               stat = 'identity', position = 'dodge', fill = "#287D8EFF")+
               facet_grid(factor(Resources)~., scales = 'fixed')+
               theme(axis.text.x = element_text(angle = 45, hjust = 1))+
               theme(strip.text.y = element_text(angle = 0))+
               theme(legend.position = "none")+
               theme_bw()+
               theme(axis.text.x = element_text(angle = 45, hjust = 1))+
               labs(x = "Graduation Year", y = "Percentage of Responses", 
                     title = "Resources vs Graduation Year")+
               scale_y_continuous(labels = scales::percent_format(accuracy = 1))+
               theme(strip.text.y = element_text(angle = 0))+
               theme(legend.position = "none")
              #ggsave('Q34_yr_2.jpg', height = 11, width = 8.5)

Q34_3_yr_pct <- Q34_3_yr %>% 
  mutate(Percent = pct*100)

ggplot(Q34_3_yr_pct) +
  geom_point(aes(x = grad_year_cat, y = Resources, size= Percent), color = 'orange')+
  geom_text(aes(x = grad_year_cat, y = Resources, 
                label=paste0(round(pct*100, digits = 0))), 
            hjust = 0, vjust = 1)+
  theme_bw()+
  scale_y_discrete(limits = c('social media', 'vet association guidance',
      'regulatory documents', 'vet school notes','listserv', 'literature search',
      'university contact','pharma company','CE notes','colleague', 'FARAD',
          'web search', 'textbook', 'product label'))+
  labs(x= "Graduation Year", y = "Resources", 
      title = "Resources vs Graduation Year", 
      size = "Percent of Responses")

#-------------------------
#create total count and proportion responses for resources by practice type (long format)
Q34_3_prac <- Q34_3 %>%
  select(rowid, practice_type, "FARAD", "textbook", "web search", "literature search", 
          "CE notes", "vet school notes", "vet association guidance", "pharma company", "university contact", 
          "product label", "regulatory documents", "colleague", "listserv", "social media")%>%
  pivot_longer(cols = c("FARAD", "textbook", "web search", "literature search", 
          "CE notes", "vet school notes", "vet association guidance", "pharma company", "university contact", 
          "product label", "regulatory documents", "colleague", "listserv", "social media"), 
               names_to = 'Resources', 
               values_to = 'Answer')%>%
  group_by(practice_type)%>%
  mutate(total = n_distinct(rowid), 
         total_sum = sum(n()))%>%
  ungroup()%>%
  filter(Answer %in% 'TRUE')%>%

  group_by(practice_type, total, Resources, Answer)%>%
  summarize(resources_ct = sum(n()))%>%
  ungroup()%>%
  mutate(pct = resources_ct/total)

Q34_3_prac <- Q34_3_prac %>% 
  mutate(Resources=fct_relevel(Resources, c('FARAD', 'textbook', 'web search', 'literature search', 
  'CE notes', 'vet school notes', 'vet association guidance', 'pharma company', 'university contact', 
  'product label', 'regulatory documents', 'colleague', 'listserv', 'social media'))) %>% 
  arrange(factor(Resources, levels = c('FARAD', 'textbook', 'web search', 'literature search', 
  'CE notes', 'vet school notes', 'vet association guidance', 'pharma company', 'university contact', 
  'product label', 'regulatory documents', 'colleague', 'listserv', 'social media'))) %>% 
  arrange(factor(practice_type, levels = c("Private General Practice", "Food Animal Practice", "Consultant", 
                                     "Staff Vet", "Academia", "None")))
              
#kable(Q34_3_prac)

#bar chart for resources by practice type
#ggplot(Q34_3_prac)+
  #geom_bar(aes(x = Resources, y = pct, 
               #fill = factor(Resources)),
               #stat = 'identity', position = 'dodge')+
               #facet_grid(factor(practice_type)~., scales = 'free')+
               #theme(axis.text.x = element_text(angle = 45, hjust = 1))
               #ggsave('Q34_prac_1.jpg', height = 11, width = 8.5)

#ggplot(Q34_3_prac)+
  #geom_bar(aes(x = practice_type, y = pct, 
               #fill = factor(Resources)),
               #stat = 'identity', position = 'dodge')+
               #facet_grid(factor(Resources)~., scales = 'free')+
               #theme(axis.text.x = element_text(angle = 45, hjust = 1))
              #ggsave('Q34_prac_2.jpg', height = 11, width = 8.5)

```

